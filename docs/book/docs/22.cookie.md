
        <h2 id="t01. cookie&#x662F;&#x4EC0;&#x4E48;">1. cookie&#x662F;&#x4EC0;&#x4E48; <a href="#t01. cookie&#x662F;&#x4EC0;&#x4E48;"> # </a></h2>
<ul>
<li>HTTP1.0&#x4E2D;&#x534F;&#x8BAE;&#x662F;&#x65E0;&#x72B6;&#x6001;&#x7684;&#xFF0C;&#x4F46;&#x5728;WEB&#x5E94;&#x7528;&#x4E2D;&#xFF0C;&#x5728;&#x591A;&#x4E2A;&#x8BF7;&#x6C42;&#x4E4B;&#x95F4;&#x5171;&#x4EAB;&#x4F1A;&#x8BDD;&#x662F;&#x975E;&#x5E38;&#x5FC5;&#x8981;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x51FA;&#x73B0;&#x4E86;Cookie</li>
<li>cookie&#x662F;&#x4E3A;&#x4E86;&#x8FA9;&#x522B;&#x7528;&#x6237;&#x8EAB;&#x4EFD;&#xFF0C;&#x8FDB;&#x884C;&#x4F1A;&#x8BDD;&#x8DDF;&#x8E2A;&#x800C;<em>&#x5B58;&#x50A8;&#x5728;&#x5BA2;&#x6237;&#x7AEF;</em>&#x4E0A;&#x7684;&#x6570;&#x636E;</li>
</ul>
<h2 id="t12. Cookie&#x7684;&#x5904;&#x7406;&#x6D41;&#x7A0B;">2. Cookie&#x7684;&#x5904;&#x7406;&#x6D41;&#x7A0B; <a href="#t12. Cookie&#x7684;&#x5904;&#x7406;&#x6D41;&#x7A0B;"> # </a></h2>
<p><img src="http://7xjf2l.com1.z0.glb.clouddn.com/cookies.png" class="img-responsive"></p>
<h2 id="t23. &#x4F7F;&#x7528;&#x6B65;&#x9AA4;">3. &#x4F7F;&#x7528;&#x6B65;&#x9AA4; <a href="#t23. &#x4F7F;&#x7528;&#x6B65;&#x9AA4;"> # </a></h2>
<h3 id="t33.1 &#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;cookie">3.1 &#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;cookie <a href="#t33.1 &#x670D;&#x52A1;&#x5668;&#x53D1;&#x9001;cookie"> # </a></h3>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x7B2C;&#x4E00;&#x6B21;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;&#x7684;&#x65F6;&#x5019;&#x670D;&#x52A1;&#x5668;&#x901A;&#x8FC7;&#x54CD;&#x5E94;&#x5934;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;Cookie,&#x5C5E;&#x6027;&#x4E4B;&#x95F4;&#x7528;&#x5206;&#x53F7;&#x7A7A;&#x683C;&#x5206;&#x9694;</p>
<pre><code class="lang-javascript">Set-Cookie:name=zfpx; Path=/
</code></pre>
<h3 id="t43.2 &#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x4FDD;&#x5B58;cookie">3.2 &#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x4FDD;&#x5B58;cookie <a href="#t43.2 &#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x4FDD;&#x5B58;cookie"> # </a></h3>
<p>&#x5BA2;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;Cookie&#x4E4B;&#x540E;&#x4FDD;&#x5B58;&#x5728;&#x672C;&#x5730;</p>
<p><img src="http://7xjf2l.com1.z0.glb.clouddn.com/localcookie.jpg" class="img-responsive"></p>
<h3 id="t53.3 &#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;cookie">3.3 &#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;cookie <a href="#t53.3 &#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;cookie"> # </a></h3>
<p>&#x4EE5;&#x540E;&#x5BA2;&#x6237;&#x7AEF;&#x518D;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x628A;&#x6B64;Cookie&#x53D1;&#x9001;&#x5230;&#x670D;&#x52A1;&#x5668;&#x7AEF;</p>
<pre><code class="lang-javascript">Cookie:name=zfpx
</code></pre>
<h2 id="t64. cookie&#x91CD;&#x8981;&#x5C5E;&#x6027;">4. cookie&#x91CD;&#x8981;&#x5C5E;&#x6027; <a href="#t64. cookie&#x91CD;&#x8981;&#x5C5E;&#x6027;"> # </a></h2>
<table>
<thead>
<tr>
<th style="text-align:left">&#x5C5E;&#x6027;</th>
<th style="text-align:left">&#x8BF4;&#x660E;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">name=value</td>
<td style="text-align:left">&#x952E;&#x503C;&#x5BF9;&#xFF0C;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x8981;&#x4FDD;&#x5B58;&#x7684; Key/Value</td>
</tr>
<tr>
<td style="text-align:left">Domain</td>
<td style="text-align:left">&#x57DF;&#x540D;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x5F53;&#x524D;&#x57DF;&#x540D;</td>
</tr>
<tr>
<td style="text-align:left">maxAge</td>
<td style="text-align:left">&#x6700;&#x5927;&#x5931;&#x6548;&#x65F6;&#x95F4;(&#x6BEB;&#x79D2;),&#x8BBE;&#x7F6E;&#x5728;&#x591A;&#x5C11;&#x540E;&#x5931;&#x6548;</td>
</tr>
<tr>
<td style="text-align:left">secure</td>
<td style="text-align:left">&#x5F53; secure &#x503C;&#x4E3A; true &#x65F6;&#xFF0C;cookie &#x5728; HTTP &#x4E2D;&#x662F;&#x65E0;&#x6548;&#xFF0C;&#x5728; HTTPS &#x4E2D;&#x624D;&#x6709;&#x6548;</td>
</tr>
<tr>
<td style="text-align:left">Path</td>
<td style="text-align:left">&#x8868;&#x793A; cookie &#x5F71;&#x54CD;&#x5230;&#x7684;&#x8DEF;&#xFF0C;&#x5982; path=/&#x3002;&#x5982;&#x679C;&#x8DEF;&#x5F84;&#x4E0D;&#x80FD;&#x5339;&#x914D;&#x65F6;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x5219;&#x4E0D;&#x53D1;&#x9001;&#x8FD9;&#x4E2A;Cookie</td>
</tr>
<tr>
<td style="text-align:left">Expires</td>
<td style="text-align:left">&#x8FC7;&#x671F;&#x65F6;&#x95F4;(&#x79D2;)&#xFF0C;&#x5728;&#x8BBE;&#x7F6E;&#x7684;&#x67D0;&#x4E2A;&#x65F6;&#x95F4;&#x70B9;&#x540E;&#x8BE5; Cookie &#x5C31;&#x4F1A;&#x5931;&#x6548;&#xFF0C;&#x5982; expires=Money, 05-Dec-11 11:11:11 GMT</td>
</tr>
<tr>
<td style="text-align:left">httpOnly</td>
<td style="text-align:left">&#x5982;&#x679C;&#x5728;COOKIE&#x4E2D;&#x8BBE;&#x7F6E;&#x4E86;<code>httpOnly</code>&#x5C5E;&#x6027;&#xFF0C;&#x5219;&#x901A;&#x8FC7;&#x7A0B;&#x5E8F;(JS&#x811A;&#x672C;)&#x5C06;&#x65E0;&#x6CD5;&#x8BFB;&#x53D6;&#x5230;COOKIE&#x4FE1;&#x606F;&#xFF0C;&#x9632;&#x6B62;XSS&#x653B;&#x51FB;&#x4EA7;&#x751F;</td>
</tr>
</tbody>
</table>
<h2 id="t75. &#x5728;express&#x4E2D;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;cookie">5. &#x5728;express&#x4E2D;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;cookie <a href="#t75. &#x5728;express&#x4E2D;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x53D1;&#x9001;cookie"> # </a></h2>
<h3 id="t85.1 &#x8BBE;&#x7F6E;cookie">5.1 &#x8BBE;&#x7F6E;cookie <a href="#t85.1 &#x8BBE;&#x7F6E;cookie"> # </a></h3>
<pre><code class="lang-js"> res.cookie(name,value,[,options]);
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">&#x53C2;&#x6570;</th>
<th style="text-align:left">chrome&#x5BF9;&#x5E94;&#x5C5E;&#x6027;</th>
<th style="text-align:left">&#x7C7B;&#x578B;</th>
<th style="text-align:left">&#x8BF4;&#x660E;</th>
<th style="text-align:left">&#x793A;&#x4F8B;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">domain</td>
<td style="text-align:left">Domain</td>
<td style="text-align:left">String</td>
<td style="text-align:left">&#x57DF;&#x540D;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;&#x5F53;&#x524D;&#x57DF;&#x540D;</td>
<td style="text-align:left">{domain:&apos;a.zfpx.cn&apos;}</td>
</tr>
<tr>
<td style="text-align:left">path</td>
<td style="text-align:left">Path</td>
<td style="text-align:left">String</td>
<td style="text-align:left">&#x8DEF;&#x5F84;&#xFF0C;&#x9ED8;&#x8BA4;&#x662F;/</td>
<td style="text-align:left">{path:&apos;/visit&apos;}</td>
</tr>
<tr>
<td style="text-align:left">expires</td>
<td style="text-align:left">Expires</td>
<td style="text-align:left">Date</td>
<td style="text-align:left">&#x8FC7;&#x671F;&#x65F6;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x6CA1;&#x4EE5;&#x6709;&#x6307;&#x5B9A;&#x6216;&#x4E3A;0&#x8868;&#x793A;&#x5F53;&#x524D;&#x4F1A;&#x8BDD;&#x6709;&#x6548;</td>
<td style="text-align:left">{expires:new Date(Date.now()+20*1000)}</td>
</tr>
<tr>
<td style="text-align:left">maxAge</td>
<td style="text-align:left">Max-Age</td>
<td style="text-align:left">Number</td>
<td style="text-align:left">&#x6709;&#x6548;&#x65F6;&#x95F4;(&#x5355;&#x4F4D;&#x662F;&#x6BEB;&#x79D2;)</td>
<td style="text-align:left">{maxAge:20*1000}</td>
</tr>
<tr>
<td style="text-align:left">httpOnly</td>
<td style="text-align:left">HTTP</td>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">&#x4E0D;&#x80FD;&#x901A;&#x8FC7;&#x6D4F;&#x89C8;&#x5668;javascript&#x8BBF;&#x95EE;</td>
<td style="text-align:left">{httpOnly:true}</td>
</tr>
<tr>
<td style="text-align:left">secure</td>
<td style="text-align:left">Secure</td>
<td style="text-align:left">String</td>
<td style="text-align:left">&#x53EA;&#x901A;&#x8FC7;https&#x534F;&#x8BAE;&#x8BBF;&#x95EE;</td>
</tr>
</tbody>
</table>
<h3 id="t95.2 &#x83B7;&#x53D6;cookie">5.2 &#x83B7;&#x53D6;cookie <a href="#t95.2 &#x83B7;&#x53D6;cookie"> # </a></h3>
<p>&#x4F7F;&#x7528;cookie-parser&#x4E2D;&#x95F4;&#x4EF6;</p>
<pre><code class="lang-js">$ npm install cookie-parser --save
</code></pre>
<pre><code class="lang-js">app.use(require(&apos;cookie-parser&apos;)());    //&#x4F7F;&#x7528;&#x4E2D;&#x95F4;&#x4EF6;
response.cookie(key,value)              //&#x5728;&#x54CD;&#x5E94;&#x4E2D;&#x5411;&#x5BA2;&#x6237;&#x7AEF;&#x8BBE;&#x7F6E;cookie
request.cookies                         //&#x83B7;&#x53D6;&#x8BF7;&#x6C42;&#x4E2D;&#x7684;cookie&#x5BF9;&#x8C61;
response.clearCookie(&apos;username&apos;)        //&#x6E05;&#x9664;cookie
</code></pre>
<pre><code class="lang-javascript">var express = require(&apos;express&apos;);
var cookieParser = require(&apos;cookie-parser&apos;);
var app = express();
/**
 * &#x5982;&#x679C;&#x8981;&#x52A0;&#x5BC6;&#x7684;&#x8BDD; cookieParser&#x91CC;&#x8981;&#x6307;&#x5B9A;&#x5BC6;&#x7801;&#xFF0C;&#x800C;&#x4E14;signed&#x8981;&#x7B49;&#x4E8E;true res.cookie(&apos;name&apos;,&apos;zfpx&apos;,{signed:true});
 */
app.use(cookieParser(&apos;zfpx&apos;));
app.get(&apos;/write&apos;,function(req,res){
    //1.&#x666E;&#x901A;&#x8BBE;&#x7F6E;
    //res.cookie(&apos;name&apos;,&apos;value&apos;);

    //2.&#x8BBE;&#x7F6E;&#x57DF;&#x540D;
    //res.cookie(&apos;name&apos;,&apos;zfpx&apos;,{domain:&apos;a.zfpx.cn&apos;});

    //3.&#x8BBE;&#x7F6E;&#x8DEF;&#x5F84;
    //res.cookie(&apos;name&apos;,&apos;zfpx&apos;,{path:&apos;/visit&apos;});

    //4.&#x8FC7;&#x671F;&#x65F6;&#x95F4;
    //res.cookie(&apos;name&apos;,&apos;zfpx&apos;,{expires:new Date(Date.now()+20*1000)});//&#x6BEB;&#x79D2;
    //res.cookie(&apos;name&apos;,&apos;zfpx&apos;,{maxAge:20*1000});//&#x8FC7;&#x671F;&#x65F6;&#x95F4; &#x6BEB;&#x79D2;

    //httpOnly true&#x8FD8;&#x662F;false&#x65E0;&#x610F;&#x4E49; document.cookie&#x53D6;&#x4E0D;&#x5230;
    //res.cookie(&apos;name&apos;,&apos;zfpx&apos;,{httpOnly:true});
    res.cookie(&apos;age&apos;,&apos;123&apos;,{signed:true});
    res.end(&apos;ok&apos;);
});

app.get(&apos;/read&apos;,function(req,res){
    console.log(req.signedCookies);
    res.send(req.cookies);
});

//&#x8BB0;&#x5F55;&#x8FD9;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x7B2C;&#x51E0;&#x6B21;&#x8BBF;&#x95EE;
app.get(&apos;/visit&apos;,function(req,res){
    res.cookie(&apos;count&apos;,isNaN(req.cookies.count)?0:parseInt(req.cookies.count)+1);
    res.send(req.cookies);
});


app.listen(9090);
</code></pre>
<h3 id="t105.3 cookie&#x539F;&#x7406;&#x89E3;&#x6790;">5.3 cookie&#x539F;&#x7406;&#x89E3;&#x6790; <a href="#t105.3 cookie&#x539F;&#x7406;&#x89E3;&#x6790;"> # </a></h3>
<pre><code class="lang-javascript">function cookieParser(secret){
  return function cookieParser(req, res, next){
    req.secret = secret;  
    if (!req.headers.cookie) {
        return next();
    }
    req.cookies =  require(&apos;querystring&apos;).parse(req.headers.cookie,&apos;; &apos;,&apos;=&apos;);
    if(req.secret){
        req.signedCookies = {};
        for(let attr in req.cookies){
                let val = req.cookies[attr];
                req.signedCookies[attr] = unsign(val, secret);
            }
        }
    }
    next();
  }
}

function cookie(name, val, options) {
    var opt = options || {};
    val = encodeURIComponent(val);
    if(opt.secret){
        var secret = this.req.secret;
        val = sign(val,this.secret);
    }

    var pairs = [name + &apos;=&apos; + value];

    if (null != opt.maxAge) {
        var maxAge = opt.maxAge - 0;
        if (isNaN(maxAge)) throw new Error(&apos;maxAge should be a Number&apos;);
        pairs.push(&apos;Max-Age=&apos; + Math.floor(maxAge));
    }

    if (opt.domain) {
        pairs.push(&apos;Domain=&apos; + opt.domain);
    }

    if (opt.path) {
        pairs.push(&apos;Path=&apos; + opt.path);
    }

    if (opt.expires) pairs.push(&apos;Expires=&apos; + opt.expires.toUTCString());
    if (opt.httpOnly) pairs.push(&apos;HttpOnly=true&apos;);
    if (opt.secure) pairs.push(&apos;Secure=true&apos;);

    return pairs.join(&apos;; &apos;);
}

var crypto = require(&apos;crypto&apos;);
exports.sign = function(val, secret){
  return val + &apos;.&apos; + crypto
    .createHmac(&apos;sha256&apos;, secret)
    .update(val)
    .digest(&apos;base64&apos;)
    .replace(/\=+$/, &apos;&apos;);
};

exports.unsign = function(val, secret){
  var str = val.slice(0, val.lastIndexOf(&apos;.&apos;))
    , mac = exports.sign(str, secret);
  return mac == val ? str : false;
};

</code></pre>
<h2 id="t116. &#x6743;&#x9650;&#x63A7;&#x5236;">6. &#x6743;&#x9650;&#x63A7;&#x5236; <a href="#t116. &#x6743;&#x9650;&#x63A7;&#x5236;"> # </a></h2>
<pre><code class="lang-javascript">var express = require(&apos;express&apos;);
var cookieParser = require(&apos;cookie-parser&apos;);
var app = express();
app.set(&apos;view engine&apos;,&apos;html&apos;);
app.engine(&apos;html&apos;,require(&apos;ejs&apos;).__express);
app.set(&apos;views&apos;,__dirname);

app.use(cookieParser());

function checkUser(req,res,next){
    if(req.cookies &amp;&amp; req.cookies.username)
      next();
    else
      res.redirect(&apos;/&apos;);
}

//&#x8FDB;&#x5165;&#x767B;&#x5F55;&#x9875;
app.get(&apos;/&apos;,function(req,res){
    res.render(&apos;index&apos;);
});

//&#x767B;&#x5F55;
app.get(&apos;/login&apos;,function(req,res){
    res.cookie(&apos;username&apos;,req.query.username,{httpOnly:true});
    res.redirect(&apos;/user&apos;);
});

//&#x7528;&#x6237;&#x9875;&#x9762;
app.get(&apos;/user&apos;,checkUser,function(req,res){
    res.render(&apos;user&apos;,{username:req.cookies.username});
});

//&#x7528;&#x6237;&#x9000;&#x51FA;
app.get(&apos;/logout&apos;,function(req,res){
    res.clearCookie(&apos;username&apos;);//&#x6E05;&#x9664;cookie
    res.redirect(&apos;/&apos;);
});

app.listen(8080);
</code></pre>
<h2 id="t127.cookie&#x4F7F;&#x7528;&#x6CE8;&#x610F;&#x4E8B;&#x9879;">7.cookie&#x4F7F;&#x7528;&#x6CE8;&#x610F;&#x4E8B;&#x9879; <a href="#t127.cookie&#x4F7F;&#x7528;&#x6CE8;&#x610F;&#x4E8B;&#x9879;"> # </a></h2>
<ul>
<li>&#x53EF;&#x80FD;&#x88AB;&#x5BA2;&#x6237;&#x7AEF;&#x7BE1;&#x6539;&#xFF0C;&#x4F7F;&#x7528;&#x524D;&#x9A8C;&#x8BC1;&#x5408;&#x6CD5;&#x6027;</li>
<li>&#x4E0D;&#x8981;&#x5B58;&#x50A8;&#x654F;&#x611F;&#x6570;&#x636E;&#xFF0C;&#x6BD4;&#x5982;&#x7528;&#x6237;&#x5BC6;&#x7801;&#xFF0C;&#x8D26;&#x6237;&#x4F59;&#x989D;</li>
<li>&#x4F7F;&#x7528;httpOnly&#x4FDD;&#x8BC1;&#x5B89;&#x5168;</li>
<li>&#x5C3D;&#x91CF;&#x51CF;&#x5C11;cookie&#x7684;&#x4F53;&#x79EF;</li>
<li>&#x8BBE;&#x7F6E;&#x6B63;&#x786E;&#x7684;domain&#x548C;path&#xFF0C;&#x51CF;&#x5C11;&#x6570;&#x636E;&#x4F20;&#x8F93;</li>
</ul>

        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    