
        <h2 id="t01. React&#x8DEF;&#x7531;">1. React&#x8DEF;&#x7531; <a href="#t01. React&#x8DEF;&#x7531;"> # </a></h2>
<ul>
<li>&#x4E0D;&#x540C;&#x7684;&#x8DEF;&#x5F84;&#x6E32;&#x67D3;&#x4E0D;&#x540C;&#x7684;&#x7EC4;&#x4EF6;</li>
<li>&#x6709;&#x4E24;&#x79CD;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;<ul>
<li>HashRouter:&#x5229;&#x7528;hash&#x5B9E;&#x73B0;&#x8DEF;&#x7531;&#x5207;&#x6362;</li>
<li>BrowserRouter:&#x5B9E;&#x73B0;h5 Api&#x5B9E;&#x73B0;&#x8DEF;&#x7531;&#x7684;&#x5207;&#x6362;</li>
</ul>
</li>
</ul>
<h3 id="t11.1 hash">1.1 hash <a href="#t11.1 hash"> # </a></h3>
<pre><code class="lang-js">    <a href="#/a">&#x53BB;a</a>
    <a href="#/b">&#x53BB;b</a>
    <script>
      window.addEventListener('hashchange',()=>{
          console.log(window.location.hash);
      });
    </script>
</code></pre>
<h3 id="t21.2 history">1.2 history <a href="#t21.2 history"> # </a></h3>
<ul>
<li>history&#x5BF9;&#x8C61;&#x63D0;&#x4F9B;&#x4E86;&#x64CD;&#x4F5C;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x8BDD;&#x5386;&#x53F2;&#x7684;&#x63A5;&#x53E3;&#x3002;</li>
<li>history&#x5BF9;&#x8C61;&#x6301;&#x7EED;&#x8FFD;&#x8E2A;&#x7740;&#x4E00;&#x7EC4;location</li>
<li>&#x9664;&#x4E86;&#x4E00;&#x7EC4;location&#x5916;&#xFF0C;history&#x4E5F;&#x4FDD;&#x5B58;&#x4E00;&#x4E2A;&#x7D22;&#x5F15;&#x503C;&#xFF0C;&#x7528;&#x6765;&#x6307;&#x5411;&#x5F53;&#x524D;&#x6240;&#x5BF9;&#x5E94;&#x7684;location</li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/history">history</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/History">History</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/onpopstate">onpopstate</a></li>
</ul>
<h2 id="t32.&#x8DD1;&#x901A;&#x8DEF;&#x7531;">2.&#x8DD1;&#x901A;&#x8DEF;&#x7531; <a href="#t32.&#x8DD1;&#x901A;&#x8DEF;&#x7531;"> # </a></h2>
<h3 id="t42.1 index.js">2.1 index.js <a href="#t42.1 index.js"> # </a></h3>
<pre><code class="lang-js">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {HashRouter as Router,Route} from &apos;react-router-dom&apos;;
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
ReactDOM.render(
    <router>
        <div>
          <route path="/" component="{Home}">
          <route path="/user" component="{User}">
          <route path="/profile" component="{Profile}/">
        </route></route></route></div>
    </router>
,document.getElementById(&apos;root&apos;));
</code></pre>
<h3 id="t52.2 Home.js">2.2 Home.js <a href="#t52.2 Home.js"> # </a></h3>
<p>components/Home.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class Home extends Component{
    render() {
        return (
            <div>Home</div>
        )
    }
}
</code></pre>
<h3 id="t62.3 Profile.js">2.3 Profile.js <a href="#t62.3 Profile.js"> # </a></h3>
<p>components/Profile.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class Profile extends Component{
    render() {
        return (
            <div>Profile</div>
        )
    }
}
</code></pre>
<h3 id="t72.4 User.js">2.4 User.js <a href="#t72.4 User.js"> # </a></h3>
<p>components/User.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class User extends Component{
    render() {
        return (
            <div>User</div>
        )
    }
}
</code></pre>
<h3 id="t82.5 this.props">2.5 this.props <a href="#t82.5 this.props"> # </a></h3>
<blockquote>
<p><a href="http://localhost:3000/#/user?name=zfpx#top">http://localhost:3000/#/user?name=zfpx#top</a></p>
</blockquote>
<pre><code class="lang-js">{
    &quot;match&quot;: {
        &quot;path&quot;: &quot;/user/:id&quot;,   //&#x5339;&#x914D;&#x8DEF;&#x5F84;
        &quot;url&quot;: &quot;/user/1&quot;,      //&#x5730;&#x5740;&#x680F;&#x4E2D;&#x7684;url
        &quot;isExact&quot;: true,       //&#x662F;&#x5426;&#x7CBE;&#x786E;&#x5339;&#x914D;
        &quot;params&quot;: {&quot;id&quot;: &quot;1&quot;}  // &#x8DEF;&#x5F84;&#x53C2;&#x6570;&#x5BF9;&#x8C61;
    },
    &quot;location&quot;: {
        &quot;pathname&quot;: &quot;/user/1&quot;,  //&#x8DEF;&#x5F84;&#x540D;
        &quot;search&quot;: &quot;?name=zfpx&quot;, //&#x67E5;&#x8BE2;&#x5B57;&#x7B26;&#x4E32;
        &quot;hash&quot;: &quot;#top&quot;          //hash&#x503C;
        &quot;state&quot;:undefined
    },
    &quot;history&quot;: {
        &quot;length&quot;: 6,            //&#x5386;&#x53F2;&#x957F;&#x5EA6;
        &quot;action&quot;: &quot;POP&quot;,        //&#x52A8;&#x4F5C;
        &quot;location&quot;: {           //&#x5F53;&#x524D;&#x5E94;&#x7528;&#x6240;&#x5904;&#x7684;&#x4F4D;&#x7F6E;
            &quot;pathname&quot;: &quot;/user/1&quot;,
            &quot;search&quot;: &quot;?name=zfpx&quot;,
            &quot;hash&quot;: &quot;#top&quot;,
            &quot;state&quot;:undefined  //location&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x4E0E;&#x4E4B;&#x76F8;&#x5173;&#x7684;&#x72B6;&#x6001;&#x3002;&#x8FD9;&#x662F;&#x4E00;&#x4E9B;&#x56FA;&#x5B9A;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4E14;&#x4E0D;&#x5B58;&#x5728;&#x4E8E;URL&#x4E4B;&#x4E2D;
        },
        &quot;go&quot;:f go(n),//&#x662F;&#x4E00;&#x4E2A;&#x5F3A;&#x5927;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x5305;&#x542B;&#x4E86;goForward&#x4E0E;goBack&#x7684;&#x529F;&#x80FD;&#x3002;&#x4F20;&#x5165;&#x8D1F;&#x6570;&#x5219;&#x9000;&#x540E;&#xFF0C;&#x4F20;&#x5165;&#x6B63;&#x6570;&#x5219;&#x5411;&#x524D;
        &quot;goBack&quot;:f goBack(),//&#x8FD4;&#x56DE;&#x4E00;&#x5C42;&#x9875;&#x9762;&#x3002;&#x5B9E;&#x9645;&#x4E0A;&#x662F;&#x5C06;history&#x7684;&#x7D22;&#x5F15;&#x503C;&#x51CF;1
        &quot;goForward&quot;:f goForward(),//&#x4E0E;goBack&#x76F8;&#x5BF9;&#x3002;&#x5411;&#x524D;&#x4E00;&#x5C42;&#x9875;&#x9762;
        &quot;listen&quot;:f listen(listener),//&#x91C7;&#x7528;&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;&#xFF0C;&#x5728;location&#x6539;&#x53D8;&#x65F6;&#xFF0C;history&#x4F1A;&#x53D1;&#x51FA;&#x901A;&#x77E5;
        &quot;push&quot;:f push(path,state),//&#x65B9;&#x6CD5;&#x4F7F;&#x80FD;&#x4F60;&#x8DF3;&#x8F6C;&#x5230;&#x65B0;&#x7684;location
        &quot;replace&quot;:f replace(path,state)//replace&#x65B9;&#x6CD5;&#x4E0E;push&#x76F8;&#x4F3C;&#xFF0C;&#x4F46;&#x5B83;&#x5E76;&#x975E;&#x6DFB;&#x52A0;location&#xFF0C;&#x800C;&#x662F;&#x66FF;&#x6362;&#x5F53;&#x524D;&#x7D22;&#x5F15;&#x4E0A;&#x7684;&#x4F4D;&#x7F6E;,&#x91CD;&#x5B9A;&#x5411;&#x65F6;&#x8981;&#x4F7F;&#x7528;replace,
        &quot;createHref&quot;:f createHref(location)
    }
}
</code></pre>
<h3 id="t92.6  createHref">2.6  createHref <a href="#t92.6  createHref"> # </a></h3>
<pre><code class="lang-js">const location = {
  pathname: &apos;/user&apos;,
  search: &apos;?id=1&apos;,
  hash: &apos;#bottom&apos;
}
const url = history.createHref(location)
const link = document.createElement(&apos;a&apos;)
a.href = url
// <a href="/user?id=1#bottom"></a>
</code></pre>
<h2 id="t103.&#x5B9E;&#x73B0;&#x57FA;&#x672C;&#x8DEF;&#x7531;">3.&#x5B9E;&#x73B0;&#x57FA;&#x672C;&#x8DEF;&#x7531; <a href="#t103.&#x5B9E;&#x73B0;&#x57FA;&#x672C;&#x8DEF;&#x7531;"> # </a></h2>
<ul>
<li><a href="https://reacttraining.com/react-router/web/example/basic">react-router</a></li>
</ul>
<h3 id="t113.1 index.js">3.1 index.js <a href="#t113.1 index.js"> # </a></h3>
<p>src/index.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {HashRouter as Router,Route} from &apos;./react-router-dom&apos;;
import Home from &apos;./components/Home&apos;;
import User from &apos;./components/User&apos;;
import Profile from &apos;./components/Profile&apos;;
ReactDOM.render(
    <router>
        <div>
          <route path="/" component="{Home}">
            <route path="/user" component="{User}">
          <route path="/profile" component="{Profile}/">
        </route></route></route></div>
    </router>
,document.getElementById(&apos;root&apos;));
</code></pre>
<h3 id="t123.2 index.js">3.2 index.js <a href="#t123.2 index.js"> # </a></h3>
<p>src/react-router-dom/index.js</p>
<pre><code class="lang-js">import HashRouter from &apos;./HashRouter&apos;;
import Route from &apos;./Route&apos;;

export {
    HashRouter,
    Route
}
</code></pre>
<h3 id="t133.3 context.js">3.3 context.js <a href="#t133.3 context.js"> # </a></h3>
<p>src/react-router-dom/context.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;;
// React16.3
let {Provider,Consumer}=React.createContext();
export {Provider,Consumer};
</code></pre>
<h3 id="t143.4 HashRouter.js">3.4 HashRouter.js <a href="#t143.4 HashRouter.js"> # </a></h3>
<p>src/react-router-dom/HashRouter.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Provider} from &apos;./context&apos;;
export default class HashRouter extends Component{
    state={
        location: {
            pathname:window.location.hash?window.location.hash.slice(1):&apos;/&apos;
        }
    }
    componentDidMount() {
        //&#x9ED8;&#x8BA4;hash&#x6CA1;&#x6709;&#x7684;&#x65F6;&#x5019;&#x8DF3;&#x8F6C;&#x5230;/
        window.location.hash=window.location.hash||&apos;/&apos;;
        //&#x76D1;&#x542C;hash&#x503C;&#x53D8;&#x5316;
        window.addEventListener(&apos;hashchange&apos;,() =&gt; {
            this.setState({
                location: {
                ...this.state.location,
                pathname:window.location.hash?window.location.hash.slice(1):&apos;/&apos;
            }});
        });
    }
    render() {
        let value={
            location:this.state.location
        }
        return (
            <provider value="{value}">
                {this.props.children}
            </provider>
        )
    }
}
</code></pre>
<h3 id="t153.5 Route.js">3.5 Route.js <a href="#t153.5 Route.js"> # </a></h3>
<p>src/react-router-dom/Route.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Consumer} from &apos;./context&apos;;
export default class Route extends Component{
    render() {
        let {path,component: Component}=this.props;
        return (
            <consumer>
                {
                    value =&gt; {
                        let {pathname}=value.location;
                        if (path == pathname) {
                            return <component>
                        } else {
                            return null;
                        }
                    }
                }
            </component></consumer>
        )
    }
}
</code></pre>
<h2 id="t164. path-to-regexp">4. path-to-regexp <a href="#t164. path-to-regexp"> # </a></h2>
<p>&#x628A;&#x4E00;&#x4E2A;&#x8DEF;&#x5F84;&#x8F6C;&#x6362;&#x6210;&#x6B63;&#x5219;&#x8868;&#x8FBE;&#x5F0F;</p>
<ul>
<li><a href="https://www.npmjs.com/package/path-to-regexp">path-to-regexp</a></li>
<li><p><a href="https://regexper.com/">regexper</a></p>
</li>
<li><p><img src="http://img.zhufengpeixun.cn/userendfalse.png" alt="&#x4E0D;&#x9700;&#x8981;&#x7ED3;&#x675F;"></p>
</li>
<li><img src="http://img.zhufengpeixun.cn/userendtrue.png" alt="&#x9700;&#x8981;&#x7ED3;&#x675F;"></li>
<li><img src="http://img.zhufengpeixun.cn/userparams.png" alt="&#x6709;&#x8DEF;&#x5F84;&#x53C2;&#x6570;"></li>
</ul>
<pre><code class="lang-js">let pathToRegexp=require(&apos;path-to-regexp&apos;);
//let regex=pathToRegexp(&apos;/user&apos;,[],{end: true});// /^\/user(?:\/)?$/i
//let regex=pathToRegexp(&apos;/user&apos;,[],{end: false});// //^\/user(?:\/(?=$))?(?=\/|$)/i
let keys=[];
let regex=pathToRegexp(&apos;/user/:id&apos;,keys,{end: false});///^\/user\/([^\/]+?)(?:\/(?=$))?(?=\/|$)/i
// (?:) &#x662F; &#x4E0D;&#x60F3;&#x88AB;&#x6355;&#x83B7;&#x7684;&#x65F6;&#x5019;&#x4F7F;&#x7528;
// (?=pattern) &#x96F6;&#x5BBD;&#x6B63;&#x5411;&#x5148;&#x884C;&#x65AD;&#x8A00;(zero-width positive lookahead assertion) 
console.log(regex);
console.log(keys);
//console.log(regex.test(&apos;/user&apos;));   //true
//console.log(regex.test(&apos;/user/1&apos;)); //true
console.log(regex.test(&apos;/user/1&apos;)); //true

</code></pre>
<h2 id="t175. &#x6B63;&#x5219;&#x5339;&#x914D;&#x8DEF;&#x5F84;">5. &#x6B63;&#x5219;&#x5339;&#x914D;&#x8DEF;&#x5F84; <a href="#t175. &#x6B63;&#x5219;&#x5339;&#x914D;&#x8DEF;&#x5F84;"> # </a></h2>
<h3 id="t185.1 Route.js">5.1 Route.js <a href="#t185.1 Route.js"> # </a></h3>
<p>src/react-router-dom/Route.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Consumer} from &apos;./context&apos;;
import pathToRegexp from &apos;path-to-regexp&apos;;
export default class Route extends Component{
    render() {
        let {path,component: Component}=this.props;
        let regexp=pathToRegexp(path,[],{end:false});
        return (
            <consumer>
                {
                    value =&gt; {
                        let {pathname}=value.location;
                        if (regexp.test(pathname)) {
                            return <component>
                        } else {
                            return null;
                        }
                    }
                }
            </component></consumer>
        )
    }
}
</code></pre>
<h2 id="t196.exact &#x7CBE;&#x786E;&#x5339;&#x914D;">6.exact &#x7CBE;&#x786E;&#x5339;&#x914D; <a href="#t196.exact &#x7CBE;&#x786E;&#x5339;&#x914D;"> # </a></h2>
<h3 id="t206.1 index.js">6.1 index.js <a href="#t206.1 index.js"> # </a></h3>
<p>src/index.js</p>
<pre><code class="lang-diff">ReactDOM.render(
    <router>
        <div>
+            <route exact="{true}" path="/" component="{Home}">
            <route path="/user" component="{User}">
          <route path="/profile" component="{Profile}/">
        </route></route></route></div>
    </router>
,document.getElementById(&apos;root&apos;));
</code></pre>
<h3 id="t216.2  Route.js">6.2  Route.js <a href="#t216.2  Route.js"> # </a></h3>
<p>src/react-router-dom/Route.js</p>
<pre><code class="lang-diff">export default class Route extends Component{
    render() {
+        let {path,component: Component,exact=false}=this.props;
+        let regexp=pathToRegexp(path,[],{end:exact});
        return (
            <consumer>
                {
                    value =&gt; {
                        let {pathname}=value.location;
                        if (regexp.test(pathname)) {
                            return <component>
                        } else {
                            return null;
                        }
                    }
                }
            </component></consumer>
        )
    }
}
</code></pre>
<h2 id="t227. Link">7. Link <a href="#t227. Link"> # </a></h2>
<h3 id="t237.1 Link.js">7.1 Link.js <a href="#t237.1 Link.js"> # </a></h3>
<p>src/react-router-dom/Link.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Consumer} from &apos;./context&apos;;
export default class Link extends Component{
    render() {
        return (
            <consumer>
                {
                    value =&gt; {
                        let {history: {push}}=value;
                        return (
                            <a onclick="{()=">push(this.props.to)}&gt;{this.props.children}</a>
                        )
                    }
                }
            </consumer>
        )
    }
}
</code></pre>
<h3 id="t247.2 index.js">7.2 index.js <a href="#t247.2 index.js"> # </a></h3>
<p>src/index.js</p>
<pre><code class="lang-js">import &apos;bootstrap/dist/css/bootstrap.css&apos;
ReactDOM.render(
    <router>
        <div>
            <nav classname="navbar navbar-inverse">
                <div classname="container-fluid">
                    <div classname="navbar-header">
                        <a classname="navbar-brand">&#x5B66;&#x751F;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;</a>
                    </div>
                    <div id="navbar" classname="collapse navbar-collapse">
                        <ul classname="nav navbar-nav">
                            <li><link to="/">Home</li>
                            <li><link to="/user">User</li>
                            <li><link to="/profile">Profile</li>
                        </ul>
                    </div>
                </div>
            </nav>
            <div classname="container">
                <route exact="{true}" path="/" component="{Home}">
                <route path="/user" component="{User}">
                <route path="/profile" component="{Profile}/">
            </route></route></route></div>
        </div>
    </router>
,document.getElementById(&apos;root&apos;));
</code></pre>
<h3 id="t257.3 HashRouter.js">7.3 HashRouter.js <a href="#t257.3 HashRouter.js"> # </a></h3>
<p>src/react-router-dom/HashRouter.js</p>
<pre><code class="lang-js">    render() {
        let value={
            location: this.state.location,
            history: {
                push(to) {
                    window.location.hash=to;
                }
            }
        }
        return (
            <provider value="{value}">
                {this.props.children}
            </provider>
        )
    }
</code></pre>
<h2 id="t268.Redirect&amp;Switch">8.Redirect&amp;Switch <a href="#t268.Redirect&amp;Switch"> # </a></h2>
<h3 id="t278.1 index.js">8.1 index.js <a href="#t278.1 index.js"> # </a></h3>
<p>src/index.js</p>
<pre><code class="lang-js"><div classname="container">
                <switch>
                    <route exact="{true}" path="/" component="{Home}">
                    <route path="/user" component="{User}">
                    <route path="/profile" component="{Profile}">
                    <redirect to="/">
                </redirect></route></route></route></switch>
            </div>
</code></pre>
<h3 id="t288.2 Redirect.js">8.2 Redirect.js <a href="#t288.2 Redirect.js"> # </a></h3>
<p>src/react-router-dom/Redirect.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Consumer} from &apos;./context&apos;;
export default class Redirect extends Component{
    render() {
        return (
            <consumer>
                {
                    value =&gt; {
                        value.history.push(this.props.to);
                        return null;
                    }
                }
            </consumer>
        )
    }
}
</code></pre>
<h3 id="t298.3  Switch.js">8.3  Switch.js <a href="#t298.3  Switch.js"> # </a></h3>
<p>src/react-router-dom/Switch.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Consumer} from &apos;./context&apos;;
import pathToRegexp from &apos;path-to-regexp&apos;;
export default class Switch extends Component{
    render() {
        return (
            <consumer>
                {
                    value =&gt; {
                        let {location: {pathname}}=value;
                        let children=this.props.children;
                        for (let i=0;i<children.length;i++){ let="" child="children[i];" {path="/" ,exact="false}=child.props;" regexp="pathToRegexp(path,[],{end:" exact});="" if="" (regexp.test(pathname))="" {="" return="" child;="" }="" null;="" <="" consumer="">
        )
    }
}
</children.length;i++){></consumer></code></pre>
<h2 id="t309.&#x9875;&#x9762;&#x8DF3;&#x8F6C;">9.&#x9875;&#x9762;&#x8DF3;&#x8F6C; <a href="#t309.&#x9875;&#x9762;&#x8DF3;&#x8F6C;"> # </a></h2>
<h3 id="t319.1  User.js">9.1  User.js <a href="#t319.1  User.js"> # </a></h3>
<p> src/components/User.js</p>
<pre><code class="lang-js"> <switch>
    <route path="/user/add" component="{UserAdd}">
    <route path="/user/list" component="{UserList}">
    <route path="/user/detail/:id" component="{UserDetail}/">
</route></route></route></switch>
</code></pre>
<h3 id="t329.2 HashRouter.js">9.2 HashRouter.js <a href="#t329.2 HashRouter.js"> # </a></h3>
<p>src/react-router-dom/HashRouter.js</p>
<pre><code class="lang-js">    render() {
        let value={
            location: this.state.location,
            history: {
                push(to) {
                    window.location.hash=to;
                }
            }
        }
        return (
            <provider value="{value}">
                {this.props.children}
            </provider>
        )
    }
</code></pre>
<h3 id="t339.3  Route.js">9.3  Route.js <a href="#t339.3  Route.js"> # </a></h3>
<p>src/react-router-dom/Route.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Consumer} from &apos;./context&apos;;
import pathToRegexp from &apos;path-to-regexp&apos;;
export default class Route extends Component{
    constructor(props) {
        super(props);
    }
    render() {
        let {path,component: Component,exact=false}=this.props;
        return (
            <consumer>
                {
                    value =&gt; {
                        let {pathname}=value.location;
                        let keys=[];
                        let regexp=pathToRegexp(path,keys,{end: exact});
                        keys = keys.map(item=&gt;item.name)
                        let result=pathname.match(regexp);
                        if (result) {
                            let [,...values]=result;
                            let match={
                                params: keys.reduce((params,key,idx) =&gt; {
                                    params[key]=values[idx];
                                    return params;
                                },{}),
                                path,
                                url: pathname
                            };

                            let props={
                                location: value.location,
                                history: value.history,
                                match
                            }
                            return <component {...props}="">
                        } else {
                            return null;
                        }
                    }
                }
            </component></consumer>
        )
    }
}
</code></pre>
<h3 id="t349.4  Switch.js">9.4  Switch.js <a href="#t349.4  Switch.js"> # </a></h3>
<p>src/react-router-dom/Switch.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Consumer} from &apos;./context&apos;;
import pathToRegexp from &apos;path-to-regexp&apos;;
export default class Switch extends Component{
    render() {
        return (
            <consumer>
                {
                    value =&gt; {
                        let {location: {pathname}}=value;
                        let children=this.props.children;
                        for (let i=0;i<children.length;i++){ let="" child="children[i];" {path="/" ,exact="false}=child.props;" regexp="pathToRegexp(path,[],{end:" exact});="" if="" (regexp.test(pathname))="" {="" return="" child;="" }="" null;="" <="" consumer="">
        )
    }
}
</children.length;i++){></consumer></code></pre>
<h3 id="t359.5  UserAdd.js">9.5  UserAdd.js <a href="#t359.5  UserAdd.js"> # </a></h3>
<p>src/components/UserAdd.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class UserAdd extends Component{
    handleSubmit=(event) =&gt; {
        event.preventDefault();
        let username=this.username.value;
        let email=this.email.value;
        let user={username,email};
        let usersStr=localStorage.getItem(&apos;users&apos;);
        let users=usersStr? JSON.parse(usersStr):[];
        user.id = users.length&gt;0? users[users.length-1].id+1:1;
        users.push(user);
        localStorage.setItem(&apos;users&apos;,JSON.stringify(users));
        this.props.history.push(&apos;/user/list&apos;);
    }
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <form onsubmit="{this.handleSubmit}">
                        <div classname="form-group">
                            <label htmlfor="username">&#x7528;&#x6237;&#x540D;</label>
                            <input type="text" classname="form-control" ref="{input=">this.username = input}/&gt;
                        </div>
                        <div classname="form-group">
                            <label htmlfor="email">&#x90AE;&#x7BB1; </label>
                            <input type="email" classname="form-control" ref="{input=">this.email = input}/&gt;
                        </div>
                        <div classname="form-group">
                            <input type="submit" classname="btn btn-primary">
                        </div>
                    </form>
                </div>
            </div>
        )
    }
}
</code></pre>
<h3 id="t369.6 UserDetail.js">9.6 UserDetail.js <a href="#t369.6 UserDetail.js"> # </a></h3>
<p>src/components/UserDetail.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class UserList extends Component{
    state={
        user: {}
    }
    componentDidMount() {
        let usersStr=localStorage.getItem(&apos;users&apos;);
        let users=usersStr? JSON.parse(usersStr):[];
        let user = users.find(user =&gt; user.id==this.props.match.params.id);
        this.setState({user});
    }    
    render() {
        let {user}=this.state;
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <div>ID:{user.id}</div>
                    <div>&#x7528;&#x6237;&#x540D;:{user.username}</div>
                    <div>&#x90AE;&#x7BB1;:{user.email}</div>
                </div>
            </div>
        )
    }
}
</code></pre>
<h3 id="t379.7 UserList.js">9.7 UserList.js <a href="#t379.7 UserList.js"> # </a></h3>
<p>src/components/UserList.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Link} from &apos;../react-router-dom&apos;;
export default class UserList extends Component{
    state={
        users:[]
    }
    componentDidMount() {
        let usersStr=localStorage.getItem(&apos;users&apos;);
        let users=usersStr? JSON.parse(usersStr):[];
        this.setState({users});
    }
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <ul classname="list-group">
                        {
                            this.state.users.map(user =&gt; (
                                <li classname="list-group-item" key="{user.id}">
                                    <link to="{`/user/detail/${user.id}`}">{user.username}
                                </li>
                            ))
                        }
                    </ul>
                </div>
            </div>
        )
    }
}
</code></pre>
<h2 id="t3810. &#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x8DEF;&#x7531;">10. &#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x8DEF;&#x7531; <a href="#t3810. &#x53D7;&#x4FDD;&#x62A4;&#x7684;&#x8DEF;&#x7531;"> # </a></h2>
<h3 id="t3910.1 src/index.js">10.1 src/index.js <a href="#t3910.1 src/index.js"> # </a></h3>
<pre><code class="lang-diff">                <switch>
                    <route exact="{true}" path="/" component="{Home}">
                    <route path="/user" component="{User}">
+                    <route path="/login" component="{Login}">
+                    <protected path="/profile" component="{Profile}">
                    <redirect to="/">
                </redirect></protected></route></route></route></switch>
</code></pre>
<h3 id="t4010.2 HashRouter.js">10.2 HashRouter.js <a href="#t4010.2 HashRouter.js"> # </a></h3>
<p>src/react-router-dom/HashRouter.js</p>
<pre><code class="lang-diff">render() {
        let self=this;
        let value={
            location: self.state.location,
            history: {
+                push(to) {
+                    if (typeof to == &apos;object&apos;) {
+                        let {pathname,state}=to;
+                        self.setState({
+                            location: {
+                                ...self.state.location,state,pathname
+                            }
+                        },() =&gt; {
+                            window.location.hash=pathname;
+                        });
+                    } else {
+                        window.location.hash=to;
+                    }                    
+                }
+            }
        }
        return (
            <provider value="{value}">
                {this.props.children}
            </provider>
        )
    }
</code></pre>
<h3 id="t4110.3 Route.js">10.3 Route.js <a href="#t4110.3 Route.js"> # </a></h3>
<p> src/react-router-dom/Route.js</p>
<pre><code class="lang-diff">+                             if (Component) {
+                                return <component {...props}=""> 
+                            } else if (render) {
+                                return render(props);
+                            } else {
+                                return null;
+                            }
</component></code></pre>
<h3 id="t4210.4 Login.js">10.4 Login.js <a href="#t4210.4 Login.js"> # </a></h3>
<p>src/components/Login.js</p>
<pre><code class="lang-diff">+ import React from &apos;react&apos;
+ export default class Login extends React.Component{
+    handleClick=() =&gt; {
+        localStorage.setItem(&apos;logined&apos;,true);
+        this.props.history.push(this.props.location.state.from);
+    }
+    render() {
+        return (
+            <div>
+                <button +="" classname="btn btn-primary" onclick="{this.handleClick}">&#x767B;&#x5F55;</button>
+            </div>
+        )
+    }
+}
</code></pre>
<h3 id="t4310.5 Protected.js">10.5 Protected.js <a href="#t4310.5 Protected.js"> # </a></h3>
<p> src/components/Protected.js</p>
<pre><code class="lang-diff">+ import React from &apos;react&apos;
+ import {Route,Redirect} from &apos;../react-router-dom&apos;;
+ export default ({component:Component,...rest}) =&gt; (
+     <route +="" {...rest}="" render="{" props=""> (
+                 localStorage.getItem(&apos;logined&apos;)?
+                     <component {...props}="">:
+                     <redirect to="{{pathname:" '="" login',state:="" {from:="" props.location.pathname}}}="">
+             )
+         }
+     /&gt;
+ )
</redirect></component></route></code></pre>
<h2 id="t4411. &#x81EA;&#x5B9A;&#x4E49;&#x5BFC;&#x822A;">11. &#x81EA;&#x5B9A;&#x4E49;&#x5BFC;&#x822A; <a href="#t4411. &#x81EA;&#x5B9A;&#x4E49;&#x5BFC;&#x822A;"> # </a></h2>
<h3 id="t4511.1 index.js">11.1 index.js <a href="#t4511.1 index.js"> # </a></h3>
<p>src/index.js</p>
<pre><code class="lang-js"><ul classname="nav navbar-nav">
+    <menulink exact="" to="/">Home</menulink>
+    <menulink to="/user">User</menulink>
+    <menulink to="/profile">Profile</menulink>
</ul>
</code></pre>
<h3 id="t4611.2  Route.js">11.2  Route.js <a href="#t4611.2  Route.js"> # </a></h3>
<p> src/react-router-dom/Route.js</p>
<pre><code class="lang-js"> let props={
                            location: value.location,
                            history: value.history
                        }
                        if (result) {
                            let [,...values]=result;
                            let match={
                                params: keys.reduce((params,key,idx) =&gt; {
                                    params[key]=values[idx];
                                    return params;
                                },{}),
                                path,
                                url: pathname
                            };

                            props.match = match;
                            if (Component) {
                                return <component {...props}=""> 
                            } else if (render) {
                                return render(props);
                            } else if(children){
                                return children(props);
                            }else {
                              return null;
                            }
                        } else if(children){
                            return children(props);
                        } else {
                            return null;
                        }
</component></code></pre>
<h3 id="t4711.3 MenuLink.js">11.3 MenuLink.js <a href="#t4711.3 MenuLink.js"> # </a></h3>
<pre><code class="lang-js">import React from &apos;react&apos;
import {Route,Link} from &apos;../react-router-dom&apos;;
import &apos;./MenuLink.css&apos;
export default ({to,exact,children}) =&gt; (
    <route path="{to}" exact="{exact}" children="{" props=""> (
                <li classname="{props.match?&apos;active&apos;:&apos;&apos;}"><link to="{to}">{children}</li>
            )
        }
    /&gt;
)
</route></code></pre>
<h3 id="t4811.4  MenuLink.css">11.4  MenuLink.css <a href="#t4811.4  MenuLink.css"> # </a></h3>
<pre><code class="lang-js">.navbar-inverse .navbar-nav &gt; .active &gt; a{
    background-color: orange;
}
</code></pre>
<h2 id="t4912. &#x9632;&#x6B62;&#x8DF3;&#x8F6C;">12. &#x9632;&#x6B62;&#x8DF3;&#x8F6C; <a href="#t4912. &#x9632;&#x6B62;&#x8DF3;&#x8F6C;"> # </a></h2>
<h3 id="t5012.1 UserAdd.js">12.1 UserAdd.js <a href="#t5012.1 UserAdd.js"> # </a></h3>
<p>src/components/UserAdd.js</p>
<pre><code class="lang-diff">import React,{Component} from &apos;react&apos;;
import {Prompt} from &apos;../react-router-dom&apos;;
export default class UserAdd extends Component{
+    state={
+        isBlocking:false
+    }
    handleSubmit=(event) =&gt; {
+        event.preventDefault();
+        this.setState({
+            isBlocking:false
+        },() =&gt; {
            let username=this.username.value;
            let email=this.email.value;
            let user={username,email};
            let usersStr=localStorage.getItem(&apos;users&apos;);
            let users=usersStr? JSON.parse(usersStr):[];
            user.id = users.length&gt;0? users[users.length-1].id+1:1;
            users.push(user);
            localStorage.setItem(&apos;users&apos;,JSON.stringify(users));
            this.props.history.push(&apos;/user/list&apos;);
        });
    }
    render() {
+        let {isBlocking}=this.state;
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <form onsubmit="{this.handleSubmit}">
+                        <prompt +="" when="{isBlocking}" message="{" location="">`&#x4F60;&#x786E;&#x5B9A;&#x8981;&#x8DF3;&#x8F6C;&#x5230;${location.pathname}&#x5417;&#xFF1F;`
+                            }
+                        /&gt;
                        <div classname="form-group">
                            <label htmlfor="username">&#x7528;&#x6237;&#x540D;</label>
                            <input type="text" onchange="{" event=""> this.setState({isBlocking:event.target.value.length&gt;0})
                                }
                                className=&quot;form-control&quot; ref={input =&gt; this.username=input} /&gt;
                        </div>
                        <div classname="form-group">
                            <label htmlfor="email">&#x90AE;&#x7BB1; </label>
                            <input onchange="{" event=""> this.setState({isBlocking:event.target.value.length&gt;0})
                                }
                                type=&quot;email&quot; className=&quot;form-control&quot; ref={input =&gt; this.email=input} /&gt;
                        </div>
                        <div classname="form-group">
                            <input type="submit" classname="btn btn-primary">
                        </div>
                    
                </prompt></form></div>
            </div>
        )
    }
}
</code></pre>
<h3 id="t5112.2  HashRouter.js">12.2  HashRouter.js <a href="#t5112.2  HashRouter.js"> # </a></h3>
<p>src/react-router-dom/HashRouter.js</p>
<pre><code class="lang-diff">let value={
            location: self.state.location,
            history: {
                push(to) {
+                    if (self.block) {
+                        let allow=window.confirm(self.block(typeof to==&apos;object&apos;? to:{pathname:to}));
+                        if (!allow) return;
+                    }
                    if (typeof to == &apos;object&apos;) {
                        let {pathname,state}=to;
                        self.setState({
                            location: {
                                ...self.state.location,state,pathname
                            }
                        },() =&gt; {
                            window.location.hash=pathname;
                        });
                    } else {
                        window.location.hash=to;
                    }

                },
+                block(message) {
+                    self.block=message;
+                },
+                unblock() {
+                    self.block=null;
+                }
            }
        }
</code></pre>
<h3 id="t5212.3 Prompt.js">12.3 Prompt.js <a href="#t5212.3 Prompt.js"> # </a></h3>
<p> src/react-router-dom/Prompt.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;
import {Consumer} from &apos;./context&apos;
export default class Prompt extends React.Component{
    componentWillUnmount() {
        this.history.unblock();
    }
    render() {
        return (
            <consumer>
                {
                    value =&gt; {
                        this.history=value.history;
                        const {when,message}=this.props;
                        if (when) {
                            this.history.block(message);
                        } else {
                            this.history.block(null);
                        }
                    }
                }
            </consumer>
        );
    }
}
</code></pre>
<h2 id="t5313. withRouter">13. withRouter <a href="#t5313. withRouter"> # </a></h2>
<h3 id="t5413.1 index.js">13.1 index.js <a href="#t5413.1 index.js"> # </a></h3>
<p>rc/index.js</p>
<pre><code class="lang-diff">    <div classname="container-fluid">
+                    <header>
                    <div id="navbar" classname="collapse navbar-collapse">
</div></header></div></code></pre>
<h3 id="t5513.2 Route.js">13.2 Route.js <a href="#t5513.2 Route.js"> # </a></h3>
<p>src/react-router-dom/Route.js</p>
<pre><code class="lang-js">+    let {path=&apos;/&apos;,component: Component,exact=false,render,children}=this.props;
        return (
            <consumer>
</consumer></code></pre>
<h3 id="t5613.3 index.js">13.3 index.js <a href="#t5613.3 index.js"> # </a></h3>
<p>src/react-router-dom/index.js</p>
<pre><code class="lang-diff">+import withRouter from &apos;./withRouter&apos;;
export {
    HashRouter,
    Route,
    Link,
    Redirect,
    Switch,
    Prompt,
+    withRouter
}
</code></pre>
<h3 id="t5713.4 Header.js">13.4 Header.js <a href="#t5713.4 Header.js"> # </a></h3>
<p>src/components/Header.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;
import {withRouter} from &apos;../react-router-dom&apos;;
class Header extends React.Component{
    render() {
        return (
            <div classname="navbar-header">
                <a onclick="{()=">this.props.history.push(&apos;/&apos;)}
                    className=&quot;navbar-brand&quot; &gt;
                   &#x5B66;&#x751F;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;
                </a>
            </div>
        )
    }
}
export default withRouter(Header);
</code></pre>
<h3 id="t5813.5 withRouter.js">13.5 withRouter.js <a href="#t5813.5 withRouter.js"> # </a></h3>
<p>src/react-router-dom/withRouter.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;
import {Consumer} from &apos;./context&apos;;
import Route from &apos;./Route&apos;;
export default function (Component) {
    class Proxy extends React.Component{
        render() {
            return (
                <consumer>
                    {
                        value =&gt; {
                            return <route component="{Component}/">
                        }
                    }
               </route></consumer>
            )
        }
    }
    return Proxy;
}
</code></pre>
<ul>
<li><a href="https://gitee.com/zhufengpeixun/router4">router4</a></li>
</ul>

        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    