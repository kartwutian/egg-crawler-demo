
        <h2 id="t01. &#x4EC0;&#x4E48;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;">1. &#x4EC0;&#x4E48;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3; <a href="#t01. &#x4EC0;&#x4E48;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;"> # </a></h2>
<h3 id="t11.1 &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;">1.1 &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3; <a href="#t11.1 &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;"> # </a></h3>
<p>&#x9875;&#x9762;&#x4E0A;&#x7684;&#x5185;&#x5BB9;&#x662F;&#x7531;&#x670D;&#x52A1;&#x5668;&#x751F;&#x4EA7;&#x7684;</p>
<pre><code class="lang-js">cnpm i express -S
</code></pre>
<pre><code class="lang-js">let express=require(&apos;express&apos;);
let app=express();
app.get(&apos;/&apos;,(req,res) =&gt; {
    res.send(`
        
          
            <div id="root">hello</div>
          
        
    `);
});
app.listen(8080);
</code></pre>
<h3 id="t21.2 &#x5BA2;&#x6237;&#x7AEF;&#x6E32;&#x67D3;">1.2 &#x5BA2;&#x6237;&#x7AEF;&#x6E32;&#x67D3; <a href="#t21.2 &#x5BA2;&#x6237;&#x7AEF;&#x6E32;&#x67D3;"> # </a></h3>
<p>&#x9875;&#x9762;&#x4E0A;&#x7684;&#x5185;&#x5BB9;&#x7531;&#x4E8E;&#x6D4F;&#x89C8;&#x5668;&#x8FD0;&#x884C;JS&#x811A;&#x672C;&#x800C;&#x6E32;&#x67D3;&#x5230;&#x9875;&#x9762;&#x4E0A;&#x7684;</p>
<ul>
<li>&#x6D4F;&#x89C8;&#x5668;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x7A7A;&#x7684;HTML&#x9875;&#x9762;&#xFF0C;&#x91CC;&#x9762;&#x6709;&#x4E00;&#x4E2A;JS&#x8D44;&#x6E90;&#x94FE;&#x63A5;&#xFF0C;&#x6BD4;&#x5982;bundle.js</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x4E0B;&#x8F7D;JS&#x4EE3;&#x7801;&#x5E76;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x8FD0;&#x884C;</li>
<li>&#x5185;&#x5BB9;&#x5448;&#x73B0;&#x5728;&#x9875;&#x9762;&#x4E0A;</li>
</ul>
<pre><code class="lang-js">cnpm i react react-dom -S
cnpm i webpack webpack-cli -D
cnpm i babel-loader @babel/core -D
cnpm i @babel/preset-env @babel/preset-react  -D
cnpm i webpack-node-externals -D
</code></pre>
<pre><code class="lang-js">let express=require(&apos;express&apos;);
let app=express();
app.get(&apos;/&apos;,(req,res) =&gt; {
    res.send(`
        
          
            <div id="root"></div>
            <script>
                document.getElementById('root').innerHTML = 'hello';
            </script>
          
        
    `);
});
app.listen(9090);
</code></pre>
<h2 id="t32. &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6253;&#x5305;React&#x7EC4;&#x4EF6;">2. &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6253;&#x5305;React&#x7EC4;&#x4EF6; <a href="#t32. &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6253;&#x5305;React&#x7EC4;&#x4EF6;"> # </a></h2>
<h3 id="t42.1 &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;React&#x7EC4;&#x4EF6;&#x6D41;&#x7A0B;">2.1 &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;React&#x7EC4;&#x4EF6;&#x6D41;&#x7A0B; <a href="#t42.1 &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;React&#x7EC4;&#x4EF6;&#x6D41;&#x7A0B;"> # </a></h3>
<ul>
<li><ol>
<li>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x9001;&#x8BF7;&#x6C42;</li>
</ol>
</li>
<li><ol start="2">
<li>&#x670D;&#x52A1;&#x5668;&#x8FD0;&#x884C;React&#x4EE3;&#x7801;&#x751F;&#x6210;&#x9875;&#x9762;</li>
</ol>
</li>
<li><ol start="3">
<li>&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;&#x9875;&#x9762;</li>
</ol>
</li>
</ul>
<h3 id="t52.2 webpack.config.js">2.2 webpack.config.js <a href="#t52.2 webpack.config.js"> # </a></h3>
<p>server/webpack.config.js</p>
<pre><code class="lang-js">//&#x6D4F;&#x89C8;&#x5668; &#x670D;&#x52A1;&#x5668;&#x7AEF;
let path = require(&apos;path&apos;);
let nodeExternals=require(&apos;webpack-node-externals&apos;);
module.exports = {
    target: &apos;node&apos;,//&#x6253;&#x5305;&#x7684;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7AEF;node&#x6587;&#x4EF6;
    mode:&apos;development&apos;,//&#x5F00;&#x53D1;&#x6A21;&#x5F0F;
    output:{
        path:path.resolve(__dirname,&apos;build&apos;),
        filename:&apos;bundle.js&apos;
    },
    externals:[nodeExternals()],
    module:{
        rules:[
            {
                test:/\.js$/,
                loader: &apos;babel-loader&apos;,
                exclude: /node_modules/,
                options: {
                    presets: [
                        [
                            &quot;@babel/preset-env&quot;,{
                                targets: {
                                    browsers:[&apos;last 2 versions&apos;]
                                }
                            }
                        ],&quot;@babel/preset-react&quot;
                    ]
                }
            }
        ]
    }
}
</code></pre>
<h3 id="t62.3 server/src/index.js">2.3 server/src/index.js <a href="#t62.3 server/src/index.js"> # </a></h3>
<p>server/src/index.js</p>
<pre><code class="lang-js">import Home from &apos;./containers/Home&apos;;
let express=require(&apos;express&apos;);
let app=express();
app.get(&apos;/&apos;,(req,res) =&gt; {
    res.send(`
        
          
            <div id="root"></div>
            <script>
                document.getElementById('root').innerHTML = 'hello';
            </script>
          
        
    `);
});
app.listen(9090);
</code></pre>
<h3 id="t72.4 Home/index.js">2.4 Home/index.js <a href="#t72.4 Home/index.js"> # </a></h3>
<p>server/src/containers/Home/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class Home extends Component{
    render() {
        return <div>Home</div>
    }
}
</code></pre>
<h2 id="t83. &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;">3. &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3; <a href="#t83. &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;"> # </a></h2>
<h3 id="t93.1  server/webpack.config.js">3.1  server/webpack.config.js <a href="#t93.1  server/webpack.config.js"> # </a></h3>
<p>server/webpack.config.js</p>
<pre><code class="lang-js">//&#x6D4F;&#x89C8;&#x5668; &#x670D;&#x52A1;&#x5668;&#x7AEF;
let path = require(&apos;path&apos;);
let nodeExternals=require(&apos;webpack-node-externals&apos;);
module.exports = {
    target: &apos;node&apos;,//&#x6253;&#x5305;&#x7684;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7AEF;node&#x6587;&#x4EF6;
    mode: &apos;development&apos;,//&#x5F00;&#x53D1;&#x6A21;&#x5F0F;
    entry:path.resolve(__dirname,&apos;./src/index.js&apos;),
    output:{
        path:path.resolve(__dirname,&apos;build&apos;),
        filename:&apos;bundle.js&apos;
    },
    externals:[nodeExternals()],
    module:{
        rules:[
            {
                test:/\.js$/,
                loader: &apos;babel-loader&apos;,
                exclude: /node_modules/,
                options: {
                    presets: [
                        &quot;@babel/preset-env&quot;,
                        &quot;@babel/preset-react&quot;
                    ]
                }
            }
        ]
    }
}
</code></pre>
<h3 id="t103.2 server/src/index.js">3.2 server/src/index.js <a href="#t103.2 server/src/index.js"> # </a></h3>
<p>server/src/index.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;;
import Home from &apos;./containers/Home&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import express from &apos;express&apos;;
let app=express();
const html=renderToString(<home>);
app.get(&apos;/&apos;,(req,res) =&gt; {
    res.send(`
    
        
        <div id="root">
          ${html}
        </div>
        
    
    `);
});
app.listen(9090);
</home></code></pre>
<h3 id="t113.3 package.json">3.3 package.json <a href="#t113.3 package.json"> # </a></h3>
<p>package.json</p>
<pre><code class="lang-json">&quot;scripts&quot;: {
    &quot;start&quot;: &quot;node ./server/build/bundle.js&quot;,
    &quot;build&quot;:&quot;webpack --config server/webpack.config.js&quot;
}
</code></pre>
<h2 id="t124. &#x4F18;&#x5316;&#x542F;&#x52A8;&#x6D41;&#x7A0B;">4. &#x4F18;&#x5316;&#x542F;&#x52A8;&#x6D41;&#x7A0B; <a href="#t124. &#x4F18;&#x5316;&#x542F;&#x52A8;&#x6D41;&#x7A0B;"> # </a></h2>
<h3 id="t134.1 &#x5B89;&#x88C5;nodemon">4.1 &#x5B89;&#x88C5;nodemon <a href="#t134.1 &#x5B89;&#x88C5;nodemon"> # </a></h3>
<pre><code class="lang-js">cnpm i nodemon -g
</code></pre>
<h3 id="t144.2 package.json">4.2 package.json <a href="#t144.2 package.json"> # </a></h3>
<pre><code class="lang-json">&quot;scripts&quot;: {
    &quot;dev&quot;:&quot;npm-run-all --parallel dev:**&quot;,
    &quot;dev:start&quot;:&quot;nodemon &apos;./server/build/bundle.js&apos;&quot;,
    &quot;dev:build&quot;:&quot;webpack --config server/webpack.config.js --watch&quot;
}
</code></pre>
<h3 id="t154.3 npm-run-all">4.3 npm-run-all <a href="#t154.3 npm-run-all"> # </a></h3>
<pre><code class="lang-js">cnpm npm-run-all -g
</code></pre>
<h2 id="t165. &#x8BA1;&#x6570;&#x5668;&#x7EC4;&#x4EF6;">5. &#x8BA1;&#x6570;&#x5668;&#x7EC4;&#x4EF6; <a href="#t165. &#x8BA1;&#x6570;&#x5668;&#x7EC4;&#x4EF6;"> # </a></h2>
<ul>
<li>&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8FD0;&#x884C;React&#x4EE3;&#x7801;&#x6E32;&#x67D3;&#x51FA;HTML</li>
<li>&#x670D;&#x52A1;&#x5668;&#x628A;&#x6E32;&#x67D3;&#x51FA;&#x7684;HTML&#x9875;&#x9762;&#x53D1;&#x9001;&#x7ED9;&#x4E86;&#x6D4F;&#x89C8;&#x5668;</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x63A5;&#x53D7;&#x5230;HTML&#x4F1A;&#x6E32;&#x67D3;&#x5230;&#x9875;&#x9762;&#x4E0A;</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x73B0;&#x9875;&#x9762;&#x5F15;&#x7528;&#x7684;index.js&#x6587;&#x4EF6;&#x4F1A;&#x53BB;&#x4E0B;&#x8F7D;</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x4E0B;&#x8F7D;&#x5F97;&#x5230;&#x7684;index.js&#x6587;&#x4EF6;&#x5E76;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x6267;&#x884C;</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x7684;&#x4EE3;&#x7801;&#x63A5;&#x7BA1;&#x4E86;&#x9875;&#x9762;&#x7684;&#x6240;&#x6709;&#x5185;&#x5BB9;&#xFF0C;&#x540E;&#x9762;&#x548C;&#x5BA2;&#x6237;&#x7AEF;&#x6E32;&#x67D3;&#x662F;&#x4E00;&#x6837;&#x7684;</li>
</ul>
<h3 id="t175.1 src/client/index.js">5.1 src/client/index.js <a href="#t175.1 src/client/index.js"> # </a></h3>
<p>src/client/index.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import Counter from &apos;../containers/Counter&apos;;

ReactDOM.hydrate(<counter>,document.querySelector(&apos;#root&apos;));
</counter></code></pre>
<h3 id="t185.2 Counter/index.js">5.2 Counter/index.js <a href="#t185.2 Counter/index.js"> # </a></h3>
<p>src/containers/Counter/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class Counter extends Component{
    state={number:0}
    render() {
        return (
            <div>
                <p>{this.state.number}</p>
                <button onclick="{()=">this.setState({number:this.state.number+1})}&gt;+</button>
            </div>
        )
    }
}
</code></pre>
<h3 id="t195.3 webpack.client.js">5.3 webpack.client.js <a href="#t195.3 webpack.client.js"> # </a></h3>
<p>webpack.client.js</p>
<pre><code class="lang-js">//&#x6D4F;&#x89C8;&#x5668; &#x670D;&#x52A1;&#x5668;&#x7AEF;
let path = require(&apos;path&apos;);
module.exports = {
    mode: &apos;development&apos;,//&#x5F00;&#x53D1;&#x6A21;&#x5F0F;
    entry:path.resolve(__dirname,&apos;./src/client/index.js&apos;),
    output:{
        path:path.resolve(__dirname,&apos;public&apos;),
        filename:&apos;index.js&apos;
    },
    module:{
        rules:[
            {
                test:/\.js$/,
                loader: &apos;babel-loader&apos;,
                exclude: /node_modules/,
                options: {
                    presets: [
                        &quot;@babel/preset-env&quot;,
                        &quot;@babel/preset-react&quot;
                    ],
                    plugins: [
                        &quot;@babel/plugin-proposal-class-properties&quot;
                    ]
                }
            }
        ]
    }
}
</code></pre>
<h2 id="t206. &#x4F18;&#x5316;&#x4EE3;&#x7801;&#x7ED3;&#x6784;">6. &#x4F18;&#x5316;&#x4EE3;&#x7801;&#x7ED3;&#x6784; <a href="#t206. &#x4F18;&#x5316;&#x4EE3;&#x7801;&#x7ED3;&#x6784;"> # </a></h2>
<h3 id="t216.1 webpack.base.js">6.1 webpack.base.js <a href="#t216.1 webpack.base.js"> # </a></h3>
<pre><code class="lang-js">//&#x6D4F;&#x89C8;&#x5668; &#x670D;&#x52A1;&#x5668;&#x7AEF;
let path = require(&apos;path&apos;);
module.exports = {
    mode: &apos;development&apos;,
    module:{
        rules:[
            {
                test:/\.js$/,
                loader: &apos;babel-loader&apos;,
                exclude: /node_modules/,
                options: {
                    presets: [
                        &quot;@babel/preset-env&quot;,
                        &quot;@babel/preset-react&quot;
                    ],
                    plugins: [
                        &quot;@babel/plugin-proposal-class-properties&quot;
                    ]
                }
            }
        ]
    }
}
</code></pre>
<h3 id="t226.2 webpack.client.js">6.2 webpack.client.js <a href="#t226.2 webpack.client.js"> # </a></h3>
<p>webpack.client.js</p>
<pre><code class="lang-js">//&#x6D4F;&#x89C8;&#x5668; &#x670D;&#x52A1;&#x5668;&#x7AEF;
let path=require(&apos;path&apos;);
const merge=require(&apos;webpack-merge&apos;);
const base=require(&apos;./webpack.base&apos;);
module.exports = merge(base,{
    mode: &apos;development&apos;,//&#x5F00;&#x53D1;&#x6A21;&#x5F0F;
    entry:path.resolve(__dirname,&apos;./src/client/index.js&apos;),
    output:{
        path:path.resolve(__dirname,&apos;public&apos;),
        filename:&apos;index.js&apos;
    }
}) 
</code></pre>
<h3 id="t236.3 webpack.server.js">6.3 webpack.server.js <a href="#t236.3 webpack.server.js"> # </a></h3>
<p>webpack.server.js</p>
<pre><code class="lang-js">//&#x6D4F;&#x89C8;&#x5668; &#x670D;&#x52A1;&#x5668;&#x7AEF;
let path=require(&apos;path&apos;);
const merge=require(&apos;webpack-merge&apos;);
const base=require(&apos;./webpack.base&apos;);
const nodeExternals=require(&apos;webpack-node-externals&apos;);
module.exports = merge(base,{
    target: &apos;node&apos;,//&#x6253;&#x5305;&#x7684;&#x662F;&#x670D;&#x52A1;&#x5668;&#x7AEF;node&#x6587;&#x4EF6;
    mode: &apos;development&apos;,//&#x5F00;&#x53D1;&#x6A21;&#x5F0F;
    entry:path.resolve(__dirname,&apos;./src/server/index.js&apos;),
    output:{
        path:path.resolve(__dirname,&apos;build&apos;),
        filename:&apos;bundle.js&apos;
    },
    externals:[nodeExternals()]
}) 
</code></pre>
<h3 id="t246.4 server/index.js">6.4 server/index.js <a href="#t246.4 server/index.js"> # </a></h3>
<p>src/server/index.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import Home from &apos;../containers/Home&apos;;
import express from &apos;express&apos;;
let app=express();
app.use(express.static(&apos;public&apos;));
const content=renderToString(<home>);
app.get(&apos;/&apos;,(req,res) =&gt; {
    res.send(`
    
    
        
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <title></title>
        
        
            <div id="root">${content}</div>
            <script src="/index.js"></script>
        
    
    `);
});
app.listen(9090);
</home></code></pre>
<h2 id="t257. &#x4F7F;&#x7528;&#x8DEF;&#x7531;">7. &#x4F7F;&#x7528;&#x8DEF;&#x7531; <a href="#t257. &#x4F7F;&#x7528;&#x8DEF;&#x7531;"> # </a></h2>
<pre><code class="lang-js">cnpm i react-router-dom -S
</code></pre>
<h3 id="t267.1 &#x5BA2;&#x6237;&#x7AEF;&#x8DEF;&#x7531;">7.1 &#x5BA2;&#x6237;&#x7AEF;&#x8DEF;&#x7531; <a href="#t267.1 &#x5BA2;&#x6237;&#x7AEF;&#x8DEF;&#x7531;"> # </a></h3>
<ul>
<li>&#x5BA2;&#x6237;&#x7AEF;&#x8BF7;&#x6C42;&#x670D;&#x52A1;&#x5668;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x8FD4;&#x56DE;HTML&#x7ED9;&#x6D4F;&#x89C8;&#x5668;&#xFF0C;&#x6D4F;&#x89C8;&#x5668;&#x6E32;&#x67D3;&#x663E;&#x793A;&#x9875;&#x9762;</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x53D1;&#x73B0;&#x9700;&#x8981;&#x5916;&#x94FE;JS&#x8D44;&#x6E90;&#xFF0C;&#x52A0;&#x8F7D;JS&#x8D44;&#x6E90;</li>
<li>&#x52A0;&#x8F7D;&#x597D;&#x7684;JS&#x8D44;&#x6E90;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7AEF;&#x6267;&#x884C;</li>
<li>JS&#x4E2D;&#x7684;Reac&#x4EE3;&#x7801;&#x5F00;&#x59CB;&#x5B9E;&#x73B0;&#x8DEF;&#x7531;&#x529F;&#x80FD;</li>
<li>&#x8DEF;&#x7531;&#x4EE3;&#x7801;&#x9996;&#x5148;&#x83B7;&#x53D6;&#x5730;&#x5740;&#x680F;&#x4E2D;&#x7684;&#x5730;&#x5740;&#xFF0C;&#x7136;&#x540E;&#x6839;&#x636E;&#x4E0D;&#x540C;&#x7684;&#x5730;&#x5740;&#x6839;&#x636E;&#x8DEF;&#x7531;&#x914D;&#x7F6E;&#x6E32;&#x67D3;&#x5BF9;&#x5E94;&#x5185;&#x5BB9;</li>
</ul>
<h3 id="t277.2 src/client/index.js">7.2 src/client/index.js <a href="#t277.2 src/client/index.js"> # </a></h3>
<p>src/client/index.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {BrowserRouter} from &apos;react-router-dom&apos;;
import routes from &apos;../routes&apos;;
ReactDOM.hydrate(
    <browserrouter>
        {routes}
    </browserrouter>
    ,document.querySelector(&apos;#root&apos;));
</code></pre>
<h3 id="t287.3 src/server/index.js">7.3 src/server/index.js <a href="#t287.3 src/server/index.js"> # </a></h3>
<p>src/server/index.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import Home from &apos;../containers/Home&apos;;
import express from &apos;express&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import routes from &apos;../routes&apos;;
let app=express();
app.use(express.static(&apos;public&apos;));
//context&#x6570;&#x636E;&#x7684;&#x4F20;&#x9012; StaticRouter&#x9700;&#x8981;&#x77E5;&#x9053;&#x5F53;&#x524D;&#x8DEF;&#x5F84;

app.get(&apos;*&apos;,(req,res) =&gt; {
    const content=renderToString(
        <staticrouter context="{{}}" location="{req.path}">
            {routes}
        </staticrouter>
    );
    res.send(`
    
    
        
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <title></title>
        
        
            <div id="root">${content}</div>
            <script src="/index.js"></script>
        
    
    `);
});
app.listen(9090);
</code></pre>
<h3 id="t297.4 src/routes.js">7.4 src/routes.js <a href="#t297.4 src/routes.js"> # </a></h3>
<p>src/routes.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import {Route} from &apos;react-router-dom&apos;;
import Home from &apos;./containers/Home&apos;;
import Counter from &apos;./containers/Counter&apos;;
export default (
    <fragment>
        <route path="/" exact="" component="{Home}"></route>
        <route path="/counter" exact="" component="{Counter}"></route>
    </fragment>
)
</code></pre>
<h2 id="t308. &#x8DF3;&#x8F6C;&#x8DEF;&#x7531;">8. &#x8DF3;&#x8F6C;&#x8DEF;&#x7531; <a href="#t308. &#x8DF3;&#x8F6C;&#x8DEF;&#x7531;"> # </a></h2>
<h3 id="t318.1 src/client/index.js">8.1 src/client/index.js <a href="#t318.1 src/client/index.js"> # </a></h3>
<p>src/client/index.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {BrowserRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
ReactDOM.hydrate(
    <browserrouter>
        <fragment>
            <header>
            <div classname="container" style="{{marginTop:50}}">
                {routes}
            </div>
        
    
    ,document.querySelector(&apos;#root&apos;));
</header></fragment></browserrouter></code></pre>
<h3 id="t328.2 /Counter/index.js">8.2 /Counter/index.js <a href="#t328.2 /Counter/index.js"> # </a></h3>
<p>src/containers/Counter/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class Counter extends Component{
    state={number:0}
    render() {
        return (
            <div>
                <p>{this.state.number}</p>
                <button classname="btn btn-primary" onclick="{()=">this.setState({number:this.state.number+1})}&gt;+</button>
            </div>
        )
    }
}
</code></pre>
<h3 id="t338.3 Home/index.js">8.3 Home/index.js <a href="#t338.3 Home/index.js"> # </a></h3>
<p>src/containers/Home/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class Home extends Component{
    render() {
        return <div>&#x9996;&#x9875;</div>
    }
}
</code></pre>
<h3 id="t348.4 src/server/index.js">8.4 src/server/index.js <a href="#t348.4 src/server/index.js"> # </a></h3>
<p>src/server/index.js</p>
<pre><code class="lang-js">import express from &apos;express&apos;;
import render from &apos;./render&apos;;
let app=express();
app.use(express.static(&apos;public&apos;));
//context&#x6570;&#x636E;&#x7684;&#x4F20;&#x9012; StaticRouter&#x9700;&#x8981;&#x77E5;&#x9053;&#x5F53;&#x524D;&#x8DEF;&#x5F84;
app.get(&apos;*&apos;,(req,res) =&gt; {
    render(req,res);
});
app.listen(9090);
</code></pre>
<h3 id="t358.5 /Header/index.js">8.5 /Header/index.js <a href="#t358.5 /Header/index.js"> # </a></h3>
<p>src/components/Header/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Link} from &apos;react-router-dom&apos;;
export default class Home extends Component{
    render() {
        return (
            <nav classname="navbar navbar-inverse navbar-fixed-top">
                    <div classname="container">
                        <div classname="navbar-header">
                            <a classname="navbar-brand" href="#">&#x73E0;&#x5CF0;SSR</a>
                        </div>
                        <div id="navbar" classname="collapse navbar-collapse">
                            <ul classname="nav navbar-nav">
                                <li><link to="/">Home</li>
                                <li><link to="/counter">Counter</li>
                            </ul>
                        </div>
                    </div>
                </nav>
        )
    }
}
</code></pre>
<h3 id="t368.6 src/server/render.js">8.6 src/server/render.js <a href="#t368.6 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
export default function (req,res) {
    const content=renderToString(
        <staticrouter context="{{}}" location="{req.path}">
                <fragment>
                    <header>
                    <div classname="container" style="{{marginTop:50}}">
                        {routes}
                    </div>
                
            
    );
    res.send(`
    
    
        
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
            <title>&#x73E0;&#x5CF0;SSR</title>
        
        
            <div id="root">${content}</div>
            <script src="/index.js"></script>
        
    
    `);
}
</header></fragment></staticrouter></code></pre>
<h2 id="t379. redux&#x8BA1;&#x6570;&#x5668;">9. redux&#x8BA1;&#x6570;&#x5668; <a href="#t379. redux&#x8BA1;&#x6570;&#x5668;"> # </a></h2>
<h3 id="t389.1 src/client/index.js">9.1 src/client/index.js <a href="#t389.1 src/client/index.js"> # </a></h3>
<p>src/client/index.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {BrowserRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {Provider} from &apos;react-redux&apos;;
import getStore from &apos;../store&apos;;
ReactDOM.hydrate(
    <provider store="{getStore()}">
        <browserrouter>
            <fragment>
                <header>
                <div classname="container" style="{{marginTop:50}}">
                    {routes}
                </div>
            
        
    
    ,document.querySelector(&apos;#root&apos;));
</header></fragment></browserrouter></provider></code></pre>
<h3 id="t399.2 Counter/index.js">9.2 Counter/index.js <a href="#t399.2 Counter/index.js"> # </a></h3>
<p>src/containers/Counter/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import actions from &apos;../../store/actions&apos;;
class Counter extends Component{
    render() {
        return (
            <div>
                <p>{this.props.number}</p>
                <button classname="btn btn-primary" onclick="{this.props.increment}">+</button>
            </div>
        )
    }
}
export default connect(
    state =&gt; state,
    actions
)(Counter);
</code></pre>
<h3 id="t409.3 server/render.js">9.3 server/render.js <a href="#t409.3 server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import getStore from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
export default function (req,res) {
    const content=renderToString(
        <provider store="{getStore()}">
            <staticrouter context="{{}}" location="{req.path}">
                    <fragment>
                        <header>
                        <div classname="container" style="{{marginTop:50}}">
                            {routes}
                        </div>
                    
                
        
    );
    res.send(`
    
    
        
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
            <title>&#x73E0;&#x5CF0;SSR</title>
        
        
            <div id="root">${content}</div>
            <script src="/index.js"></script>
        
    
    `);
}
</header></fragment></staticrouter></provider></code></pre>
<h3 id="t419.4 src/store/index.js">9.4 src/store/index.js <a href="#t419.4 src/store/index.js"> # </a></h3>
<p>src/store/index.js</p>
<pre><code class="lang-js">import reducer from &apos;./reducer&apos;;
import {createStore,applyMiddleware} from &apos;redux&apos;;
import thunk from &apos;redux-thunk&apos;;
import logger from &apos;redux-logger&apos;;
function getStore() {
    return createStore(reducer,applyMiddleware(thunk,logger));
}
export default getStore;
</code></pre>
<h3 id="t429.5 store/reducer.js">9.5 store/reducer.js <a href="#t429.5 store/reducer.js"> # </a></h3>
<p>src/store/reducer.js</p>
<pre><code class="lang-js">import * as types from &apos;./action-types&apos;;
let initState = {
    number: 0
};
export default function (state = initState, action) {
    switch (action.type) {
        case types.INCREMENT:
            return {
                number: state.number + 1
            };
        default:
            return state;
    }
}
</code></pre>
<h3 id="t439.6 action-types.js">9.6 action-types.js <a href="#t439.6 action-types.js"> # </a></h3>
<p>src/store/action-types.js</p>
<pre><code class="lang-js">export const INCREMENT=&apos;INCREMENT&apos;;
</code></pre>
<h3 id="t449.7 store/actions.js">9.7 store/actions.js <a href="#t449.7 store/actions.js"> # </a></h3>
<p>src/store/actions.js</p>
<pre><code class="lang-js">import * as types from &apos;./action-types&apos;;
export default {
    increment() {
        return {type:types.INCREMENT}
    }
}
</code></pre>
<h2 id="t4510. &#x5408;&#x5E76;reducers">10. &#x5408;&#x5E76;reducers <a href="#t4510. &#x5408;&#x5E76;reducers"> # </a></h2>
<h3 id="t4610.1 Counter/index.js">10.1 Counter/index.js <a href="#t4610.1 Counter/index.js"> # </a></h3>
<p>src/containers/Counter/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import actions from &apos;../../store/actions&apos;;
class Counter extends Component{
    render() {
        return (
            <div>
                <p>{this.props.number}</p>
                <button classname="btn btn-primary" onclick="{this.props.increment}">+</button>
            </div>
        )
    }
}
export default connect(
    state =&gt; state.counter,
    actions
)(Counter);
</code></pre>
<h3 id="t4710.2 src/store/index.js">10.2 src/store/index.js <a href="#t4710.2 src/store/index.js"> # </a></h3>
<p>src/store/index.js</p>
<pre><code class="lang-js">import reducers from &apos;./reducers&apos;;
import {createStore,applyMiddleware} from &apos;redux&apos;;
import thunk from &apos;redux-thunk&apos;;
import logger from &apos;redux-logger&apos;;
function getStore() {
    return createStore(reducers,applyMiddleware(thunk,logger));
}
export default getStore;
</code></pre>
<h3 id="t4810.3 reducers/index.js">10.3 reducers/index.js <a href="#t4810.3 reducers/index.js"> # </a></h3>
<p>src/store/reducers/index.js</p>
<pre><code class="lang-js">import {combineReducers} from &apos;redux&apos;;
import home from &apos;./home&apos;;
import counter from &apos;./counter&apos;;
let reducers=combineReducers({
    home,
    counter
});
export default reducers;
</code></pre>
<h3 id="t4910.4 reducers/home.js">10.4 reducers/home.js <a href="#t4910.4 reducers/home.js"> # </a></h3>
<p>src/store/reducers/home.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
let initState = {
    list:[]
};
export default function (state = initState, action) {
    switch (action.type) {
        default:
          return state;
    }
}
</code></pre>
<h3 id="t5010.5 reducers/counter.js">10.5 reducers/counter.js <a href="#t5010.5 reducers/counter.js"> # </a></h3>
<p>src/store/reducers/counter.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
let initState = {
    number: 0
};
export default function (state = initState, action) {
    switch (action.type) {
        case types.INCREMENT:
            return {
                number: state.number + 1
            };
        default:
            return state;
    }
}
</code></pre>
<h2 id="t5111. &#x5BA2;&#x6237;&#x7AEF;&#x52A0;&#x8F7D;&#x6570;&#x636E;">11. &#x5BA2;&#x6237;&#x7AEF;&#x52A0;&#x8F7D;&#x6570;&#x636E; <a href="#t5111. &#x5BA2;&#x6237;&#x7AEF;&#x52A0;&#x8F7D;&#x6570;&#x636E;"> # </a></h2>
<h3 id="t5211.1 src/client/index.js">11.1 src/client/index.js <a href="#t5211.1 src/client/index.js"> # </a></h3>
<p>src/client/index.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {BrowserRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {Provider} from &apos;react-redux&apos;;
import getStore from &apos;../store&apos;;
ReactDOM.hydrate(
    <provider store="{getStore()}">
        <browserrouter>
            <fragment>
                <header>
                <div classname="container" style="{{marginTop:70}}">
                    {routes}
                </div>
            
        
    
    ,document.querySelector(&apos;#root&apos;));
</header></fragment></browserrouter></provider></code></pre>
<h3 id="t5311.2 Counter/index.js">11.2 Counter/index.js <a href="#t5311.2 Counter/index.js"> # </a></h3>
<p>src/containers/Counter/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import actions from &apos;../../store/actions/counter&apos;;
class Counter extends Component{
    render() {
        return (
            <div>
                <p>{this.props.number}</p>
                <button classname="btn btn-primary" onclick="{this.props.increment}">+</button>
            </div>
        )
    }
}
export default connect(
    state =&gt; state.counter,
    actions
)(Counter);
</code></pre>
<h3 id="t5411.3 Home/index.js">11.3 Home/index.js <a href="#t5411.3 Home/index.js"> # </a></h3>
<p>src/containers/Home/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import actions from &apos;../../store/actions/home&apos;;
class Home extends Component{
    componentDidMount() {
        this.props.getHomeList();
    }
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <ul classname="list-group">
                        {
                            this.props.list.map(item =&gt; (
                                <li classname="list-group-item" key="{item.id}">{item.name}</li>
                            ))
                        }
                    </ul>
                </div>
            </div>
        )
    }
}
export default connect(
    state =&gt; state.home,
    actions
)(Home);
</code></pre>
<h3 id="t5511.3 Home/index.js">11.3 Home/index.js <a href="#t5511.3 Home/index.js"> # </a></h3>
<p>src/containers/Home/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import actions from &apos;../../store/actions/home&apos;;
class Home extends Component{
    componentDidMount() {
        this.props.getHomeList();
    }
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <ul classname="list-group">
                        {
                            this.props.list.map(item =&gt; (
                                <li classname="list-group-item" key="{item.id}">{item.name}</li>
                            ))
                        }
                    </ul>
                </div>
            </div>
        )
    }
}
export default connect(
    state =&gt; state.home,
    actions
)(Home);
</code></pre>
<h3 id="t5611.4 src/server/render.js">11.4 src/server/render.js <a href="#t5611.4 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import getStore from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
export default function (req,res) {
    const content=renderToString(
        <provider store="{getStore()}">
            <staticrouter context="{{}}" location="{req.path}">
                    <fragment>
                        <header>
                        <div classname="container" style="{{marginTop:70}}">
                            {routes}
                        </div>
                    
                
        
    );
    res.send(`
    
    
        
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
            <title>&#x73E0;&#x5CF0;SSR</title>
        
        
            <div id="root">${content}</div>
            <script src="/index.js"></script>
        
    
    `);
}
</header></fragment></staticrouter></provider></code></pre>
<h3 id="t5711.5 src/store/action-types.js">11.5 src/store/action-types.js <a href="#t5711.5 src/store/action-types.js"> # </a></h3>
<p>src/store/action-types.js</p>
<pre><code class="lang-js">//counter
export const INCREMENT=&apos;INCREMENT&apos;;

//home
export const SET_HOME_LIST=&apos;SET_HOME_LIST&apos;;

</code></pre>
<h3 id="t5811.6 reducers/home.js">11.6 reducers/home.js <a href="#t5811.6 reducers/home.js"> # </a></h3>
<p>src/store/reducers/home.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
let initState = {
    list:[]
};
export default function (state = initState, action) {
    switch (action.type) {
        case types.SET_HOME_LIST:
            return {...state,list:action.payload};
        default:
          return state;
    }
}
</code></pre>
<h3 id="t5911.7  actions/counter.js">11.7  actions/counter.js <a href="#t5911.7  actions/counter.js"> # </a></h3>
<p>src/store/actions/counter.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
export default {
    increment() {
        return {type:types.INCREMENT}
    }
}
</code></pre>
<h3 id="t6011.8 reducers/home.js">11.8 reducers/home.js <a href="#t6011.8 reducers/home.js"> # </a></h3>
<p>src/store/reducers/home.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
import axios from &apos;axios&apos;;
export default {
    getHomeList() {
        return function (dispatch,getState) {
            axios.get(&apos;http://localhost:4000/api/users&apos;).then(result =&gt; {
                let list=result.data;
                dispatch({
                    type: types.SET_HOME_LIST,
                    payload:list
                });
            });
        }
    }
}
</code></pre>
<h3 id="t6111.9 api/server.js">11.9 api/server.js <a href="#t6111.9 api/server.js"> # </a></h3>
<p>api/server.js</p>
<pre><code class="lang-js">let express=require(&apos;express&apos;);
let cors=require(&apos;cors&apos;);
let app=express();
var corsOptions = {
    origin: &apos;http://localhost:9090&apos;,
    optionsSuccessStatus: 200 
}
app.use(cors(corsOptions));
let users=[{id:1,name:&apos;zfpx1&apos;},{id:2,name:&apos;zfpx2&apos;}];
app.get(&apos;/api/users&apos;,function (req,res) {
    res.json(users);
});
app.listen(4000);
</code></pre>
<h2 id="t6212. &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8DEF;&#x7531;">12. &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8DEF;&#x7531; <a href="#t6212. &#x670D;&#x52A1;&#x5668;&#x7AEF;&#x8DEF;&#x7531;"> # </a></h2>
<h3 id="t6312.1 src/client/index.js">12.1 src/client/index.js <a href="#t6312.1 src/client/index.js"> # </a></h3>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {BrowserRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {Provider} from &apos;react-redux&apos;;
import {Route} from &apos;react-router-dom&apos;;
import getStore from &apos;../store&apos;;
ReactDOM.hydrate(
    <provider store="{getStore()}">
        <browserrouter>
            <fragment>
                <header>
                <div classname="container" style="{{marginTop:" 70}}="">
                    <fragment>
                      {routes.map(route =&gt; (
                            <route {...route}="">
                      ))}
                    </route></fragment>

                </div>
            
        
    
    ,document.querySelector(&apos;#root&apos;));
</header></fragment></browserrouter></provider></code></pre>
<h3 id="t6412.2 Home/index.js">12.2 Home/index.js <a href="#t6412.2 Home/index.js"> # </a></h3>
<p>src/containers/Home/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import actions from &apos;../../store/actions/home&apos;;
class Home extends Component{
    static loadData=() =&gt; {
        console.log(&apos;&#x52A0;&#x8F7D;&#x6570;&#x636E;&apos;);
    }
    //componentDidMount&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x662F;&#x4E0D;&#x6267;&#x884C;&#x7684;
    componentDidMount() {
        this.props.getHomeList();
    }
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <ul classname="list-group">
                        {
                            this.props.list.map(item =&gt; (
                                <li classname="list-group-item" key="{item.id}">{item.name}</li>
                            ))
                        }
                    </ul>
                </div>
            </div>
        )
    }
}
export default connect(
    state =&gt; state.home,
    actions
)(Home);
</code></pre>
<h3 id="t6512.3 src/routes.js">12.3 src/routes.js <a href="#t6512.3 src/routes.js"> # </a></h3>
<p>src/routes.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import {Route} from &apos;react-router-dom&apos;;
import Home from &apos;./containers/Home&apos;;
import Counter from &apos;./containers/Counter&apos;;
export default [
    {
        path: &apos;/&apos;,
        component: Home,
        exact: true,
        key:&apos;home&apos;,
        loadData:Home.loadData
    },
    {
        path: &apos;/counter&apos;,
        component: Counter,
        key:&apos;login&apos;,
        exact: true
    }
]
/**
export default (
    <fragment>
        <route path="/" exact="" component="{Home}"></route>
        <route path="/counter" exact="" component="{Counter}"></route>
    </fragment>
)
*/
</code></pre>
<h3 id="t6612.4 src/server/render.js">12.4 src/server/render.js <a href="#t6612.4 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import {Route,matchPath} from &apos;react-router-dom&apos;;
import getStore from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
export default function (req,res) {
    let store=getStore();
    let matchedRoutes=routes.filter(route =&gt; {
        return matchPath(req.path,route);
    });
    console.log(matchedRoutes);
    const content=renderToString(
        <provider store="{store}">
            <staticrouter context="{{}}" location="{req.path}">
                    <fragment>
                        <header>
                        <div classname="container" style="{{marginTop:70}}">
                        {routes.map(route =&gt; (
                            <route {...route}="">
                            ))}
                        </route></div>
                    
                
        
    );
    res.send(`
    
    
        
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
            <title>&#x73E0;&#x5CF0;SSR</title>
        
        
            <div id="root">${content}</div>
            <script src="/index.js"></script>
        
    
    `);
}
</header></fragment></staticrouter></provider></code></pre>
<h2 id="t6713.&#x591A;&#x7EA7;&#x8DEF;&#x7531;">13.&#x591A;&#x7EA7;&#x8DEF;&#x7531; <a href="#t6713.&#x591A;&#x7EA7;&#x8DEF;&#x7531;"> # </a></h2>
<h3 id="t6813.1 src/client/index.js">13.1 src/client/index.js <a href="#t6813.1 src/client/index.js"> # </a></h3>
<p>src/client/index.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {BrowserRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {Provider} from &apos;react-redux&apos;;
import {Route,matchPath} from &apos;react-router-dom&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
import getStore from &apos;../store&apos;;
ReactDOM.hydrate(
    <provider store="{getStore()}">
        <browserrouter>
            <fragment>
                <header>
                <div classname="container" style="{{marginTop:" 70}}="">
                    <fragment>
                      {renderRoutes(routes)}
                    </fragment>

                </div>
            
        
    
    ,document.querySelector(&apos;#root&apos;));
</header></fragment></browserrouter></provider></code></pre>
<h3 id="t6913.2 Header/index.js">13.2 Header/index.js <a href="#t6913.2 Header/index.js"> # </a></h3>
<p>src/components/Header/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Link} from &apos;react-router-dom&apos;;
export default class Home extends Component{
    render() {
        return (
            <nav classname="navbar navbar-inverse navbar-fixed-top">
                    <div classname="container">
                        <div classname="navbar-header">
                            <a classname="navbar-brand" href="#">&#x73E0;&#x5CF0;SSR</a>
                        </div>
                        <div id="navbar" classname="collapse navbar-collapse">
                            <ul classname="nav navbar-nav">
                              <li><link to="/">Home</li>
                              <li><link to="/user/list">&#x7528;&#x6237;&#x5217;&#x8868;</li>
                              <li><link to="/counter">Counter</li>
                            </ul>
                        </div>
                    </div>
                </nav>
        )
    }
}
</code></pre>
<h3 id="t7013.3 src/routes.js">13.3 src/routes.js <a href="#t7013.3 src/routes.js"> # </a></h3>
<p>src/routes.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import Home from &apos;./containers/Home&apos;;
import User from &apos;./containers/User&apos;;
import UserList from &apos;./containers/User/components/UserList&apos;;
import Counter from &apos;./containers/Counter&apos;;
export default [
    {
        path: &apos;/&apos;,
        component: Home,
        exact: true,
        key:&apos;/home&apos;,
        loadData:Home.loadData
    },
    {
        path: &apos;/user&apos;,
        component: User,
        key: &apos;/user&apos;,
        routes: [
            {
                path: &apos;/user/list&apos;,
                component: UserList,
                key:&apos;/user/list&apos;
            }
        ]
    },
    {
        path: &apos;/counter&apos;,
        component: Counter,
        key:&apos;login&apos;,
        exact: true
    }
]
/**
export default (
    <fragment>
        <route path="/" exact="" component="{Home}"></route>
        <route path="/counter" exact="" component="{Counter}"></route>
    </fragment>
)
*/
</code></pre>
<h3 id="t7113.4 src/server/render.js">13.4 src/server/render.js <a href="#t7113.4 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import {Route,matchPath} from &apos;react-router-dom&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
import getStore from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
export default function (req,res) {
    let store=getStore();
    /**
    let matchedRoutes=routes.filter(route =&gt; {
        return matchPath(req.path,route);
    });
    */
    let matchedRoutes= matchRoutes(routes,req.path);
    console.log(matchedRoutes);
    const content=renderToString(
        <provider store="{store}">
            <staticrouter context="{{}}" location="{req.path}">
                    <fragment>
                        <header>
                        <div classname="container" style="{{marginTop:70}}">
                          {renderRoutes(routes)}
                        </div>
                    
                
        
    );
    res.send(`
    
    
        
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
            <title>&#x73E0;&#x5CF0;SSR</title>
        
        
            <div id="root">${content}</div>
            <script src="/index.js"></script>
        
    
    `);
}
</header></fragment></staticrouter></provider></code></pre>
<h3 id="t7213.5 src/server/render.js">13.5 src/server/render.js <a href="#t7213.5 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Link} from &apos;react-router-dom&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
export default class User extends Component{
    render() {
        console.log(this.props.children);
        return (
            <div classname="row">
                <div classname="col-md-3">
                    <ul classname="list-group">
                        <li classname="list-group-item"><link to="/user/list">&#x7528;&#x6237;&#x5217;&#x8868;</li>
                        <li classname="list-group-item"><link to="/user/add">&#x6DFB;&#x52A0;&#x7528;&#x6237;</li>
                    </ul>
                </div>
                <div classname="col-md-9">
                    {renderRoutes(this.props.route.routes)}
                </div>
            </div>
        )
    }
}
</code></pre>
<h3 id="t7313.6 components/UserList.js">13.6 components/UserList.js <a href="#t7313.6 components/UserList.js"> # </a></h3>
<p>src/containers/User/components/UserList.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import actions from &apos;../../../store/actions/home&apos;;

class UserList extends Component{
    static loadData=() =&gt; {
        console.log(&apos;&#x52A0;&#x8F7D;&#x6570;&#x636E;&apos;);
    }
    //componentDidMount&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x662F;&#x4E0D;&#x6267;&#x884C;&#x7684;
    componentDidMount() {
        this.props.getHomeList();
    }
    render() {
        return (
            <ul classname="list-group">
                {
                    this.props.list.map(item =&gt; (
                        <li classname="list-group-item" key="{item.id}">{item.name}</li>
                    ))
                }
            </ul>
        )
    }
}
export default connect(
    state =&gt; state.home,
    actions
)(UserList);
</code></pre>
<h2 id="t7414.&#x540E;&#x53F0;&#x83B7;&#x53D6;&#x6570;&#x636E;">14.&#x540E;&#x53F0;&#x83B7;&#x53D6;&#x6570;&#x636E; <a href="#t7414.&#x540E;&#x53F0;&#x83B7;&#x53D6;&#x6570;&#x636E;"> # </a></h2>
<h3 id="t7514.1 src/client/index.js">14.1 src/client/index.js <a href="#t7514.1 src/client/index.js"> # </a></h3>
<p>src/client/index.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {BrowserRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {Provider} from &apos;react-redux&apos;;
import {renderRoutes} from &apos;react-router-config&apos;;
import {getClientStore} from &apos;../store&apos;;
ReactDOM.hydrate(
    <provider store="{getClientStore()}">
        <browserrouter>
            <fragment>
                <header>
                <div classname="container" style="{{marginTop:" 70}}="">
                    <fragment>
                      {renderRoutes(routes)}
                    </fragment>

                </div>
            
        
    
    ,document.querySelector(&apos;#root&apos;));
</header></fragment></browserrouter></provider></code></pre>
<h3 id="t7614.2 Home/index.js">14.2 Home/index.js <a href="#t7614.2 Home/index.js"> # </a></h3>
<p>src/containers/Home/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import actions from &apos;../../store/actions/home&apos;;
class Home extends Component{
    static loadData=(store) =&gt; {
        //dispatch&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;action
        //https://github.com/reduxjs/redux/blob/master/src/createStore.js
        return store.dispatch(actions.getHomeList());
    }
    //componentDidMount&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x662F;&#x4E0D;&#x6267;&#x884C;&#x7684;
    componentDidMount() {
        if(this.props.list.length==0)
            this.props.getHomeList();
    }
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <ul classname="list-group">
                        {
                            this.props.list.map(item =&gt; (
                                <li classname="list-group-item" key="{item.id}">{item.name}</li>
                            ))
                        }
                    </ul>
                </div>
            </div>
        )
    }
}
export default connect(
    state =&gt; state.home,
    actions
)(Home);
</code></pre>
<h3 id="t7714.3 src/server/render.js">14.3 src/server/render.js <a href="#t7714.3 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import {Route,matchPath} from &apos;react-router-dom&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
import {getStore} from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
export default function (req,res) {
    let store=getStore();
    /**
    let matchedRoutes=routes.filter(route =&gt; {
        return matchPath(req.path,route);
    });
    */
    let matchedRoutes=matchRoutes(routes,req.path);
    let promises=[];
    matchedRoutes.forEach(item =&gt; {
        if (item.route.loadData)
            promises.push(item.route.loadData(store));
    });
    Promise.all(promises).then(result =&gt; {
        const content=renderToString(
            <provider store="{store}">
                <staticrouter context="{{}}" location="{req.path}">
                        <fragment>
                            <header>
                            <div classname="container" style="{{marginTop:70}}">
                              {renderRoutes(routes)}
                            </div>
                        
                    
            
        );
        res.send(`
        
        
            
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
                <title>&#x73E0;&#x5CF0;SSR</title>
            
            
                <div id="root">${content}</div>
                <script>
                  window.context = {
                      state:${JSON.stringify(store.getState())}
                  }
                </script>
                <script src="/index.js"></script>
            
        
        `);
    });

}
</header></fragment></staticrouter></provider></code></pre>
<h3 id="t7814.4 actions/home.js">14.4 actions/home.js <a href="#t7814.4 actions/home.js"> # </a></h3>
<p>src/store/actions/home.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
import axios from &apos;axios&apos;;
export default {
    getHomeList() {
        //https://github.com/reduxjs/redux-thunk/blob/master/src/index.js
        return function (dispatch,getState) {
            return axios.get(&apos;http://localhost:4000/api/users&apos;).then(result =&gt; {
                let list=result.data;
                dispatch({
                    type: types.SET_HOME_LIST,
                    payload:list
                });
            });
        }
    }
}
</code></pre>
<h3 id="t7914.5 src/store/index.js">14.5 src/store/index.js <a href="#t7914.5 src/store/index.js"> # </a></h3>
<p>src/store/index.js</p>
<pre><code class="lang-js">import reducers from &apos;./reducers&apos;;
import {createStore,applyMiddleware} from &apos;redux&apos;;
import thunk from &apos;redux-thunk&apos;;
import logger from &apos;redux-logger&apos;;
export function getStore() {
    return createStore(reducers,applyMiddleware(thunk,logger));
}
export function getClientStore() {
    let initState=window.context.state;
    return createStore(reducers,initState,applyMiddleware(thunk,logger));
}
</code></pre>
<h2 id="t8015. Node&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;">15. Node&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668; <a href="#t8015. Node&#x4EE3;&#x7406;&#x670D;&#x52A1;&#x5668;"> # </a></h2>
<h3 id="t8115.1 src/server/index.js">15.1 src/server/index.js <a href="#t8115.1 src/server/index.js"> # </a></h3>
<p>src/server/index.js</p>
<pre><code class="lang-js">import express from &apos;express&apos;;
import proxy from &apos;express-http-proxy&apos;;
import render from &apos;./render&apos;;
let app=express();
app.use(express.static(&apos;public&apos;));
app.use(&apos;/api&apos;,proxy(&apos;http://127.0.0.1:4000&apos;,{
    //&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;
    proxyReqPathResolver: function (req) {
        return `/api/${req.url}`;
    }
}));
//context&#x6570;&#x636E;&#x7684;&#x4F20;&#x9012; StaticRouter&#x9700;&#x8981;&#x77E5;&#x9053;&#x5F53;&#x524D;&#x8DEF;&#x5F84;
app.get(&apos;*&apos;,(req,res) =&gt; {
    render(req,res);
});
app.listen(9090);
</code></pre>
<h3 id="t8215.2 src/server/render.js">15.2 src/server/render.js <a href="#t8215.2 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
import {getStore} from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
export default function (req,res) {
    let store=getStore();
    /**
    let matchedRoutes=routes.filter(route =&gt; {
        return matchPath(req.path,route);
    });
    */
    let matchedRoutes=matchRoutes(routes,req.path);
    let promises=[];
    matchedRoutes.forEach(item =&gt; {
        if (item.route.loadData)
            promises.push(item.route.loadData(store));
    });
    Promise.all(promises).then(result =&gt; {
        const content=renderToString(
            <provider store="{store}">
                <staticrouter context="{{}}" location="{req.path}">
                        <fragment>
                            <header>
                            <div classname="container" style="{{marginTop:70}}">
                              {renderRoutes(routes)}
                            </div>
                        
                    
            
        );
        res.send(`
        
        
            
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
                <title>&#x73E0;&#x5CF0;SSR</title>
            
            
                <div id="root">${content}</div>
                <script>
                  window.context = {
                      state:${JSON.stringify(store.getState())}
                  }
                </script>
                <script src="/index.js"></script>
            
        
        `);
    });
}
</header></fragment></staticrouter></provider></code></pre>
<h3 id="t8315.3 actions/home.js">15.3 actions/home.js <a href="#t8315.3 actions/home.js"> # </a></h3>
<p>src/store/actions/home.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
import axios from &apos;axios&apos;;
export default {
    getHomeList() {
        //https://github.com/reduxjs/redux-thunk/blob/master/src/index.js
        return function (dispatch,getState,request) {
            //http://localhost:4000/api/users
            return request.get(&apos;/api/users&apos;).then(result =&gt; {
                let list=result.data;
                dispatch({
                    type: types.SET_HOME_LIST,
                    payload:list
                });
            });
        }
    }
}
</code></pre>
<h3 id="t8415.4 src/store/index.js">15.4 src/store/index.js <a href="#t8415.4 src/store/index.js"> # </a></h3>
<p>src/store/index.js</p>
<pre><code class="lang-js">import reducers from &apos;./reducers&apos;;
import {createStore,applyMiddleware} from &apos;redux&apos;;
import clientRequest from &apos;../client/request&apos;;
import serverRequest from &apos;../server/request&apos;;
import thunk from &apos;redux-thunk&apos;;
import logger from &apos;redux-logger&apos;;
export function getStore() {
    return createStore(reducers,applyMiddleware(thunk.withExtraArgument(serverRequest),logger));
}
export function getClientStore() {
    let initState=window.context.state;
    return createStore(reducers,initState,applyMiddleware(thunk.withExtraArgument(clientRequest),logger));
}
</code></pre>
<h3 id="t8515.5 src/client/request.js">15.5 src/client/request.js <a href="#t8515.5 src/client/request.js"> # </a></h3>
<p>src/client/request.js</p>
<pre><code class="lang-js">import axios from &apos;axios&apos;;
export default axios.create({
    baseURL:&apos;/&apos;
});
</code></pre>
<h3 id="t8615.6 src/server/request.js">15.6 src/server/request.js <a href="#t8615.6 src/server/request.js"> # </a></h3>
<p>src/server/request.js</p>
<pre><code class="lang-js">import axios from &apos;axios&apos;;
export default axios.create({
    baseURL:&apos;http://localhost:4000/&apos;
});
</code></pre>
<h2 id="t8716. &#x62BD;&#x53D6;App.js">16. &#x62BD;&#x53D6;App.js <a href="#t8716. &#x62BD;&#x53D6;App.js"> # </a></h2>
<h3 id="t8816.1 src/client/index.js">16.1 src/client/index.js <a href="#t8816.1 src/client/index.js"> # </a></h3>
<p>src/client/index.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {BrowserRouter} from &apos;react-router-dom&apos;;
import {Provider} from &apos;react-redux&apos;;
import routes from &apos;../routes&apos;;
import {renderRoutes} from &apos;react-router-config&apos;;
import {getClientStore} from &apos;../store&apos;;
ReactDOM.hydrate(
    <provider store="{getClientStore()}">
        <browserrouter>
          {renderRoutes(routes)}
      </browserrouter>
  </provider>
    ,document.querySelector(&apos;#root&apos;));
</code></pre>
<h3 id="t8916.2 User/index.js">16.2 User/index.js <a href="#t8916.2 User/index.js"> # </a></h3>
<p>src/containers/User/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Link} from &apos;react-router-dom&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
export default class User extends Component{
    render() {
        return (
            <div classname="row">
                <div classname="col-md-3">
                    <ul classname="list-group">
                        <li classname="list-group-item"><link to="/user/list">&#x7528;&#x6237;&#x5217;&#x8868;</li>
                        <li classname="list-group-item"><link to="/user/add">&#x6DFB;&#x52A0;&#x7528;&#x6237;</li>
                    </ul>
                </div>
                <div classname="col-md-9">
                    {renderRoutes(this.props.route.routes)}
                </div>
            </div>
        )
    }
}
</code></pre>
<h3 id="t9016.3 src/routes.js">16.3 src/routes.js <a href="#t9016.3 src/routes.js"> # </a></h3>
<p>src/routes.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import Home from &apos;./containers/Home&apos;;
import User from &apos;./containers/User&apos;;
import UserList from &apos;./containers/User/components/UserList&apos;;
import Counter from &apos;./containers/Counter&apos;;
import App from &apos;./containers/App&apos;;
export default [
    {
        path: &apos;/&apos;,
        component: App,
        routes: [
            {
                path: &apos;/&apos;,
                component: Home,
                exact: true,
                key:&apos;/home&apos;,
                loadData:Home.loadData
            },
            {
                path: &apos;/user&apos;,
                component: User,
                key: &apos;/user&apos;,
                routes: [
                    {
                        path: &apos;/user/list&apos;,
                        component: UserList,
                        key:&apos;/user/list&apos;
                    }
                ]
            },
            {
                path: &apos;/counter&apos;,
                component: Counter,
                key:&apos;login&apos;,
                exact: true
            }
        ]
    }

]
/**
export default (
    <fragment>
        <route path="/" exact="" component="{Home}"></route>
        <route path="/counter" exact="" component="{Counter}"></route>
    </fragment>
)
*/
</code></pre>
<h3 id="t9116.4 src/server/index.js">16.4 src/server/index.js <a href="#t9116.4 src/server/index.js"> # </a></h3>
<p>src/server/index.js</p>
<pre><code class="lang-js">import express from &apos;express&apos;;
import proxy from &apos;express-http-proxy&apos;;
import render from &apos;./render&apos;;
let app=express();
app.use(express.static(&apos;public&apos;));
app.use(&apos;/api&apos;,proxy(&apos;http://localhost:4000&apos;,{
    //&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;
    proxyReqPathResolver: function (req) {
        return `/api${req.url}`;
    }
}));
//context&#x6570;&#x636E;&#x7684;&#x4F20;&#x9012; StaticRouter&#x9700;&#x8981;&#x77E5;&#x9053;&#x5F53;&#x524D;&#x8DEF;&#x5F84;
app.get(&apos;*&apos;,(req,res) =&gt; {
    render(req,res);
});
app.listen(9090);
</code></pre>
<h3 id="t9216.5 src/server/render.js">16.5 src/server/render.js <a href="#t9216.5 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
import {getStore} from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
import App from &apos;../containers/App&apos;;
export default function (req,res) {
    let store=getStore();
    /**
    let matchedRoutes=routes.filter(route =&gt; {
        return matchPath(req.path,route);
    });
    */
    let matchedRoutes=matchRoutes(routes,req.path);
    let promises=[];
    matchedRoutes.forEach(item =&gt; {
        if (item.route.loadData)
            promises.push(item.route.loadData(store));
    });
    Promise.all(promises).then(result =&gt; {
        const content=renderToString(
            <provider store="{store}">
                <staticrouter context="{{}}" location="{req.path}">
                    {renderRoutes(routes)}
                </staticrouter>
            </provider>
        );
        res.send(`
        
        
            
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
                <title>&#x73E0;&#x5CF0;SSR</title>
            
            
                <div id="root">${content}</div>
                <script>
                  window.context = {
                      state:${JSON.stringify(store.getState())}
                  }
                </script>
                <script src="/index.js"></script>
            
        
        `);
    });
}
</code></pre>
<h3 id="t9316.6  src/containers/App.js">16.6  src/containers/App.js <a href="#t9316.6  src/containers/App.js"> # </a></h3>
<p>src/containers/App.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {renderRoutes} from &apos;react-router-config&apos;;
import Header from &apos;../components/Header&apos;;
export default class App extends Component{
    render() {
        return (
            <fragment>
                <header>
                <div classname="container" style="{{marginTop:" 70}}="">
                    <fragment>
                      {renderRoutes(this.props.route.routes)}
                    </fragment>
                </div>
            
        )
    }
}
</header></fragment></code></pre>
<h2 id="t9417. &#x5B9E;&#x73B0;&#x5934;&#x90E8;&#x5BFC;&#x822A;">17. &#x5B9E;&#x73B0;&#x5934;&#x90E8;&#x5BFC;&#x822A; <a href="#t9417. &#x5B9E;&#x73B0;&#x5934;&#x90E8;&#x5BFC;&#x822A;"> # </a></h2>
<h3 id="t9517.1 src/client/index.js">17.1 src/client/index.js <a href="#t9517.1 src/client/index.js"> # </a></h3>
<p>src/client/index.js</p>
<pre><code class="lang-js">import React from &apos;react&apos;;
import ReactDOM from &apos;react-dom&apos;;
import {BrowserRouter} from &apos;react-router-dom&apos;;
import {Provider} from &apos;react-redux&apos;;
import routes from &apos;../routes&apos;;
import {renderRoutes} from &apos;react-router-config&apos;;
import {getClientStore} from &apos;../store&apos;;
ReactDOM.hydrate(
    <provider store="{getClientStore()}">
        <browserrouter>
          {renderRoutes(routes)}
      </browserrouter>
  </provider>
    ,document.querySelector(&apos;#root&apos;));
</code></pre>
<h3 id="t9617.2 src/components/Header/index.js">17.2 src/components/Header/index.js <a href="#t9617.2 src/components/Header/index.js"> # </a></h3>
<p>src/components/Header/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {Link} from &apos;react-router-dom&apos;;
import {connect} from &apos;react-redux&apos;;
class Header extends Component{
    render() {
        return (
            <nav classname="navbar navbar-inverse navbar-fixed-top">
                    <div classname="container">
                        <div classname="navbar-header">
                            <a classname="navbar-brand" href="#">&#x73E0;&#x5CF0;SSR</a>
                        </div>
                        <div id="navbar" classname="collapse navbar-collapse">
                            <ul classname="nav navbar-nav">
                              <li><link to="/">&#x9996;&#x9875;</li>
                              <li><link to="/user/list">&#x7528;&#x6237;&#x5217;&#x8868;</li>
                              {
                                !this.props.user&amp;&amp;<li><link to="/login">&#x767B;&#x5F55;</li>
                              }
                              {
                                this.props.user&amp;&amp;<fragment><li><link to="/logout">&#x9000;&#x51FA;</li><li><link to="/profile">&#x4E2A;&#x4EBA;&#x4E2D;&#x5FC3;</li></fragment>
                              }
                            </ul>
                        </div>
                    </div>
                </nav>
        )
    }
}
export default connect(
    state=&gt;state.session
)(Header);
</code></pre>
<h3 id="t9717.3 src/store/action-types.js">17.3 src/store/action-types.js <a href="#t9717.3 src/store/action-types.js"> # </a></h3>
<p>src/store/action-types.js</p>
<pre><code class="lang-js">//counter
export const INCREMENT=&apos;INCREMENT&apos;;
//home
export const SET_HOME_LIST=&apos;SET_HOME_LIST&apos;;
//&#x767B;&#x5F55;
export const LOGIN=&apos;LOGIN&apos;;
//&#x9000;&#x51FA;
export const LOGOUT=&apos;LOGOUT&apos;;
</code></pre>
<h3 id="t9817.4 reducers/index.js">17.4 reducers/index.js <a href="#t9817.4 reducers/index.js"> # </a></h3>
<p>src/store/reducers/index.js</p>
<pre><code class="lang-js">import {combineReducers} from &apos;redux&apos;;
import home from &apos;./home&apos;;
import counter from &apos;./counter&apos;;
import session from &apos;./session&apos;;
let reducers=combineReducers({
    home,
    counter,
    session
});
export default reducers;
</code></pre>
<h3 id="t9917.5  reducers/session.js">17.5  reducers/session.js <a href="#t9917.5  reducers/session.js"> # </a></h3>
<p>src/store/reducers/session.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
let initState = {
    user:null
};
export default function (state = initState, action) {
    switch (action.type) {
        default:
          return state;
    }
}
</code></pre>
<h2 id="t10018. &#x5B9E;&#x73B0;&#x767B;&#x5F55;&#x529F;&#x80FD;">18. &#x5B9E;&#x73B0;&#x767B;&#x5F55;&#x529F;&#x80FD; <a href="#t10018. &#x5B9E;&#x73B0;&#x767B;&#x5F55;&#x529F;&#x80FD;"> # </a></h2>
<h3 id="t10118.1 api/server.js">18.1 api/server.js <a href="#t10118.1 api/server.js"> # </a></h3>
<pre><code class="lang-js">let express=require(&apos;express&apos;);
let cors=require(&apos;cors&apos;);
let morgan=require(&apos;morgan&apos;);
let session=require(&apos;express-session&apos;);
let bodyParser=require(&apos;body-parser&apos;);
let app=express();
app.use(morgan(&apos;tiny&apos;));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({extended: true}));
app.use(session({
    resave: true,
    saveUninitialized: true,
    secret:&apos;zfpx&apos;
}));
var corsOptions = {
    origin: &apos;*&apos;,
    optionsSuccessStatus: 200 
}
app.use(cors(corsOptions));
let users=[{id:1,name:&apos;zfpx1&apos;},{id:2,name:&apos;zfpx2&apos;}];
app.get(&apos;/api/users&apos;,function (req,res) {
    res.json(users);
});
app.post(&apos;/api/login&apos;,function (req,res) {
    let user=req.body;
    req.session.user=user;
    res.json({
        code: 0,
        user,
        success:&apos;&#x767B;&#x5F55;&#x6210;&#x529F;&apos;
    });
});
app.get(&apos;/api/logout&apos;,function (req,res) {
    req.session.user=null;
    res.json({
        code: 0,
        success:&apos;&#x9000;&#x51FA;&#x6210;&#x529F;&apos;
    });
});
app.get(&apos;/api/user&apos;,function (req,res) {
    if (req.session.user) {
        res.json({
            code: 0,
            user,
            success:&apos;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x6210;&#x529F;&apos;
        });
    } else {
        res.json({
            code: 1,
            error:&apos;&#x6B64;&#x7528;&#x6237;&#x672A;&#x767B;&#x5F55;&apos;
        });
    }
});
app.listen(4000);
</code></pre>
<h3 id="t10218.2 Header/index.js">18.2 Header/index.js <a href="#t10218.2 Header/index.js"> # </a></h3>
<p>src/components/Header/index.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {Link} from &apos;react-router-dom&apos;;
import {connect} from &apos;react-redux&apos;;
class Header extends Component{
    render() {
        return (
            <nav classname="navbar navbar-inverse navbar-fixed-top">
                    <div classname="container">
                        <div classname="navbar-header">
                            <a classname="navbar-brand" href="#">&#x73E0;&#x5CF0;SSR</a>
                        </div>
                        <div id="navbar" classname="collapse navbar-collapse">
                            <ul classname="nav navbar-nav">
                              <li><link to="/">&#x9996;&#x9875;</li>
                              <li><link to="/user/list">&#x7528;&#x6237;&#x5217;&#x8868;</li>
                              {
                                !this.props.user&amp;&amp;<li><link to="/login">&#x767B;&#x5F55;</li>
                              }
                              {
                                this.props.user&amp;&amp;<fragment><li><link to="/logout">&#x9000;&#x51FA;</li><li><link to="/profile">&#x4E2A;&#x4EBA;&#x4E2D;&#x5FC3;</li></fragment>
                              }
                        </ul>
                        {
                            this.props.user&amp;&amp;(
                                <ul class="nav navbar-nav navbar-right">
                                    <li><a href="#">&#x6B22;&#x8FCE; {this.props.user.username}</a></li>
                                </ul>
                            )
                         }
                        </div>
                    </div>
                </nav>
        )
    }
}
export default connect(
    state=&gt;state.session
)(Header);
</code></pre>
<h3 id="t10318.3 src/containers/App.js">18.3 src/containers/App.js <a href="#t10318.3 src/containers/App.js"> # </a></h3>
<p>src/containers/App.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {renderRoutes} from &apos;react-router-config&apos;;
import Header from &apos;../components/Header&apos;;
export default class App extends Component{
    static loadData=(store) =&gt; {
        store.dispatch();
    }
    render() {
        return (
            <fragment>
                <header>
                <div classname="container" style="{{marginTop:" 70}}="">
                    <fragment>
                      {renderRoutes(this.props.route.routes)}
                    </fragment>
                </div>
            
        )
    }
}
</header></fragment></code></pre>
<h3 id="t10418.4 src/routes.js">18.4 src/routes.js <a href="#t10418.4 src/routes.js"> # </a></h3>
<p>src/routes.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import Home from &apos;./containers/Home&apos;;
import User from &apos;./containers/User&apos;;
import UserList from &apos;./containers/User/components/UserList&apos;;
import Counter from &apos;./containers/Counter&apos;;
import Login from &apos;./containers/Login&apos;;
import Logout from &apos;./containers/Logout&apos;;
import Profile from &apos;./containers/Profile&apos;;
import App from &apos;./containers/App&apos;;
export default [
    {
        path: &apos;/&apos;,
        component: App,
        routes: [
            {
                path: &apos;/&apos;,
                component: Home,
                exact: true,
                key:&apos;/home&apos;,
                loadData:Home.loadData
            },
            {
                path: &apos;/user&apos;,
                component: User,
                key: &apos;/user&apos;,
                routes: [
                    {
                        path: &apos;/user/list&apos;,
                        component: UserList,
                        key:&apos;/user/list&apos;
                    }
                ]
            },
            {
                path: &apos;/counter&apos;,
                component: Counter,
                key:&apos;counter&apos;,
                exact: true
            },
            {
                path: &apos;/login&apos;,
                component: Login,
                key:&apos;/login&apos;,
                exact: true
            },
            {
                path: &apos;/logout&apos;,
                component: Logout,
                key:&apos;/logout&apos;,
                exact: true
            },
            {
                path: &apos;/profile&apos;,
                component: Profile,
                key:&apos;/profile&apos;,
                exact: true
            }
        ]
    }

]
/**
export default (
    <fragment>
        <route path="/" exact="" component="{Home}"></route>
        <route path="/counter" exact="" component="{Counter}"></route>
    </fragment>
)
*/
</code></pre>
<h3 id="t10518.5 src/server/index.js">18.5 src/server/index.js <a href="#t10518.5 src/server/index.js"> # </a></h3>
<p>src/server/index.js</p>
<pre><code class="lang-js">import express from &apos;express&apos;;
import proxy from &apos;express-http-proxy&apos;;
import render from &apos;./render&apos;;
let app=express();
app.use(express.static(&apos;public&apos;));

app.use(&apos;/api&apos;,proxy(&apos;http://localhost:4000&apos;,{
    //&#x4FEE;&#x6539;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;
    proxyReqPathResolver: function (req) {
        return `/api${req.url}`;
    }
}));
//context&#x6570;&#x636E;&#x7684;&#x4F20;&#x9012; StaticRouter&#x9700;&#x8981;&#x77E5;&#x9053;&#x5F53;&#x524D;&#x8DEF;&#x5F84;
app.get(&apos;*&apos;,(req,res) =&gt; {
    render(req,res);
});
app.listen(9090);
</code></pre>
<h3 id="t10618.6 action-types.js">18.6 action-types.js <a href="#t10618.6 action-types.js"> # </a></h3>
<p>src/store/action-types.js</p>
<pre><code class="lang-js">//counter
export const INCREMENT=&apos;INCREMENT&apos;;
//home
export const SET_HOME_LIST=&apos;SET_HOME_LIST&apos;;
//&#x767B;&#x5F55;
export const LOGIN=&apos;LOGIN&apos;;
//&#x9000;&#x51FA;
export const LOGOUT=&apos;LOGOUT&apos;;
//&#x8BBE;&#x7F6E;&#x4F1A;&#x8BDD;
export const SET_SESSION=&apos;SET_SESSION&apos;;

</code></pre>
<h3 id="t10718.7 reducers/session.js">18.7 reducers/session.js <a href="#t10718.7 reducers/session.js"> # </a></h3>
<p>src/store/reducers/session.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
let initState = {
    user: null,
    success: null,
    error:null
};
export default function (state = initState, action) {
    switch (action.type) {
        case types.SET_SESSION:
            return {...action.payload};
        default:
          return state;
    }
}
</code></pre>
<h3 id="t10818.7 Login/index.js">18.7 Login/index.js <a href="#t10818.7 Login/index.js"> # </a></h3>
<p>src/containers/Login/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import actions from &apos;../../store/actions/session&apos;;
import {connect} from &apos;react-redux&apos;;
class Login extends Component{
    state={
        username:&apos;&apos;
    }
    handleChange=(event) =&gt; {
        this.setState({username:event.target.value});    
    }
    handleSubmit=(event) =&gt; {
        event.preventDefault();
        this.props.login(this.state);
    }
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <form onsubmit="{this.handleSubmit}">
                        <div classname="form-group">
                            <label htmlfor="username">&#x7528;&#x6237;&#x540D;</label>
                            <input value="{this.state.username}" onchange="{this.handleChange}" type="text" classname="form-control">
                        </div>
                        <div classname="form-group">
                            <input type="submit" classname="btn btn-primary">
                        </div>
                    </form>

                </div>
            </div>
        )
    }
}
export default connect(
    state =&gt; state.session,
    actions
)(Login)
</code></pre>
<h3 id="t10918.8 Logout/index.js">18.8 Logout/index.js <a href="#t10918.8 Logout/index.js"> # </a></h3>
<p>src/containers/Logout/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class Profile extends Component{
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <button classname="btn btn-primary">&#x9000;&#x51FA;</button>
                </div>
            </div>
        )
    }
}
</code></pre>
<h3 id="t11018.9 Profile/index.js">18.9 Profile/index.js <a href="#t11018.9 Profile/index.js"> # </a></h3>
<p>src/containers/Profile/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class Profile extends Component{
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    &#x4E2A;&#x4EBA;&#x4E2D;&#x5FC3;
                </div>
            </div>
        )
    }
}
</code></pre>
<h3 id="t11118.10 actions/session.js">18.10 actions/session.js <a href="#t11118.10 actions/session.js"> # </a></h3>
<p>src/store/actions/session.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
export default {
    login(user) {
        //https://github.com/reduxjs/redux-thunk/blob/master/src/index.js
        return function (dispatch,getState,request) {
            //http://localhost:4000/api/users
            return request.post(&apos;/api/login&apos;,user).then(result =&gt; {
                dispatch({
                    type: types.SET_SESSION,
                    payload:result.data
                });
            });
        }
    }
}
</code></pre>
<h2 id="t11219. &#x9000;&#x51FA;&#x529F;&#x80FD;">19. &#x9000;&#x51FA;&#x529F;&#x80FD; <a href="#t11219. &#x9000;&#x51FA;&#x529F;&#x80FD;"> # </a></h2>
<h3 id="t11319.1 Logout/index.js">19.1 Logout/index.js <a href="#t11319.1 Logout/index.js"> # </a></h3>
<p>src/containers/Logout/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import actions from &apos;../../store/actions/session&apos;;
import {connect} from &apos;react-redux&apos;;
class Profile extends Component{
    handleLogout=() =&gt; {
        this.props.logout();
    }
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <button classname="btn btn-primary" onclick="{this.handleLogout}">&#x9000;&#x51FA;</button>
                </div>
            </div>
        )
    }
}
export default connect(
    state =&gt; state.session,
    actions
)(Profile)
</code></pre>
<h3 id="t11419.2 actions/session.js">19.2 actions/session.js <a href="#t11419.2 actions/session.js"> # </a></h3>
<p>src/store/actions/session.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
export default {
    login(user) {
        //https://github.com/reduxjs/redux-thunk/blob/master/src/index.js
        return function (dispatch,getState,request) {
            //http://localhost:4000/api/users
            return request.post(&apos;/api/login&apos;,user).then(result =&gt; {
                dispatch({
                    type: types.SET_SESSION,
                    payload:result.data
                });
            });
        }
    },
    logout() {
        //https://github.com/reduxjs/redux-thunk/blob/master/src/index.js
        return function (dispatch,getState,request) {
            //http://localhost:4000/api/users
            return request.get(&apos;/api/logout&apos;).then(result =&gt; {
                dispatch({
                    type: types.SET_SESSION,
                    payload:result.data
                });
            });
        }
    }
}
</code></pre>
<h2 id="t11520. &#x52A0;&#x8F7D;&#x7528;&#x6237;&#x4FE1;&#x606F;">20. &#x52A0;&#x8F7D;&#x7528;&#x6237;&#x4FE1;&#x606F; <a href="#t11520. &#x52A0;&#x8F7D;&#x7528;&#x6237;&#x4FE1;&#x606F;"> # </a></h2>
<h3 id="t11620.1 api/server.js">20.1 api/server.js <a href="#t11620.1 api/server.js"> # </a></h3>
<pre><code class="lang-js">let express=require(&apos;express&apos;);
let cors=require(&apos;cors&apos;);
let morgan=require(&apos;morgan&apos;);
let session=require(&apos;express-session&apos;);
let bodyParser=require(&apos;body-parser&apos;);
let app=express();
app.use(morgan(&apos;tiny&apos;));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({extended: true}));
app.use(session({
    resave: true,
    saveUninitialized: true,
    secret:&apos;zfpx&apos;
}));
var corsOptions = {
    origin: &apos;*&apos;,
    optionsSuccessStatus: 200 
}
app.use(cors(corsOptions));
let users=[{id:1,name:&apos;zfpx1&apos;},{id:2,name:&apos;zfpx2&apos;}];
app.get(&apos;/api/users&apos;,function (req,res) {
    res.json(users);
});
app.post(&apos;/api/login&apos;,function (req,res) {
    let user=req.body;
    req.session.user=user;
    res.json({
        code: 0,
        data: {
            user,
            success:&apos;&#x767B;&#x5F55;&#x6210;&#x529F;&apos;
        }
    });
});
app.get(&apos;/api/logout&apos;,function (req,res) {
    req.session.user=null;
    res.json({
        code: 0,
        data: {
            success:&apos;&#x9000;&#x51FA;&#x6210;&#x529F;&apos;
        }

    });
});
app.get(&apos;/api/user&apos;,function (req,res) {
    if (req.session.user) {
        res.json({
            code: 0,
            data: {
                user:req.session.user,
                success:&apos;&#x83B7;&#x53D6;&#x7528;&#x6237;&#x4FE1;&#x606F;&#x6210;&#x529F;&apos;
            }
        });
    } else {
        res.json({
            code: 1,
            data: {
                error:&apos;&#x6B64;&#x7528;&#x6237;&#x672A;&#x767B;&#x5F55;&apos;
            }
        });
    }

});
app.listen(4000);
</code></pre>
<h3 id="t11720.2 containers/App.js">20.2 containers/App.js <a href="#t11720.2 containers/App.js"> # </a></h3>
<p>src/containers/App.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {renderRoutes} from &apos;react-router-config&apos;;
import Header from &apos;../components/Header&apos;;
import actions from &apos;../store/actions/session&apos;;
export default class App extends Component{
    static loadData=(store) =&gt; {
        return store.dispatch(actions.getUser());
    }
    render() {
        return (
            <fragment>
                <header>
                <div classname="container" style="{{marginTop:" 70}}="">
                    <fragment>
                      {renderRoutes(this.props.route.routes)}
                    </fragment>
                </div>
            
        )
    }
}
</header></fragment></code></pre>
<h3 id="t11820.3 Profile/index.js">20.3 Profile/index.js <a href="#t11820.3 Profile/index.js"> # </a></h3>
<p>src/containers/Profile/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import actions from &apos;../../store/actions/session&apos;;
import {Redirect} from &apos;react-router-dom&apos;;
import {connect} from &apos;react-redux&apos;;
class Profile extends Component{
    render() {
        return this.props.user? (
            <div classname="row">
                <div classname="col-md-12">
                    {this.props.user.username}
                </div>
            </div>
        ):<redirect to="/login">;
    }
}
export default connect(
    state =&gt; state.session,
    actions
)(Profile)
</redirect></code></pre>
<h3 id="t11920.4 src/routes.js">20.4 src/routes.js <a href="#t11920.4 src/routes.js"> # </a></h3>
<p>src/routes.js</p>
<pre><code class="lang-js">import React,{Fragment} from &apos;react&apos;;
import Home from &apos;./containers/Home&apos;;
import User from &apos;./containers/User&apos;;
import UserList from &apos;./containers/User/components/UserList&apos;;
import Counter from &apos;./containers/Counter&apos;;
import Login from &apos;./containers/Login&apos;;
import Logout from &apos;./containers/Logout&apos;;
import Profile from &apos;./containers/Profile&apos;;
import App from &apos;./containers/App&apos;;
export default [
    {
        path: &apos;/&apos;,
        component: App,
        loadData:App.loadData,
        routes: [
            {
                path: &apos;/&apos;,
                component: Home,
                exact: true,
                key:&apos;/home&apos;,
                loadData:Home.loadData
            },
            {
                path: &apos;/user&apos;,
                component: User,
                key: &apos;/user&apos;,
                routes: [
                    {
                        path: &apos;/user/list&apos;,
                        component: UserList,
                        key:&apos;/user/list&apos;
                    }
                ]
            },
            {
                path: &apos;/counter&apos;,
                component: Counter,
                key:&apos;counter&apos;,
                exact: true
            },
            {
                path: &apos;/login&apos;,
                component: Login,
                key:&apos;/login&apos;,
                exact: true
            },
            {
                path: &apos;/logout&apos;,
                component: Logout,
                key:&apos;/logout&apos;,
                exact: true
            },
            {
                path: &apos;/profile&apos;,
                component: Profile,
                key:&apos;/profile&apos;,
                exact: true
            }
        ]
    }

]
/**
export default (
    <fragment>
        <route path="/" exact="" component="{Home}"></route>
        <route path="/counter" exact="" component="{Counter}"></route>
    </fragment>
)
*/
</code></pre>
<h3 id="t12020.5 src/server/render.js">20.5 src/server/render.js <a href="#t12020.5 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
import {getStore} from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
import App from &apos;../containers/App&apos;;
export default function (req,res) {
    let store=getStore(req);
    /**
    let matchedRoutes=routes.filter(route =&gt; {
        return matchPath(req.path,route);
    });
    */
    let matchedRoutes=matchRoutes(routes,req.path);
    let promises=[];
    matchedRoutes.forEach(item =&gt; {
        if (item.route.loadData)
            promises.push(item.route.loadData(store));
    });
    Promise.all(promises).then(result =&gt; {
        const content=renderToString(
            <provider store="{store}">
                <staticrouter context="{{}}" location="{req.path}">
                    {renderRoutes(routes)}
                </staticrouter>
            </provider>
        );
        res.send(`
        
        
            
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
                <title>&#x73E0;&#x5CF0;SSR</title>
            
            
                <div id="root">${content}</div>
                <script>
                  window.context = {
                      state:${JSON.stringify(store.getState())}
                  }
                </script>
                <script src="/index.js"></script>
            
        
        `);
    });

}
</code></pre>
<h3 id="t12120.6 src/server/request.js">20.6 src/server/request.js <a href="#t12120.6 src/server/request.js"> # </a></h3>
<p>src/server/request.js</p>
<pre><code class="lang-js">import axios from &apos;axios&apos;;
export default (req)=&gt;axios.create({
    baseURL: &apos;http://localhost:4000/&apos;,
    headers: {
        cookie:req.get(&apos;cookie&apos;)||&apos;&apos;
    }
});
</code></pre>
<h3 id="t12220.7 actions/session.js">20.7 actions/session.js <a href="#t12220.7 actions/session.js"> # </a></h3>
<p>src/store/actions/session.js</p>
<pre><code class="lang-js">import * as types from &apos;../action-types&apos;;
export default {
    login(user) {
        //https://github.com/reduxjs/redux-thunk/blob/master/src/index.js
        return function (dispatch,getState,request) {
            //http://localhost:4000/api/users
            return request.post(&apos;/api/login&apos;,user).then(result =&gt; {
                dispatch({
                    type: types.SET_SESSION,
                    payload:result.data.data
                });
            });
        }
    },
    logout() {
        //https://github.com/reduxjs/redux-thunk/blob/master/src/index.js
        return function (dispatch,getState,request) {
            //http://localhost:4000/api/users
            return request.get(&apos;/api/logout&apos;).then(result =&gt; {
                dispatch({
                    type: types.SET_SESSION,
                    payload:result.data.data
                });
            });
        }
    },
    getUser() {
        return function (dispatch,getState,request) {
            //http://localhost:4000/api/users
            return request.get(&apos;/api/user&apos;).then(result =&gt; {
                dispatch({
                    type: types.SET_SESSION,
                    payload:result.data.data
                });
            });
        }
    }
}
</code></pre>
<h3 id="t12320.7 src/store/index.js">20.7 src/store/index.js <a href="#t12320.7 src/store/index.js"> # </a></h3>
<p>src/store/index.js</p>
<pre><code class="lang-js">import reducers from &apos;./reducers&apos;;
import {createStore,applyMiddleware} from &apos;redux&apos;;
import clientRequest from &apos;../client/request&apos;;
import getServerRequest from &apos;../server/request&apos;;
import thunk from &apos;redux-thunk&apos;;
import logger from &apos;redux-logger&apos;;
export function getStore(req) {
    return createStore(reducers,applyMiddleware(thunk.withExtraArgument(getServerRequest(req)),logger));
}
export function getClientStore() {
    let initState=window.context.state;
    return createStore(reducers,initState,applyMiddleware(thunk.withExtraArgument(clientRequest),logger));
}
</code></pre>
<h2 id="t12421. 404">21. 404 <a href="#t12421. 404"> # </a></h2>
<h3 id="t12521.1 src/routes.js">21.1 src/routes.js <a href="#t12521.1 src/routes.js"> # </a></h3>
<pre><code class="lang-js">import Home from &apos;./containers/Home&apos;;
import User from &apos;./containers/User&apos;;
import UserList from &apos;./containers/User/components/UserList&apos;;
import Counter from &apos;./containers/Counter&apos;;
import Login from &apos;./containers/Login&apos;;
import Logout from &apos;./containers/Logout&apos;;
import Profile from &apos;./containers/Profile&apos;;
import NotFound from &apos;./containers/NotFound&apos;;
import App from &apos;./containers/App&apos;;
export default [
    {
        path: &apos;/&apos;,
        component: App,
        loadData:App.loadData,
        routes: [
            {
                path: &apos;/&apos;,
                component: Home,
                exact: true,
                key:&apos;/home&apos;,
                loadData:Home.loadData
            },
            {
                path: &apos;/user&apos;,
                component: User,
                key: &apos;/user&apos;,
                routes: [
                    {
                        path: &apos;/user/list&apos;,
                        component: UserList,
                        key:&apos;/user/list&apos;
                    }
                ]
            },
            {
                path: &apos;/counter&apos;,
                component: Counter,
                key:&apos;counter&apos;,
                exact: true
            },
            {
                path: &apos;/login&apos;,
                component: Login,
                key:&apos;/login&apos;,
                exact: true
            },
            {
                path: &apos;/logout&apos;,
                component: Logout,
                key:&apos;/logout&apos;,
                exact: true
            },
            {
                path: &apos;/profile&apos;,
                component: Profile,
                key:&apos;/profile&apos;,
                exact: true
            },
            {
                component: NotFound
            }
        ]
    }

]
/**
export default (
    <fragment>
        <route path="/" exact="" component="{Home}"></route>
        <route path="/counter" exact="" component="{Counter}"></route>
    </fragment>
)
*/
</code></pre>
<h3 id="t12621.2 src/server/render.js">21.2 src/server/render.js <a href="#t12621.2 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
import {getStore} from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
import App from &apos;../containers/App&apos;;
export default function (req,res) {
    let store=getStore(req);
    /**
    let matchedRoutes=routes.filter(route =&gt; {
        return matchPath(req.path,route);
    });
    */
    let matchedRoutes=matchRoutes(routes,req.path);
    let promises=[];
    matchedRoutes.forEach(item =&gt; {
        if (item.route.loadData)
            promises.push(item.route.loadData(store));
    });
    Promise.all(promises).then(result =&gt; {
        let context={};
        const content=renderToString(
            <provider store="{store}">
                <staticrouter context="{context}" location="{req.path}">
                    {renderRoutes(routes)}
                </staticrouter>
            </provider>
        );
        if (context.notFound) {
            res.status(404);
        }
        res.send(`
        
        
            
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
                <title>&#x73E0;&#x5CF0;SSR</title>
            
            
                <div id="root">${content}</div>
                <script>
                  window.context = {
                      state:${JSON.stringify(store.getState())}
                  }
                </script>
                <script src="/index.js"></script>
            
        
        `);
    });
}
</code></pre>
<h3 id="t12721.3 NotFound/index.js">21.3 NotFound/index.js <a href="#t12721.3 NotFound/index.js"> # </a></h3>
<p>src/containers/NotFound/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
export default class NotFound extends Component{
    componentWillMount() {
        if (this.props.staticContext) {
            this.props.staticContext.notFound=true;
        }
    }
    render() {
        return (
            <div>404</div>
        )
    }
}
</code></pre>
<h2 id="t12822. 301">22. 301 <a href="#t12822. 301"> # </a></h2>
<h3 id="t12922.1 server/render.js">22.1 server/render.js <a href="#t12922.1 server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {StaticRouter} from &apos;react-router-dom&apos;;
import Header from &apos;../components/Header&apos;;
import routes from &apos;../routes&apos;;
import {renderToString} from &apos;react-dom/server&apos;;
import {matchRoutes,renderRoutes} from &apos;react-router-config&apos;;
import {getStore} from &apos;../store&apos;;
import {Provider} from &apos;react-redux&apos;;
import App from &apos;../containers/App&apos;;
export default function (req,res) {
    let store=getStore(req);
    /**
    let matchedRoutes=routes.filter(route =&gt; {
        return matchPath(req.path,route);
    });
    */
    let matchedRoutes=matchRoutes(routes,req.path);
    let promises=[];
    matchedRoutes.forEach(item =&gt; {
        if (item.route.loadData)
            promises.push(item.route.loadData(store));
    });
    Promise.all(promises).then(result =&gt; {
        let context={};
        const content=renderToString(
            <provider store="{store}">
                <staticrouter context="{context}" location="{req.path}">
                    {renderRoutes(routes)}
                </staticrouter>
            </provider>
        );
        if (context.action == &apos;REPLACE&apos;) {
            return res.redirect(301,context.url);
        } else if (context.notFound) {
            res.status(404);
        }
        res.send(`
        
        
            
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
                <title>&#x73E0;&#x5CF0;SSR</title>
            
            
                <div id="root">${content}</div>
                <script>
                  window.context = {
                      state:${JSON.stringify(store.getState())}
                  }
                </script>
                <script src="/index.js"></script>
            
        
        `);
    });
}
</code></pre>
<h2 id="t13023. promise.all">23. promise.all <a href="#t13023. promise.all"> # </a></h2>
<h3 id="t13123.1 src/server/render.js">23.1 src/server/render.js <a href="#t13123.1 src/server/render.js"> # </a></h3>
<pre><code class="lang-js">let promises=[];
    matchedRoutes.forEach(item =&gt; {
        if (item.route.loadData) {
            let promise=new Promise(function (resolve,reject) {
                return item.route.loadData(store).then(resolve,resolve);
            });
            promises.push(promise);
        }    
    });
</code></pre>
<h2 id="t13224. &#x4F7F;&#x7528;CSS">24. &#x4F7F;&#x7528;CSS <a href="#t13224. &#x4F7F;&#x7528;CSS"> # </a></h2>
<h3 id="t13324.1 Header/index.js">24.1 Header/index.js <a href="#t13324.1 Header/index.js"> # </a></h3>
<p>src/components/Header/index.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {Link} from &apos;react-router-dom&apos;;
import {connect} from &apos;react-redux&apos;;
import styles from &apos;./index.css&apos;;
class Header extends Component{
    render() {
        return (
            <nav classname="navbar navbar-inverse navbar-fixed-top">
                    <div classname="container">
                        <div classname="navbar-header">
                            <a classname="navbar-brand" href="#">&#x73E0;&#x5CF0;SSR</a>
                        </div>
                        <div id="navbar" classname="collapse navbar-collapse">
                            <ul classname="nav navbar-nav">
                              <li><link to="/">&#x9996;&#x9875;</li>
                              <li><link to="/user/list">&#x7528;&#x6237;&#x5217;&#x8868;</li>
                              {
                                !this.props.user&amp;&amp;<li><link to="/login">&#x767B;&#x5F55;</li>
                              }
                              {
                                this.props.user&amp;&amp;<fragment><li><link to="/logout">&#x9000;&#x51FA;</li><li><link to="/profile">&#x4E2A;&#x4EBA;&#x4E2D;&#x5FC3;</li></fragment>
                              }
                        </ul>
                        {
                            this.props.user&amp;&amp;(
                                <ul classname="nav navbar-nav navbar-right">
                                    <li><a href="#">&#x6B22;&#x8FCE; <span classname="{styles.user}">{this.props.user.username}</span></a></li>
                                </ul>
                            )
                         }
                        </div>
                    </div>
                </nav>
        )
    }
}
export default connect(
    state=&gt;state.session
)(Header);
</code></pre>
<h3 id="t13424.2 src/containers/App.js">24.2 src/containers/App.js <a href="#t13424.2 src/containers/App.js"> # </a></h3>
<p>src/containers/App.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {renderRoutes} from &apos;react-router-config&apos;;
import Header from &apos;../components/Header&apos;;
import actions from &apos;../store/actions/session&apos;;
import styles from &apos;./App.css&apos;;
export default class App extends Component{
    static loadData=(store) =&gt; {
        return store.dispatch(actions.getUser());
    }
    render() {
        return (
            <fragment>
                <header>
                <div classname="container">
                    <fragment>
                      {renderRoutes(this.props.route.routes)}
                    </fragment>
                </div>
            
        )
    }
}
</header></fragment></code></pre>
<h3 id="t13524.3 webpack.client.js">24.3 webpack.client.js <a href="#t13524.3 webpack.client.js"> # </a></h3>
<p>webpack.client.js</p>
<pre><code class="lang-js">module:{
        rules:[
            {
                test: /\.css$/,
                use: [
                    &apos;style-loader&apos;,
                    {
                        loader: &apos;css-loader&apos;,
                        options: {
                            modules: true,
                            localIdentName:&apos;[name]_[local]_[hash:base64:5]&apos;
                        }
                    }
                ]
            }
        ]
    }
</code></pre>
<h3 id="t13624.4 webpack.server.js">24.4 webpack.server.js <a href="#t13624.4 webpack.server.js"> # </a></h3>
<p>webpack.server.js</p>
<pre><code class="lang-js">module:{
        rules:[
            {
                test: /\.css$/,
                use: [
                    &apos;isomorphic-style-loader&apos;,
                    {
                        loader: &apos;css-loader&apos;,
                        options: {
                            modules: true,
                            localIdentName:&apos;[name]_[local]_[hash:base64:5]&apos;
                        }
                    }
                ]
            }
        ]
    }
</code></pre>
<h3 id="t13724.5 Header/index.css">24.5 Header/index.css <a href="#t13724.5 Header/index.css"> # </a></h3>
<p>src/components/Header/index.css</p>
<pre><code class="lang-css">.user{
    color:red;
}
</code></pre>
<h3 id="t13824.6 src/containers/App.css">24.6 src/containers/App.css <a href="#t13824.6 src/containers/App.css"> # </a></h3>
<p>src/containers/App.css</p>
<pre><code class="lang-css">.app{
    margin-top:70px;
}
</code></pre>
<h2 id="t13925. CSS&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;">25. CSS&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3; <a href="#t13925. CSS&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;"> # </a></h2>
<h3 id="t14025.1 Header/index.js">25.1 Header/index.js <a href="#t14025.1 Header/index.js"> # </a></h3>
<p>src/components/Header/index.js</p>
<pre><code class="lang-diff">+    componentWillMount() {
+        if (this.props.staticContext) {
+            this.props.staticContext.csses.push(styles._getCss());
+        }
+    }
</code></pre>
<h3 id="t14125.2 containers/App.js">25.2 containers/App.js <a href="#t14125.2 containers/App.js"> # </a></h3>
<p>src/containers/App.js</p>
<pre><code class="lang-diff">+    componentWillMount() {
+        if (this.props.staticContext) {
+            this.props.staticContext.csses.push(styles._getCss());
+        }
+    }
</code></pre>
<h3 id="t14225.3 server/render.js">25.3 server/render.js <a href="#t14225.3 server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-diff">let context={csses:[]};
        const content=renderToString(
            <provider store="{store}">
                <staticrouter context="{context}" location="{req.path}">
                    {renderRoutes(routes)}
                </staticrouter>
            </provider>
        );
+        let cssStr=&apos;&apos;;
+        if (context.csses.length&gt;0) {
+            cssStr=context.csses.join(&apos;\r\n&apos;);
+        }
        if (context.action == &apos;REPLACE&apos;) {
            return res.redirect(301,context.url);
        } else if (context.notFound) {
            res.status(404);
        }
        res.send(`
        
        
            
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
+                <style>${cssStr}</style>
                <title>&#x73E0;&#x5CF0;SSR</title>
            
            
                <div id="root">${content}</div>
                <script>
                  window.context = {
                      state:${JSON.stringify(store.getState())}
                  }
                </script>
                <script src="/index.js"></script>
            
        
        `);
</code></pre>
<h2 id="t14326. &#x4F18;&#x5316;CSS&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;">26. &#x4F18;&#x5316;CSS&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3; <a href="#t14326. &#x4F18;&#x5316;CSS&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x6E32;&#x67D3;"> # </a></h2>
<h3 id="t14426.1 Header/index.js">26.1 Header/index.js <a href="#t14426.1 Header/index.js"> # </a></h3>
<p>src/components/Header/index.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {Link} from &apos;react-router-dom&apos;;
import {connect} from &apos;react-redux&apos;;
import styles from &apos;./index.css&apos;;
import withStyles from &apos;../../withStyles&apos;;
class Header extends Component{
    render() {
        return (
            <nav classname="navbar navbar-inverse navbar-fixed-top">
                    <div classname="container">
                        <div classname="navbar-header">
                            <a classname="navbar-brand" href="#">&#x73E0;&#x5CF0;SSR</a>
                        </div>
                        <div id="navbar" classname="collapse navbar-collapse">
                            <ul classname="nav navbar-nav">
                              <li><link to="/">&#x9996;&#x9875;</li>
                              <li><link to="/user/list">&#x7528;&#x6237;&#x5217;&#x8868;</li>
                              {
                                !this.props.user&amp;&amp;<li><link to="/login">&#x767B;&#x5F55;</li>
                              }
                              {
                                this.props.user&amp;&amp;<fragment><li><link to="/logout">&#x9000;&#x51FA;</li><li><link to="/profile">&#x4E2A;&#x4EBA;&#x4E2D;&#x5FC3;</li></fragment>
                              }
                        </ul>
                        {
                            this.props.user&amp;&amp;(
                                <ul classname="nav navbar-nav navbar-right">
                                    <li><a href="#">&#x6B22;&#x8FCE; <span classname="{styles.user}">{this.props.user.username}</span></a></li>
                                </ul>
                            )
                         }
                        </div>
                    </div>
                </nav>
        )
    }
}
export default connect(
    state=&gt;state.session
)(withStyles(Header,styles));
</code></pre>
<h3 id="t14526.2 src/containers/App.js">26.2 src/containers/App.js <a href="#t14526.2 src/containers/App.js"> # </a></h3>
<p>src/containers/App.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {renderRoutes} from &apos;react-router-config&apos;;
import Header from &apos;../components/Header&apos;;
import actions from &apos;../store/actions/session&apos;;
import styles from &apos;./App.css&apos;;
import withStyles from &apos;../withStyles&apos;;
class App extends Component{
    componentWillMount() {
        if (this.props.staticContext) {
            this.props.staticContext.csses.push(styles._getCss());
        }
    }
    render() {
        return (
            <fragment>
                <header staticcontext="{this.props.staticContext}/">
                <div classname="container">
                    <fragment>
                      {renderRoutes(this.props.route.routes)}
                    </fragment>
                </div>
            
        )
    }
}
let Proxy=withStyles(App,styles);
Proxy.loadData=(store) =&gt; {
    return store.dispatch(actions.getUser());
}
export default Proxy;
</header></fragment></code></pre>
<h3 id="t14626.3 Home/index.js">26.3 Home/index.js <a href="#t14626.3 Home/index.js"> # </a></h3>
<p>src/containers/Home/index.js</p>
<pre><code class="lang-js">import React,{Component} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import actions from &apos;../../store/actions/home&apos;;
import withStyles from &apos;../../withStyles&apos;;
class Home extends Component{
    static loadData=(store) =&gt; {
        //dispatch&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;action
        //https://github.com/reduxjs/redux/blob/master/src/createStore.js
        return store.dispatch(actions.getHomeList());
    }
    //componentDidMount&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x662F;&#x4E0D;&#x6267;&#x884C;&#x7684;
    componentDidMount() {
        if(this.props.list.length==0)
            this.props.getHomeList();
    }
    render() {
        return (
            <div classname="row">
                <div classname="col-md-12">
                    <ul classname="list-group">
                        {
                            this.props.list.map(item =&gt; (
                                <li classname="list-group-item" key="{item.id}">{item.name}</li>
                            ))
                        }
                    </ul>
                </div>
            </div>
        )
    }
}
export default connect(
    state =&gt; state.home,
    actions
)(Home);
</code></pre>
<h3 id="t14726.4 src/withStyles.js">26.4 src/withStyles.js <a href="#t14726.4 src/withStyles.js"> # </a></h3>
<p>src/withStyles.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;

export default function withStyles(OriginalComponent,styles) {
    class ProxyComponent extends Component{
        componentWillMount() {
            if (this.props.staticContext) {
                this.props.staticContext.csses.push(styles._getCss());
            }
        }
        render() {
            return <originalcomponent {...this.props}="">
        }
    }
    return ProxyComponent;
}
</originalcomponent></code></pre>
<h2 id="t14827. SEO&#x4F18;&#x5316;">27. SEO&#x4F18;&#x5316; <a href="#t14827. SEO&#x4F18;&#x5316;"> # </a></h2>
<h3 id="t14927.1 Home/index.js">27.1 Home/index.js <a href="#t14927.1 Home/index.js"> # </a></h3>
<p>src/containers/Home/index.js</p>
<pre><code class="lang-js">import React,{Component,Fragment} from &apos;react&apos;;
import {connect} from &apos;react-redux&apos;;
import {Helmet} from &apos;react-helmet&apos;;
import actions from &apos;../../store/actions/home&apos;;

class Home extends Component{
    static loadData=(store) =&gt; {
        //dispatch&#x65B9;&#x6CD5;&#x7684;&#x8FD4;&#x56DE;&#x503C;&#x662F;action
        //https://github.com/reduxjs/redux/blob/master/src/createStore.js
        return store.dispatch(actions.getHomeList());
    }
    //componentDidMount&#x5728;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x662F;&#x4E0D;&#x6267;&#x884C;&#x7684;
    componentDidMount() {
        if(this.props.list.length==0)
            this.props.getHomeList();
    }
    render() {
        return (
            <fragment>
                <helmet>
                  <title>&#x9996;&#x9875;&#x6807;&#x9898;</title>
                  <meta name="description" content="&#x9996;&#x9875;&#x63CF;&#x8FF0;">
                </helmet>
                  <div classname="row">
                    <div classname="col-md-12">
                        <ul classname="list-group">
                            {
                                this.props.list.map(item =&gt; (
                                    <li classname="list-group-item" key="{item.id}">{item.name}</li>
                                ))
                            }
                        </ul>
                    </div>
                  </div>
            </fragment>
        )
    }
}
export default connect(
    state =&gt; state.home,
    actions
)(Home);
</code></pre>
<h3 id="t15027.2 src/server/render.js">27.2 src/server/render.js <a href="#t15027.2 src/server/render.js"> # </a></h3>
<p>src/server/render.js</p>
<pre><code class="lang-js">import {Helmet} from &apos;react-helmet&apos;;
let helmet=Helmet.renderStatic();

        let cssStr=&apos;&apos;;
        if (context.csses.length&gt;0) {
            cssStr=context.csses.join(&apos;\r\n&apos;);
        }
        if (context.action == &apos;REPLACE&apos;) {
            return res.redirect(301,context.url);
        } else if (context.notFound) {
            res.status(404);
        }
        res.send(`
        
        
            
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <meta http-equiv="X-UA-Compatible" content="ie=edge">
                ${helmet.title.toString()}
                ${helmet.meta.toString()}
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/[email&#xA0;protected]/dist/css/bootstrap.min.css">
                <style>${cssStr}</style>
                <title>&#x73E0;&#x5CF0;SSR</title>
            
            
                <div id="root">${content}</div>
                <script>
                  window.context = {
                      state:${JSON.stringify(store.getState())}
                  }
                </script>
                <script src="/index.js"></script>
            
        
        `);
</code></pre>

        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    